[{"id":"7312673973","type":"PullRequestReviewCommentEvent","actor":{"id":860932,"login":"oconnor663","display_login":"oconnor663","gravatar_id":"","url":"https://api.github.com/users/oconnor663","avatar_url":"https://avatars.githubusercontent.com/u/860932?"},"repo":{"id":59787605,"name":"keybase/kbfs","url":"https://api.github.com/repos/keybase/kbfs"},"payload":{"action":"created","comment":{"url":"https://api.github.com/repos/keybase/kbfs/pulls/comments/171395921","pull_request_review_id":100241825,"id":171395921,"diff_hunk":"@@ -0,0 +1,267 @@\n+// Copyright 2018 Keybase Inc. All rights reserved.\n+// Use of this source code is governed by a BSD\n+// license that can be found in the LICENSE file.\n+\n+package main\n+\n+import (\n+\t\"context\"\n+\t\"fmt\"\n+\t\"os\"\n+\t\"os/signal\"\n+\t\"os/user\"\n+\t\"path/filepath\"\n+\t\"runtime\"\n+\t\"sort\"\n+\t\"strconv\"\n+\t\"strings\"\n+\t\"sync\"\n+\t\"syscall\"\n+\t\"time\"\n+\n+\t\"bazil.org/fuse\"\n+\t\"bazil.org/fuse/fs\"\n+\t\"github.com/strib/gomounts\"\n+)\n+\n+var kbfusePath = fuse.OSXFUSEPaths{\n+\tDevicePrefix: \"/dev/kbfuse\",\n+\tLoad:         \"/Library/Filesystems/kbfuse.fs/Contents/Resources/load_kbfuse\",\n+\tMount:        \"/Library/Filesystems/kbfuse.fs/Contents/Resources/mount_kbfuse\",\n+\tDaemonVar:    \"MOUNT_KBFUSE_DAEMON_PATH\",\n+}\n+\n+const (\n+\tmountpointTimeout = 5 * time.Second\n+)\n+\n+type symlink struct {\n+\tlink string\n+}\n+\n+func (s symlink) Attr(ctx context.Context, a *fuse.Attr) (err error) {\n+\ta.Mode = os.ModeSymlink | a.Mode | 0555\n+\ta.Valid = 0\n+\treturn nil\n+}\n+\n+func (s symlink) Readlink(ctx context.Context, req *fuse.ReadlinkRequest) (\n+\tlink string, err error) {\n+\treturn s.link, nil\n+}\n+\n+type cacheEntry struct {\n+\tmountpoint string\n+\ttime       time.Time\n+}\n+\n+type root struct {\n+\tlock            sync.RWMutex\n+\tmountpointCache map[uint32]cacheEntry\n+}\n+\n+func newRoot() *root {\n+\treturn &root{\n+\t\tmountpointCache: make(map[uint32]cacheEntry),\n+\t}\n+}\n+\n+func (r *root) Root() (fs.Node, error) {\n+\treturn r, nil\n+}\n+\n+func (r *root) Attr(ctx context.Context, attr *fuse.Attr) error {\n+\tattr.Mode = os.ModeDir | 0555\n+\treturn nil\n+}\n+\n+func (r *root) getCachedMountpoint(uid uint32) string {\n+\tr.lock.RLock()\n+\tdefer r.lock.RUnlock()\n+\tentry, ok := r.mountpointCache[uid]\n+\tif !ok {\n+\t\treturn \"\"\n+\t}\n+\tnow := time.Now()\n+\tif now.Sub(entry.time) > mountpointTimeout {\n+\t\t// Don't bother deleting the entry, since the caller should\n+\t\t// just overwrite it.\n+\t\treturn \"\"\n+\t}\n+\treturn entry.mountpoint\n+}\n+\n+func (r *root) findKBFSMount(ctx context.Context) (\n+\tmountpoint string, err error) {\n+\tuid := ctx.Value(fs.CtxHeaderUIDKey).(uint32)\n+\t// Don't let the root see anything here; we don't want a symlink\n+\t// loop back to this mount.\n+\tif uid == 0 {\n+\t\treturn \"\", fuse.ENOENT\n+\t}\n+\n+\tmountpoint = r.getCachedMountpoint(uid)\n+\tif mountpoint != \"\" {\n+\t\treturn mountpoint, nil\n+\t}\n+\n+\tdefer func() {\n+\t\tif err != nil {\n+\t\t\treturn\n+\t\t}\n+\t\t// Cache the entry if we didn't hit an error.\n+\t\tr.lock.Lock()\n+\t\tdefer r.lock.Unlock()\n+\t\tr.mountpointCache[uid] = cacheEntry{\n+\t\t\tmountpoint: mountpoint,\n+\t\t\ttime:       time.Now(),\n+\t\t}\n+\t}()\n+\n+\tu, err := user.LookupId(strconv.FormatUint(uint64(uid), 10))\n+\tif err != nil {\n+\t\treturn \"\", err\n+\t}\n+\n+\tvols, err := gomounts.GetMountedVolumes()\n+\tif err != nil {\n+\t\treturn \"\", err\n+\t}\n+\tfuseType := \"fuse\"\n+\tif runtime.GOOS == \"darwin\" {\n+\t\tfuseType = \"kbfuse\"\n+\t}\n+\tvar fuseMountPoints []string\n+\tfor _, v := range vols {\n+\t\tif v.Type != fuseType {\n+\t\t\tcontinue\n+\t\t}\n+\t\tif v.Owner != u.Uid {\n+\t\t\tcontinue\n+\t\t}\n+\t\tfuseMountPoints = append(fuseMountPoints, v.Path)\n+\t}\n+\n+\tif len(fuseMountPoints) == 0 {\n+\t\treturn \"\", fuse.ENOENT\n+\t}\n+\tif len(fuseMountPoints) == 1 {\n+\t\treturn fuseMountPoints[0], nil\n+\t}\n+\n+\t// If there is more than one, pick the first one alphabetically\n+\t// that has \"keybase\" in the path.\n+\tsort.Strings(fuseMountPoints)\n+\tfor _, mp := range fuseMountPoints {\n+\t\t// TODO: a better regexp that will rule out keybase.staging if\n+\t\t// we're in prod mode, etc.\n+\t\tif !strings.Contains(mp, \"keybase\") {\n+\t\t\tcontinue\n+\t\t}\n+\t\t// Double-check that this is a real KBFS mount.\n+\t\tif _, err := os.Stat(filepath.Join(mp, \".kbfs_error\")); err != nil {\n+\t\t\tcontinue\n+\t\t}\n+\t\treturn mp, nil\n+\t}\n+\n+\t// Give up and return the first one.\n+\treturn fuseMountPoints[0], nil\n+}\n+\n+func (r *root) ReadDirAll(ctx context.Context) ([]fuse.Dirent, error) {\n+\t_, err := r.findKBFSMount(ctx)\n+\tif err != nil {\n+\t\tif err == fuse.ENOENT {\n+\t\t\treturn []fuse.Dirent{}, nil\n+\t\t} else {\n+\t\t\treturn []fuse.Dirent{}, err\n+\t\t}\n+\t}\n+\n+\t// TODO: show the `kbfs.error.txt\" and \"kbfs.nologin.txt\" files if\n+\t// they exist?  As root, it is hard to figure out if they're\n+\t// there, though.\n+\treturn []fuse.Dirent{\n+\t\t{\n+\t\t\tType: fuse.DT_Link,\n+\t\t\tName: \"private\",\n+\t\t},\n+\t\t{\n+\t\t\tType: fuse.DT_Link,\n+\t\t\tName: \"public\",\n+\t\t},\n+\t\tfuse.Dirent{\n+\t\t\tType: fuse.DT_Link,\n+\t\t\tName: \"team\",\n+\t\t},\n+\t}, nil\n+}\n+\n+func (r *root) Lookup(\n+\tctx context.Context, req *fuse.LookupRequest, resp *fuse.LookupResponse) (\n+\tn fs.Node, err error) {\n+\tmountpoint, err := r.findKBFSMount(ctx)\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\n+\tresp.EntryValid = 0\n+\tswitch req.Name {\n+\tcase \"private\", \"public\", \"team\", \".kbfs_error\", \".kbfs_metrics\",\n+\t\t\".kbfs_profiles\", \".kbfs_reset_caches\", \".kbfs_status\",\n+\t\t\"kbfs.error.txt\", \"kbfs.nologin.txt\", \".kbfs_enable_auto_journals\",\n+\t\t\".kbfs_disable_auto_journals\", \".kbfs_enable_block_prefetching\",\n+\t\t\".kbfs_disable_block_prefetching\", \".kbfs_enable_debug_server\",\n+\t\t\".kbfs_disable_debug_server\":\n+\t\treturn symlink{filepath.Join(mountpoint, req.Name)}, nil\n+\t}\n+\treturn nil, fuse.ENOENT\n+}\n+\n+func main() {\n+\tcurrUser, err := user.Current()\n+\tif err != nil {\n+\t\tpanic(err)\n+\t}\n+\tif currUser.Uid != \"0\" {\n+\t\truntime.LockOSThread()\n+\t\t_, _, errNo := syscall.Syscall(syscall.SYS_SETUID, 0, 0, 0)","path":"redirector/go/main.go","position":228,"original_position":229,"commit_id":"a375bbaa852f7c4c5475526da029481d313d80e8","original_commit_id":"4a9c54931293f10b5568f92acdec99a7e74547c5","user":{"login":"oconnor663","id":860932,"avatar_url":"https://avatars0.githubusercontent.com/u/860932?v=4","gravatar_id":"","url":"https://api.github.com/users/oconnor663","html_url":"https://github.com/oconnor663","followers_url":"https://api.github.com/users/oconnor663/followers","following_url":"https://api.github.com/users/oconnor663/following{/other_user}","gists_url":"https://api.github.com/users/oconnor663/gists{/gist_id}","starred_url":"https://api.github.com/users/oconnor663/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oconnor663/subscriptions","organizations_url":"https://api.github.com/users/oconnor663/orgs","repos_url":"https://api.github.com/users/oconnor663/repos","events_url":"https://api.github.com/users/oconnor663/events{/privacy}","received_events_url":"https://api.github.com/users/oconnor663/received_events","type":"User","site_admin":false},"body":"Another more trivial Go program seems to work just fine with the suid flag. (I just had it create a file in the current directory. Works in root-owned directories without `sudo`.)","created_at":"2018-02-28T21:47:43Z","updated_at":"2018-02-28T21:47:43Z","html_url":"https://github.com/keybase/kbfs/pull/1496#discussion_r171395921","pull_request_url":"https://api.github.com/repos/keybase/kbfs/pulls/1496","author_association":"CONTRIBUTOR","_links":{"self":{"href":"https://api.github.com/repos/keybase/kbfs/pulls/comments/171395921"},"html":{"href":"https://github.com/keybase/kbfs/pull/1496#discussion_r171395921"},"pull_request":{"href":"https://api.github.com/repos/keybase/kbfs/pulls/1496"}},"in_reply_to_id":171385042},"pull_request":{"url":"https://api.github.com/repos/keybase/kbfs/pulls/1496","id":172070599,"html_url":"https://github.com/keybase/kbfs/pull/1496","diff_url":"https://github.com/keybase/kbfs/pull/1496.diff","patch_url":"https://github.com/keybase/kbfs/pull/1496.patch","issue_url":"https://api.github.com/repos/keybase/kbfs/issues/1496","number":1496,"state":"open","locked":false,"title":"redirector: a Go implementation for the root redirector","user":{"login":"strib","id":8516691,"avatar_url":"https://avatars0.githubusercontent.com/u/8516691?v=4","gravatar_id":"","url":"https://api.github.com/users/strib","html_url":"https://github.com/strib","followers_url":"https://api.github.com/users/strib/followers","following_url":"https://api.github.com/users/strib/following{/other_user}","gists_url":"https://api.github.com/users/strib/gists{/gist_id}","starred_url":"https://api.github.com/users/strib/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/strib/subscriptions","organizations_url":"https://api.github.com/users/strib/orgs","repos_url":"https://api.github.com/users/strib/repos","events_url":"https://api.github.com/users/strib/events{/privacy}","received_events_url":"https://api.github.com/users/strib/received_events","type":"User","site_admin":false},"body":"This implementation of the root redirector will likely be used for macOS, at least until we figure out the kbfuse+Rust situation.\r\n\r\nNote that I needed some new bazil.org/fuse options, so I forked it to github.comkeybase/fuse and added two new features:\r\n* A NoBrowse() option that keeps the redirector from showing up in the Finder (instead, the specific user's mount will show up).\r\n* Adding the requesting user's UID to the context for every request, since `ReadDirAll` needs to know whether the requesting user has a valid mountpoint or not.  The bazil.org/fuse interface for `ReadDirAll` doesn't pass this down, so putting it in the context seemed like the easiest option for now.\r\n\r\nIssue: KBFS-2774","created_at":"2018-02-28T20:58:07Z","updated_at":"2018-02-28T21:47:43Z","closed_at":null,"merged_at":null,"merge_commit_sha":"437c5c76f895a2fc4092ddecb665a8ea1424e823","assignee":null,"assignees":[],"requested_reviewers":[{"login":"jzila","id":59594,"avatar_url":"https://avatars1.githubusercontent.com/u/59594?v=4","gravatar_id":"","url":"https://api.github.com/users/jzila","html_url":"https://github.com/jzila","followers_url":"https://api.github.com/users/jzila/followers","following_url":"https://api.github.com/users/jzila/following{/other_user}","gists_url":"https://api.github.com/users/jzila/gists{/gist_id}","starred_url":"https://api.github.com/users/jzila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jzila/subscriptions","organizations_url":"https://api.github.com/users/jzila/orgs","repos_url":"https://api.github.com/users/jzila/repos","events_url":"https://api.github.com/users/jzila/events{/privacy}","received_events_url":"https://api.github.com/users/jzila/received_events","type":"User","site_admin":false},{"login":"songgao","id":255797,"avatar_url":"https://avatars3.githubusercontent.com/u/255797?v=4","gravatar_id":"","url":"https://api.github.com/users/songgao","html_url":"https://github.com/songgao","followers_url":"https://api.github.com/users/songgao/followers","following_url":"https://api.github.com/users/songgao/following{/other_user}","gists_url":"https://api.github.com/users/songgao/gists{/gist_id}","starred_url":"https://api.github.com/users/songgao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/songgao/subscriptions","organizations_url":"https://api.github.com/users/songgao/orgs","repos_url":"https://api.github.com/users/songgao/repos","events_url":"https://api.github.com/users/songgao/events{/privacy}","received_events_url":"https://api.github.com/users/songgao/received_events","type":"User","site_admin":false},{"login":"akalin-keybase","id":13270622,"avatar_url":"https://avatars3.githubusercontent.com/u/13270622?v=4","gravatar_id":"","url":"https://api.github.com/users/akalin-keybase","html_url":"https://github.com/akalin-keybase","followers_url":"https://api.github.com/users/akalin-keybase/followers","following_url":"https://api.github.com/users/akalin-keybase/following{/other_user}","gists_url":"https://api.github.com/users/akalin-keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/akalin-keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/akalin-keybase/subscriptions","organizations_url":"https://api.github.com/users/akalin-keybase/orgs","repos_url":"https://api.github.com/users/akalin-keybase/repos","events_url":"https://api.github.com/users/akalin-keybase/events{/privacy}","received_events_url":"https://api.github.com/users/akalin-keybase/received_events","type":"User","site_admin":false}],"requested_teams":[],"labels":[],"milestone":null,"commits_url":"https://api.github.com/repos/keybase/kbfs/pulls/1496/commits","review_comments_url":"https://api.github.com/repos/keybase/kbfs/pulls/1496/comments","review_comment_url":"https://api.github.com/repos/keybase/kbfs/pulls/comments{/number}","comments_url":"https://api.github.com/repos/keybase/kbfs/issues/1496/comments","statuses_url":"https://api.github.com/repos/keybase/kbfs/statuses/a375bbaa852f7c4c5475526da029481d313d80e8","head":{"label":"keybase:strib/KBFS-2774-mount-redirector","ref":"strib/KBFS-2774-mount-redirector","sha":"a375bbaa852f7c4c5475526da029481d313d80e8","user":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"repo":{"id":59787605,"name":"kbfs","full_name":"keybase/kbfs","owner":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"private":false,"html_url":"https://github.com/keybase/kbfs","description":"Keybase Filesystem (KBFS)","fork":false,"url":"https://api.github.com/repos/keybase/kbfs","forks_url":"https://api.github.com/repos/keybase/kbfs/forks","keys_url":"https://api.github.com/repos/keybase/kbfs/keys{/key_id}","collaborators_url":"https://api.github.com/repos/keybase/kbfs/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/keybase/kbfs/teams","hooks_url":"https://api.github.com/repos/keybase/kbfs/hooks","issue_events_url":"https://api.github.com/repos/keybase/kbfs/issues/events{/number}","events_url":"https://api.github.com/repos/keybase/kbfs/events","assignees_url":"https://api.github.com/repos/keybase/kbfs/assignees{/user}","branches_url":"https://api.github.com/repos/keybase/kbfs/branches{/branch}","tags_url":"https://api.github.com/repos/keybase/kbfs/tags","blobs_url":"https://api.github.com/repos/keybase/kbfs/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/keybase/kbfs/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/keybase/kbfs/git/refs{/sha}","trees_url":"https://api.github.com/repos/keybase/kbfs/git/trees{/sha}","statuses_url":"https://api.github.com/repos/keybase/kbfs/statuses/{sha}","languages_url":"https://api.github.com/repos/keybase/kbfs/languages","stargazers_url":"https://api.github.com/repos/keybase/kbfs/stargazers","contributors_url":"https://api.github.com/repos/keybase/kbfs/contributors","subscribers_url":"https://api.github.com/repos/keybase/kbfs/subscribers","subscription_url":"https://api.github.com/repos/keybase/kbfs/subscription","commits_url":"https://api.github.com/repos/keybase/kbfs/commits{/sha}","git_commits_url":"https://api.github.com/repos/keybase/kbfs/git/commits{/sha}","comments_url":"https://api.github.com/repos/keybase/kbfs/comments{/number}","issue_comment_url":"https://api.github.com/repos/keybase/kbfs/issues/comments{/number}","contents_url":"https://api.github.com/repos/keybase/kbfs/contents/{+path}","compare_url":"https://api.github.com/repos/keybase/kbfs/compare/{base}...{head}","merges_url":"https://api.github.com/repos/keybase/kbfs/merges","archive_url":"https://api.github.com/repos/keybase/kbfs/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/keybase/kbfs/downloads","issues_url":"https://api.github.com/repos/keybase/kbfs/issues{/number}","pulls_url":"https://api.github.com/repos/keybase/kbfs/pulls{/number}","milestones_url":"https://api.github.com/repos/keybase/kbfs/milestones{/number}","notifications_url":"https://api.github.com/repos/keybase/kbfs/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/keybase/kbfs/labels{/name}","releases_url":"https://api.github.com/repos/keybase/kbfs/releases{/id}","deployments_url":"https://api.github.com/repos/keybase/kbfs/deployments","created_at":"2016-05-26T22:37:42Z","updated_at":"2018-02-28T02:25:38Z","pushed_at":"2018-02-28T21:03:09Z","git_url":"git://github.com/keybase/kbfs.git","ssh_url":"git@github.com:keybase/kbfs.git","clone_url":"https://github.com/keybase/kbfs.git","svn_url":"https://github.com/keybase/kbfs","homepage":"https://keybase.io/docs/kbfs","size":48520,"stargazers_count":885,"watchers_count":885,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"forks_count":76,"mirror_url":null,"archived":false,"open_issues_count":46,"license":{"key":"bsd-3-clause","name":"BSD 3-Clause \"New\" or \"Revised\" License","spdx_id":"BSD-3-Clause","url":"https://api.github.com/licenses/bsd-3-clause"},"forks":76,"open_issues":46,"watchers":885,"default_branch":"master"}},"base":{"label":"keybase:master","ref":"master","sha":"478a58b55a4605e2abe8699e32adc066bf1df7ee","user":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"repo":{"id":59787605,"name":"kbfs","full_name":"keybase/kbfs","owner":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"private":false,"html_url":"https://github.com/keybase/kbfs","description":"Keybase Filesystem (KBFS)","fork":false,"url":"https://api.github.com/repos/keybase/kbfs","forks_url":"https://api.github.com/repos/keybase/kbfs/forks","keys_url":"https://api.github.com/repos/keybase/kbfs/keys{/key_id}","collaborators_url":"https://api.github.com/repos/keybase/kbfs/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/keybase/kbfs/teams","hooks_url":"https://api.github.com/repos/keybase/kbfs/hooks","issue_events_url":"https://api.github.com/repos/keybase/kbfs/issues/events{/number}","events_url":"https://api.github.com/repos/keybase/kbfs/events","assignees_url":"https://api.github.com/repos/keybase/kbfs/assignees{/user}","branches_url":"https://api.github.com/repos/keybase/kbfs/branches{/branch}","tags_url":"https://api.github.com/repos/keybase/kbfs/tags","blobs_url":"https://api.github.com/repos/keybase/kbfs/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/keybase/kbfs/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/keybase/kbfs/git/refs{/sha}","trees_url":"https://api.github.com/repos/keybase/kbfs/git/trees{/sha}","statuses_url":"https://api.github.com/repos/keybase/kbfs/statuses/{sha}","languages_url":"https://api.github.com/repos/keybase/kbfs/languages","stargazers_url":"https://api.github.com/repos/keybase/kbfs/stargazers","contributors_url":"https://api.github.com/repos/keybase/kbfs/contributors","subscribers_url":"https://api.github.com/repos/keybase/kbfs/subscribers","subscription_url":"https://api.github.com/repos/keybase/kbfs/subscription","commits_url":"https://api.github.com/repos/keybase/kbfs/commits{/sha}","git_commits_url":"https://api.github.com/repos/keybase/kbfs/git/commits{/sha}","comments_url":"https://api.github.com/repos/keybase/kbfs/comments{/number}","issue_comment_url":"https://api.github.com/repos/keybase/kbfs/issues/comments{/number}","contents_url":"https://api.github.com/repos/keybase/kbfs/contents/{+path}","compare_url":"https://api.github.com/repos/keybase/kbfs/compare/{base}...{head}","merges_url":"https://api.github.com/repos/keybase/kbfs/merges","archive_url":"https://api.github.com/repos/keybase/kbfs/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/keybase/kbfs/downloads","issues_url":"https://api.github.com/repos/keybase/kbfs/issues{/number}","pulls_url":"https://api.github.com/repos/keybase/kbfs/pulls{/number}","milestones_url":"https://api.github.com/repos/keybase/kbfs/milestones{/number}","notifications_url":"https://api.github.com/repos/keybase/kbfs/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/keybase/kbfs/labels{/name}","releases_url":"https://api.github.com/repos/keybase/kbfs/releases{/id}","deployments_url":"https://api.github.com/repos/keybase/kbfs/deployments","created_at":"2016-05-26T22:37:42Z","updated_at":"2018-02-28T02:25:38Z","pushed_at":"2018-02-28T21:03:09Z","git_url":"git://github.com/keybase/kbfs.git","ssh_url":"git@github.com:keybase/kbfs.git","clone_url":"https://github.com/keybase/kbfs.git","svn_url":"https://github.com/keybase/kbfs","homepage":"https://keybase.io/docs/kbfs","size":48520,"stargazers_count":885,"watchers_count":885,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"forks_count":76,"mirror_url":null,"archived":false,"open_issues_count":46,"license":{"key":"bsd-3-clause","name":"BSD 3-Clause \"New\" or \"Revised\" License","spdx_id":"BSD-3-Clause","url":"https://api.github.com/licenses/bsd-3-clause"},"forks":76,"open_issues":46,"watchers":885,"default_branch":"master"}},"_links":{"self":{"href":"https://api.github.com/repos/keybase/kbfs/pulls/1496"},"html":{"href":"https://github.com/keybase/kbfs/pull/1496"},"issue":{"href":"https://api.github.com/repos/keybase/kbfs/issues/1496"},"comments":{"href":"https://api.github.com/repos/keybase/kbfs/issues/1496/comments"},"review_comments":{"href":"https://api.github.com/repos/keybase/kbfs/pulls/1496/comments"},"review_comment":{"href":"https://api.github.com/repos/keybase/kbfs/pulls/comments{/number}"},"commits":{"href":"https://api.github.com/repos/keybase/kbfs/pulls/1496/commits"},"statuses":{"href":"https://api.github.com/repos/keybase/kbfs/statuses/a375bbaa852f7c4c5475526da029481d313d80e8"}},"author_association":"CONTRIBUTOR"}},"public":true,"created_at":"2018-02-28T21:47:43Z","org":{"id":5400834,"login":"keybase","gravatar_id":"","url":"https://api.github.com/orgs/keybase","avatar_url":"https://avatars.githubusercontent.com/u/5400834?"}},{"id":"7312646812","type":"PullRequestReviewCommentEvent","actor":{"id":860932,"login":"oconnor663","display_login":"oconnor663","gravatar_id":"","url":"https://api.github.com/users/oconnor663","avatar_url":"https://avatars.githubusercontent.com/u/860932?"},"repo":{"id":59787605,"name":"keybase/kbfs","url":"https://api.github.com/repos/keybase/kbfs"},"payload":{"action":"created","comment":{"url":"https://api.github.com/repos/keybase/kbfs/pulls/comments/171394506","pull_request_review_id":100240041,"id":171394506,"diff_hunk":"@@ -0,0 +1,267 @@\n+// Copyright 2018 Keybase Inc. All rights reserved.\n+// Use of this source code is governed by a BSD\n+// license that can be found in the LICENSE file.\n+\n+package main\n+\n+import (\n+\t\"context\"\n+\t\"fmt\"\n+\t\"os\"\n+\t\"os/signal\"\n+\t\"os/user\"\n+\t\"path/filepath\"\n+\t\"runtime\"\n+\t\"sort\"\n+\t\"strconv\"\n+\t\"strings\"\n+\t\"sync\"\n+\t\"syscall\"\n+\t\"time\"\n+\n+\t\"bazil.org/fuse\"\n+\t\"bazil.org/fuse/fs\"\n+\t\"github.com/strib/gomounts\"\n+)\n+\n+var kbfusePath = fuse.OSXFUSEPaths{\n+\tDevicePrefix: \"/dev/kbfuse\",\n+\tLoad:         \"/Library/Filesystems/kbfuse.fs/Contents/Resources/load_kbfuse\",\n+\tMount:        \"/Library/Filesystems/kbfuse.fs/Contents/Resources/mount_kbfuse\",\n+\tDaemonVar:    \"MOUNT_KBFUSE_DAEMON_PATH\",\n+}\n+\n+const (\n+\tmountpointTimeout = 5 * time.Second\n+)\n+\n+type symlink struct {\n+\tlink string\n+}\n+\n+func (s symlink) Attr(ctx context.Context, a *fuse.Attr) (err error) {\n+\ta.Mode = os.ModeSymlink | a.Mode | 0555\n+\ta.Valid = 0\n+\treturn nil\n+}\n+\n+func (s symlink) Readlink(ctx context.Context, req *fuse.ReadlinkRequest) (\n+\tlink string, err error) {\n+\treturn s.link, nil\n+}\n+\n+type cacheEntry struct {\n+\tmountpoint string\n+\ttime       time.Time\n+}\n+\n+type root struct {\n+\tlock            sync.RWMutex\n+\tmountpointCache map[uint32]cacheEntry\n+}\n+\n+func newRoot() *root {\n+\treturn &root{\n+\t\tmountpointCache: make(map[uint32]cacheEntry),\n+\t}\n+}\n+\n+func (r *root) Root() (fs.Node, error) {\n+\treturn r, nil\n+}\n+\n+func (r *root) Attr(ctx context.Context, attr *fuse.Attr) error {\n+\tattr.Mode = os.ModeDir | 0555\n+\treturn nil\n+}\n+\n+func (r *root) getCachedMountpoint(uid uint32) string {\n+\tr.lock.RLock()\n+\tdefer r.lock.RUnlock()\n+\tentry, ok := r.mountpointCache[uid]\n+\tif !ok {\n+\t\treturn \"\"\n+\t}\n+\tnow := time.Now()\n+\tif now.Sub(entry.time) > mountpointTimeout {\n+\t\t// Don't bother deleting the entry, since the caller should\n+\t\t// just overwrite it.\n+\t\treturn \"\"\n+\t}\n+\treturn entry.mountpoint\n+}\n+\n+func (r *root) findKBFSMount(ctx context.Context) (\n+\tmountpoint string, err error) {\n+\tuid := ctx.Value(fs.CtxHeaderUIDKey).(uint32)\n+\t// Don't let the root see anything here; we don't want a symlink\n+\t// loop back to this mount.\n+\tif uid == 0 {\n+\t\treturn \"\", fuse.ENOENT\n+\t}\n+\n+\tmountpoint = r.getCachedMountpoint(uid)\n+\tif mountpoint != \"\" {\n+\t\treturn mountpoint, nil\n+\t}\n+\n+\tdefer func() {\n+\t\tif err != nil {\n+\t\t\treturn\n+\t\t}\n+\t\t// Cache the entry if we didn't hit an error.\n+\t\tr.lock.Lock()\n+\t\tdefer r.lock.Unlock()\n+\t\tr.mountpointCache[uid] = cacheEntry{\n+\t\t\tmountpoint: mountpoint,\n+\t\t\ttime:       time.Now(),\n+\t\t}\n+\t}()\n+\n+\tu, err := user.LookupId(strconv.FormatUint(uint64(uid), 10))\n+\tif err != nil {\n+\t\treturn \"\", err\n+\t}\n+\n+\tvols, err := gomounts.GetMountedVolumes()\n+\tif err != nil {\n+\t\treturn \"\", err\n+\t}\n+\tfuseType := \"fuse\"\n+\tif runtime.GOOS == \"darwin\" {\n+\t\tfuseType = \"kbfuse\"\n+\t}\n+\tvar fuseMountPoints []string\n+\tfor _, v := range vols {\n+\t\tif v.Type != fuseType {\n+\t\t\tcontinue\n+\t\t}\n+\t\tif v.Owner != u.Uid {\n+\t\t\tcontinue\n+\t\t}\n+\t\tfuseMountPoints = append(fuseMountPoints, v.Path)\n+\t}\n+\n+\tif len(fuseMountPoints) == 0 {\n+\t\treturn \"\", fuse.ENOENT\n+\t}\n+\tif len(fuseMountPoints) == 1 {\n+\t\treturn fuseMountPoints[0], nil\n+\t}\n+\n+\t// If there is more than one, pick the first one alphabetically\n+\t// that has \"keybase\" in the path.\n+\tsort.Strings(fuseMountPoints)\n+\tfor _, mp := range fuseMountPoints {\n+\t\t// TODO: a better regexp that will rule out keybase.staging if\n+\t\t// we're in prod mode, etc.\n+\t\tif !strings.Contains(mp, \"keybase\") {\n+\t\t\tcontinue\n+\t\t}\n+\t\t// Double-check that this is a real KBFS mount.\n+\t\tif _, err := os.Stat(filepath.Join(mp, \".kbfs_error\")); err != nil {\n+\t\t\tcontinue\n+\t\t}\n+\t\treturn mp, nil\n+\t}\n+\n+\t// Give up and return the first one.\n+\treturn fuseMountPoints[0], nil\n+}\n+\n+func (r *root) ReadDirAll(ctx context.Context) ([]fuse.Dirent, error) {\n+\t_, err := r.findKBFSMount(ctx)\n+\tif err != nil {\n+\t\tif err == fuse.ENOENT {\n+\t\t\treturn []fuse.Dirent{}, nil\n+\t\t} else {\n+\t\t\treturn []fuse.Dirent{}, err\n+\t\t}\n+\t}\n+\n+\t// TODO: show the `kbfs.error.txt\" and \"kbfs.nologin.txt\" files if\n+\t// they exist?  As root, it is hard to figure out if they're\n+\t// there, though.\n+\treturn []fuse.Dirent{\n+\t\t{\n+\t\t\tType: fuse.DT_Link,\n+\t\t\tName: \"private\",\n+\t\t},\n+\t\t{\n+\t\t\tType: fuse.DT_Link,\n+\t\t\tName: \"public\",\n+\t\t},\n+\t\tfuse.Dirent{\n+\t\t\tType: fuse.DT_Link,\n+\t\t\tName: \"team\",\n+\t\t},\n+\t}, nil\n+}\n+\n+func (r *root) Lookup(\n+\tctx context.Context, req *fuse.LookupRequest, resp *fuse.LookupResponse) (\n+\tn fs.Node, err error) {\n+\tmountpoint, err := r.findKBFSMount(ctx)\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\n+\tresp.EntryValid = 0\n+\tswitch req.Name {\n+\tcase \"private\", \"public\", \"team\", \".kbfs_error\", \".kbfs_metrics\",\n+\t\t\".kbfs_profiles\", \".kbfs_reset_caches\", \".kbfs_status\",\n+\t\t\"kbfs.error.txt\", \"kbfs.nologin.txt\", \".kbfs_enable_auto_journals\",\n+\t\t\".kbfs_disable_auto_journals\", \".kbfs_enable_block_prefetching\",\n+\t\t\".kbfs_disable_block_prefetching\", \".kbfs_enable_debug_server\",\n+\t\t\".kbfs_disable_debug_server\":\n+\t\treturn symlink{filepath.Join(mountpoint, req.Name)}, nil\n+\t}\n+\treturn nil, fuse.ENOENT\n+}\n+\n+func main() {\n+\tcurrUser, err := user.Current()\n+\tif err != nil {\n+\t\tpanic(err)\n+\t}\n+\tif currUser.Uid != \"0\" {\n+\t\truntime.LockOSThread()\n+\t\t_, _, errNo := syscall.Syscall(syscall.SYS_SETUID, 0, 0, 0)","path":"redirector/go/main.go","position":228,"original_position":229,"commit_id":"a375bbaa852f7c4c5475526da029481d313d80e8","original_commit_id":"4a9c54931293f10b5568f92acdec99a7e74547c5","user":{"login":"oconnor663","id":860932,"avatar_url":"https://avatars0.githubusercontent.com/u/860932?v=4","gravatar_id":"","url":"https://api.github.com/users/oconnor663","html_url":"https://github.com/oconnor663","followers_url":"https://api.github.com/users/oconnor663/followers","following_url":"https://api.github.com/users/oconnor663/following{/other_user}","gists_url":"https://api.github.com/users/oconnor663/gists{/gist_id}","starred_url":"https://api.github.com/users/oconnor663/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oconnor663/subscriptions","organizations_url":"https://api.github.com/users/oconnor663/orgs","repos_url":"https://api.github.com/users/oconnor663/repos","events_url":"https://api.github.com/users/oconnor663/events{/privacy}","received_events_url":"https://api.github.com/users/oconnor663/received_events","type":"User","site_admin":false},"body":"Oof, why does this work with a Rust binary but not a Go binary? I just rechecked that it does. (I wasn't able to use `/tmp` for everything though, because it's a `nosuid` mount on my system. Hopefully that doesn't matter here.)","created_at":"2018-02-28T21:42:05Z","updated_at":"2018-02-28T21:42:05Z","html_url":"https://github.com/keybase/kbfs/pull/1496#discussion_r171394506","pull_request_url":"https://api.github.com/repos/keybase/kbfs/pulls/1496","author_association":"CONTRIBUTOR","_links":{"self":{"href":"https://api.github.com/repos/keybase/kbfs/pulls/comments/171394506"},"html":{"href":"https://github.com/keybase/kbfs/pull/1496#discussion_r171394506"},"pull_request":{"href":"https://api.github.com/repos/keybase/kbfs/pulls/1496"}},"in_reply_to_id":171385042},"pull_request":{"url":"https://api.github.com/repos/keybase/kbfs/pulls/1496","id":172070599,"html_url":"https://github.com/keybase/kbfs/pull/1496","diff_url":"https://github.com/keybase/kbfs/pull/1496.diff","patch_url":"https://github.com/keybase/kbfs/pull/1496.patch","issue_url":"https://api.github.com/repos/keybase/kbfs/issues/1496","number":1496,"state":"open","locked":false,"title":"redirector: a Go implementation for the root redirector","user":{"login":"strib","id":8516691,"avatar_url":"https://avatars0.githubusercontent.com/u/8516691?v=4","gravatar_id":"","url":"https://api.github.com/users/strib","html_url":"https://github.com/strib","followers_url":"https://api.github.com/users/strib/followers","following_url":"https://api.github.com/users/strib/following{/other_user}","gists_url":"https://api.github.com/users/strib/gists{/gist_id}","starred_url":"https://api.github.com/users/strib/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/strib/subscriptions","organizations_url":"https://api.github.com/users/strib/orgs","repos_url":"https://api.github.com/users/strib/repos","events_url":"https://api.github.com/users/strib/events{/privacy}","received_events_url":"https://api.github.com/users/strib/received_events","type":"User","site_admin":false},"body":"This implementation of the root redirector will likely be used for macOS, at least until we figure out the kbfuse+Rust situation.\r\n\r\nNote that I needed some new bazil.org/fuse options, so I forked it to github.comkeybase/fuse and added two new features:\r\n* A NoBrowse() option that keeps the redirector from showing up in the Finder (instead, the specific user's mount will show up).\r\n* Adding the requesting user's UID to the context for every request, since `ReadDirAll` needs to know whether the requesting user has a valid mountpoint or not.  The bazil.org/fuse interface for `ReadDirAll` doesn't pass this down, so putting it in the context seemed like the easiest option for now.\r\n\r\nIssue: KBFS-2774","created_at":"2018-02-28T20:58:07Z","updated_at":"2018-02-28T21:42:05Z","closed_at":null,"merged_at":null,"merge_commit_sha":"437c5c76f895a2fc4092ddecb665a8ea1424e823","assignee":null,"assignees":[],"requested_reviewers":[{"login":"jzila","id":59594,"avatar_url":"https://avatars1.githubusercontent.com/u/59594?v=4","gravatar_id":"","url":"https://api.github.com/users/jzila","html_url":"https://github.com/jzila","followers_url":"https://api.github.com/users/jzila/followers","following_url":"https://api.github.com/users/jzila/following{/other_user}","gists_url":"https://api.github.com/users/jzila/gists{/gist_id}","starred_url":"https://api.github.com/users/jzila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jzila/subscriptions","organizations_url":"https://api.github.com/users/jzila/orgs","repos_url":"https://api.github.com/users/jzila/repos","events_url":"https://api.github.com/users/jzila/events{/privacy}","received_events_url":"https://api.github.com/users/jzila/received_events","type":"User","site_admin":false},{"login":"songgao","id":255797,"avatar_url":"https://avatars3.githubusercontent.com/u/255797?v=4","gravatar_id":"","url":"https://api.github.com/users/songgao","html_url":"https://github.com/songgao","followers_url":"https://api.github.com/users/songgao/followers","following_url":"https://api.github.com/users/songgao/following{/other_user}","gists_url":"https://api.github.com/users/songgao/gists{/gist_id}","starred_url":"https://api.github.com/users/songgao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/songgao/subscriptions","organizations_url":"https://api.github.com/users/songgao/orgs","repos_url":"https://api.github.com/users/songgao/repos","events_url":"https://api.github.com/users/songgao/events{/privacy}","received_events_url":"https://api.github.com/users/songgao/received_events","type":"User","site_admin":false},{"login":"akalin-keybase","id":13270622,"avatar_url":"https://avatars3.githubusercontent.com/u/13270622?v=4","gravatar_id":"","url":"https://api.github.com/users/akalin-keybase","html_url":"https://github.com/akalin-keybase","followers_url":"https://api.github.com/users/akalin-keybase/followers","following_url":"https://api.github.com/users/akalin-keybase/following{/other_user}","gists_url":"https://api.github.com/users/akalin-keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/akalin-keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/akalin-keybase/subscriptions","organizations_url":"https://api.github.com/users/akalin-keybase/orgs","repos_url":"https://api.github.com/users/akalin-keybase/repos","events_url":"https://api.github.com/users/akalin-keybase/events{/privacy}","received_events_url":"https://api.github.com/users/akalin-keybase/received_events","type":"User","site_admin":false}],"requested_teams":[],"labels":[],"milestone":null,"commits_url":"https://api.github.com/repos/keybase/kbfs/pulls/1496/commits","review_comments_url":"https://api.github.com/repos/keybase/kbfs/pulls/1496/comments","review_comment_url":"https://api.github.com/repos/keybase/kbfs/pulls/comments{/number}","comments_url":"https://api.github.com/repos/keybase/kbfs/issues/1496/comments","statuses_url":"https://api.github.com/repos/keybase/kbfs/statuses/a375bbaa852f7c4c5475526da029481d313d80e8","head":{"label":"keybase:strib/KBFS-2774-mount-redirector","ref":"strib/KBFS-2774-mount-redirector","sha":"a375bbaa852f7c4c5475526da029481d313d80e8","user":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"repo":{"id":59787605,"name":"kbfs","full_name":"keybase/kbfs","owner":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"private":false,"html_url":"https://github.com/keybase/kbfs","description":"Keybase Filesystem (KBFS)","fork":false,"url":"https://api.github.com/repos/keybase/kbfs","forks_url":"https://api.github.com/repos/keybase/kbfs/forks","keys_url":"https://api.github.com/repos/keybase/kbfs/keys{/key_id}","collaborators_url":"https://api.github.com/repos/keybase/kbfs/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/keybase/kbfs/teams","hooks_url":"https://api.github.com/repos/keybase/kbfs/hooks","issue_events_url":"https://api.github.com/repos/keybase/kbfs/issues/events{/number}","events_url":"https://api.github.com/repos/keybase/kbfs/events","assignees_url":"https://api.github.com/repos/keybase/kbfs/assignees{/user}","branches_url":"https://api.github.com/repos/keybase/kbfs/branches{/branch}","tags_url":"https://api.github.com/repos/keybase/kbfs/tags","blobs_url":"https://api.github.com/repos/keybase/kbfs/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/keybase/kbfs/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/keybase/kbfs/git/refs{/sha}","trees_url":"https://api.github.com/repos/keybase/kbfs/git/trees{/sha}","statuses_url":"https://api.github.com/repos/keybase/kbfs/statuses/{sha}","languages_url":"https://api.github.com/repos/keybase/kbfs/languages","stargazers_url":"https://api.github.com/repos/keybase/kbfs/stargazers","contributors_url":"https://api.github.com/repos/keybase/kbfs/contributors","subscribers_url":"https://api.github.com/repos/keybase/kbfs/subscribers","subscription_url":"https://api.github.com/repos/keybase/kbfs/subscription","commits_url":"https://api.github.com/repos/keybase/kbfs/commits{/sha}","git_commits_url":"https://api.github.com/repos/keybase/kbfs/git/commits{/sha}","comments_url":"https://api.github.com/repos/keybase/kbfs/comments{/number}","issue_comment_url":"https://api.github.com/repos/keybase/kbfs/issues/comments{/number}","contents_url":"https://api.github.com/repos/keybase/kbfs/contents/{+path}","compare_url":"https://api.github.com/repos/keybase/kbfs/compare/{base}...{head}","merges_url":"https://api.github.com/repos/keybase/kbfs/merges","archive_url":"https://api.github.com/repos/keybase/kbfs/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/keybase/kbfs/downloads","issues_url":"https://api.github.com/repos/keybase/kbfs/issues{/number}","pulls_url":"https://api.github.com/repos/keybase/kbfs/pulls{/number}","milestones_url":"https://api.github.com/repos/keybase/kbfs/milestones{/number}","notifications_url":"https://api.github.com/repos/keybase/kbfs/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/keybase/kbfs/labels{/name}","releases_url":"https://api.github.com/repos/keybase/kbfs/releases{/id}","deployments_url":"https://api.github.com/repos/keybase/kbfs/deployments","created_at":"2016-05-26T22:37:42Z","updated_at":"2018-02-28T02:25:38Z","pushed_at":"2018-02-28T21:03:09Z","git_url":"git://github.com/keybase/kbfs.git","ssh_url":"git@github.com:keybase/kbfs.git","clone_url":"https://github.com/keybase/kbfs.git","svn_url":"https://github.com/keybase/kbfs","homepage":"https://keybase.io/docs/kbfs","size":48520,"stargazers_count":885,"watchers_count":885,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"forks_count":76,"mirror_url":null,"archived":false,"open_issues_count":46,"license":{"key":"bsd-3-clause","name":"BSD 3-Clause \"New\" or \"Revised\" License","spdx_id":"BSD-3-Clause","url":"https://api.github.com/licenses/bsd-3-clause"},"forks":76,"open_issues":46,"watchers":885,"default_branch":"master"}},"base":{"label":"keybase:master","ref":"master","sha":"478a58b55a4605e2abe8699e32adc066bf1df7ee","user":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"repo":{"id":59787605,"name":"kbfs","full_name":"keybase/kbfs","owner":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"private":false,"html_url":"https://github.com/keybase/kbfs","description":"Keybase Filesystem (KBFS)","fork":false,"url":"https://api.github.com/repos/keybase/kbfs","forks_url":"https://api.github.com/repos/keybase/kbfs/forks","keys_url":"https://api.github.com/repos/keybase/kbfs/keys{/key_id}","collaborators_url":"https://api.github.com/repos/keybase/kbfs/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/keybase/kbfs/teams","hooks_url":"https://api.github.com/repos/keybase/kbfs/hooks","issue_events_url":"https://api.github.com/repos/keybase/kbfs/issues/events{/number}","events_url":"https://api.github.com/repos/keybase/kbfs/events","assignees_url":"https://api.github.com/repos/keybase/kbfs/assignees{/user}","branches_url":"https://api.github.com/repos/keybase/kbfs/branches{/branch}","tags_url":"https://api.github.com/repos/keybase/kbfs/tags","blobs_url":"https://api.github.com/repos/keybase/kbfs/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/keybase/kbfs/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/keybase/kbfs/git/refs{/sha}","trees_url":"https://api.github.com/repos/keybase/kbfs/git/trees{/sha}","statuses_url":"https://api.github.com/repos/keybase/kbfs/statuses/{sha}","languages_url":"https://api.github.com/repos/keybase/kbfs/languages","stargazers_url":"https://api.github.com/repos/keybase/kbfs/stargazers","contributors_url":"https://api.github.com/repos/keybase/kbfs/contributors","subscribers_url":"https://api.github.com/repos/keybase/kbfs/subscribers","subscription_url":"https://api.github.com/repos/keybase/kbfs/subscription","commits_url":"https://api.github.com/repos/keybase/kbfs/commits{/sha}","git_commits_url":"https://api.github.com/repos/keybase/kbfs/git/commits{/sha}","comments_url":"https://api.github.com/repos/keybase/kbfs/comments{/number}","issue_comment_url":"https://api.github.com/repos/keybase/kbfs/issues/comments{/number}","contents_url":"https://api.github.com/repos/keybase/kbfs/contents/{+path}","compare_url":"https://api.github.com/repos/keybase/kbfs/compare/{base}...{head}","merges_url":"https://api.github.com/repos/keybase/kbfs/merges","archive_url":"https://api.github.com/repos/keybase/kbfs/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/keybase/kbfs/downloads","issues_url":"https://api.github.com/repos/keybase/kbfs/issues{/number}","pulls_url":"https://api.github.com/repos/keybase/kbfs/pulls{/number}","milestones_url":"https://api.github.com/repos/keybase/kbfs/milestones{/number}","notifications_url":"https://api.github.com/repos/keybase/kbfs/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/keybase/kbfs/labels{/name}","releases_url":"https://api.github.com/repos/keybase/kbfs/releases{/id}","deployments_url":"https://api.github.com/repos/keybase/kbfs/deployments","created_at":"2016-05-26T22:37:42Z","updated_at":"2018-02-28T02:25:38Z","pushed_at":"2018-02-28T21:03:09Z","git_url":"git://github.com/keybase/kbfs.git","ssh_url":"git@github.com:keybase/kbfs.git","clone_url":"https://github.com/keybase/kbfs.git","svn_url":"https://github.com/keybase/kbfs","homepage":"https://keybase.io/docs/kbfs","size":48520,"stargazers_count":885,"watchers_count":885,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"forks_count":76,"mirror_url":null,"archived":false,"open_issues_count":46,"license":{"key":"bsd-3-clause","name":"BSD 3-Clause \"New\" or \"Revised\" License","spdx_id":"BSD-3-Clause","url":"https://api.github.com/licenses/bsd-3-clause"},"forks":76,"open_issues":46,"watchers":885,"default_branch":"master"}},"_links":{"self":{"href":"https://api.github.com/repos/keybase/kbfs/pulls/1496"},"html":{"href":"https://github.com/keybase/kbfs/pull/1496"},"issue":{"href":"https://api.github.com/repos/keybase/kbfs/issues/1496"},"comments":{"href":"https://api.github.com/repos/keybase/kbfs/issues/1496/comments"},"review_comments":{"href":"https://api.github.com/repos/keybase/kbfs/pulls/1496/comments"},"review_comment":{"href":"https://api.github.com/repos/keybase/kbfs/pulls/comments{/number}"},"commits":{"href":"https://api.github.com/repos/keybase/kbfs/pulls/1496/commits"},"statuses":{"href":"https://api.github.com/repos/keybase/kbfs/statuses/a375bbaa852f7c4c5475526da029481d313d80e8"}},"author_association":"CONTRIBUTOR"}},"public":true,"created_at":"2018-02-28T21:42:05Z","org":{"id":5400834,"login":"keybase","gravatar_id":"","url":"https://api.github.com/orgs/keybase","avatar_url":"https://avatars.githubusercontent.com/u/5400834?"}},{"id":"7312583967","type":"PushEvent","actor":{"id":860932,"login":"oconnor663","display_login":"oconnor663","gravatar_id":"","url":"https://api.github.com/users/oconnor663","avatar_url":"https://avatars.githubusercontent.com/u/860932?"},"repo":{"id":2226881,"name":"oconnor663/dotfiles","url":"https://api.github.com/repos/oconnor663/dotfiles"},"payload":{"push_id":2366700017,"size":1,"distinct_size":1,"ref":"refs/heads/master","head":"98f7420429020d5865423f4787558c7bf1540a60","before":"59e487cc6f9afee24749e6727a7734be6c07ae10","commits":[{"sha":"98f7420429020d5865423f4787558c7bf1540a60","author":{"email":"oconnor663@gmail.com","name":"Jack O'Connor"},"message":"fu","distinct":true,"url":"https://api.github.com/repos/oconnor663/dotfiles/commits/98f7420429020d5865423f4787558c7bf1540a60"}]},"public":true,"created_at":"2018-02-28T21:30:34Z"},{"id":"7312537288","type":"PullRequestReviewCommentEvent","actor":{"id":860932,"login":"oconnor663","display_login":"oconnor663","gravatar_id":"","url":"https://api.github.com/users/oconnor663","avatar_url":"https://avatars.githubusercontent.com/u/860932?"},"repo":{"id":29099181,"name":"keybase/client","url":"https://api.github.com/repos/keybase/client"},"payload":{"action":"created","comment":{"url":"https://api.github.com/repos/keybase/client/pulls/comments/171388549","pull_request_review_id":100232921,"id":171388549,"diff_hunk":"@@ -0,0 +1,147 @@\n+package libkb\n+\n+import (\n+\tsha512 \"crypto/sha512\"\n+\tjson \"encoding/json\"\n+\tfmt \"fmt\"\n+\tkeybase1 \"github.com/keybase/client/go/protocol/keybase1\"\n+\tjsonw \"github.com/keybase/go-jsonw\"\n+\tcontext \"golang.org/x/net/context\"\n+)\n+\n+type resetLinkAndHash struct {\n+\tlink keybase1.ResetLink\n+\thash keybase1.SHA512\n+}\n+\n+type unverifiedResetChain []resetLinkAndHash\n+\n+func importResetLinkAndHash(s string) (ret *resetLinkAndHash, err error) {\n+\tb := []byte(s)\n+\thash := sha512.Sum512(b)\n+\tvar link keybase1.ResetLink\n+\terr = json.Unmarshal(b, &link)\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\tret = &resetLinkAndHash{\n+\t\thash: hash[:],\n+\t\tlink: link,\n+\t}\n+\treturn ret, nil\n+}\n+\n+func importResetChainFromServer(ctx context.Context, g *GlobalContext, jw *jsonw.Wrapper) (urc unverifiedResetChain, err error) {\n+\tdefer g.CVTrace(ctx, VLog0, \"importResetChainFromServer\", func() error { return err })()\n+\tif jw == nil || jw.IsNil() {\n+\t\treturn nil, nil\n+\t}\n+\tvar ret unverifiedResetChain\n+\tchainLen, err := jw.Len()\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\tfor i := 0; i < chainLen; i++ {\n+\t\ts, err := jw.AtIndex(i).GetString()\n+\t\tif err != nil {\n+\t\t\treturn nil, err\n+\t\t}\n+\t\tlink, err := importResetLinkAndHash(s)\n+\t\tif err != nil {\n+\t\t\treturn nil, err\n+\t\t}\n+\t\tret = append(ret, *link)\n+\t}\n+\treturn ret, nil\n+}\n+\n+func parseV2LeafResetChainTail(jw *jsonw.Wrapper) (*MerkleResets, error) {\n+\tif jw == nil || jw.IsNil() {\n+\t\treturn nil, nil\n+\t}\n+\tl, err := jw.Len()\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\tif l == 0 {\n+\t\treturn nil, nil\n+\t}\n+\tif l != 2 {\n+\t\treturn nil, MerkleClientError{m: \"bad reset chain tail; expecting 2 items\", t: merkleErrorBadResetChain}\n+\t}\n+\tvar ct MerkleResetChainTail\n+\tif err := jw.AtIndex(0).UnmarshalAgain(&ct.Seqno); err != nil {\n+\t\treturn nil, err\n+\t}\n+\tif err := jw.AtIndex(1).UnmarshalAgain(&ct.Hash); err != nil {\n+\t\treturn nil, err\n+\t}\n+\tret := &MerkleResets{chainTail: ct}\n+\treturn ret, nil\n+}\n+\n+type MerkleResetChainTail struct {\n+\tSeqno keybase1.Seqno\n+\tHash  keybase1.SHA512\n+}\n+\n+type MerkleResets struct {\n+\tchainTail MerkleResetChainTail\n+\tchain     []keybase1.ResetLink\n+}\n+\n+func (mr *MerkleResets) verifyAndLoad(ctx context.Context, g *GlobalContext, urc unverifiedResetChain) (err error) {\n+\n+\t// Don't even both a trace if the user hasn't reset at all","path":"go/libkb/merkle_reset_chain.go","position":95,"original_position":95,"commit_id":"4a365bba8092b075cb01315d60277b97abb4b354","original_commit_id":"4a365bba8092b075cb01315d60277b97abb4b354","user":{"login":"oconnor663","id":860932,"avatar_url":"https://avatars0.githubusercontent.com/u/860932?v=4","gravatar_id":"","url":"https://api.github.com/users/oconnor663","html_url":"https://github.com/oconnor663","followers_url":"https://api.github.com/users/oconnor663/followers","following_url":"https://api.github.com/users/oconnor663/following{/other_user}","gists_url":"https://api.github.com/users/oconnor663/gists{/gist_id}","starred_url":"https://api.github.com/users/oconnor663/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oconnor663/subscriptions","organizations_url":"https://api.github.com/users/oconnor663/orgs","repos_url":"https://api.github.com/users/oconnor663/repos","events_url":"https://api.github.com/users/oconnor663/events{/privacy}","received_events_url":"https://api.github.com/users/oconnor663/received_events","type":"User","site_admin":false},"body":"Some typo here.","created_at":"2018-02-28T21:20:12Z","updated_at":"2018-02-28T21:20:12Z","html_url":"https://github.com/keybase/client/pull/10726#discussion_r171388549","pull_request_url":"https://api.github.com/repos/keybase/client/pulls/10726","author_association":"CONTRIBUTOR","_links":{"self":{"href":"https://api.github.com/repos/keybase/client/pulls/comments/171388549"},"html":{"href":"https://github.com/keybase/client/pull/10726#discussion_r171388549"},"pull_request":{"href":"https://api.github.com/repos/keybase/client/pulls/10726"}}},"pull_request":{"url":"https://api.github.com/repos/keybase/client/pulls/10726","id":171965169,"html_url":"https://github.com/keybase/client/pull/10726","diff_url":"https://github.com/keybase/client/pull/10726.diff","patch_url":"https://github.com/keybase/client/pull/10726.patch","issue_url":"https://api.github.com/repos/keybase/client/issues/10726","number":10726,"state":"open","locked":false,"title":"Digest merkle reset chain; expose in UPAK2","user":{"login":"maxtaco","id":866815,"avatar_url":"https://avatars0.githubusercontent.com/u/866815?v=4","gravatar_id":"","url":"https://api.github.com/users/maxtaco","html_url":"https://github.com/maxtaco","followers_url":"https://api.github.com/users/maxtaco/followers","following_url":"https://api.github.com/users/maxtaco/following{/other_user}","gists_url":"https://api.github.com/users/maxtaco/gists{/gist_id}","starred_url":"https://api.github.com/users/maxtaco/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maxtaco/subscriptions","organizations_url":"https://api.github.com/users/maxtaco/orgs","repos_url":"https://api.github.com/users/maxtaco/repos","events_url":"https://api.github.com/users/maxtaco/events{/privacy}","received_events_url":"https://api.github.com/users/maxtaco/received_events","type":"User","site_admin":false},"body":"- plumb resets and verification of the reset chain through the merkle client\r\n- this requires a minor UPK bump for UPAK minor version <= 5, if there is a reset.\r\n- if no reset, and UPAK minor version 5, then we can stick with it\r\n- piggy-back testing on an existing test: TestExportAllIncarnationsAfterReset","created_at":"2018-02-28T14:16:07Z","updated_at":"2018-02-28T21:20:12Z","closed_at":null,"merged_at":null,"merge_commit_sha":"c42a27300807204381eec4273251b84974b248f5","assignee":null,"assignees":[],"requested_reviewers":[],"requested_teams":[],"labels":[],"milestone":null,"commits_url":"https://api.github.com/repos/keybase/client/pulls/10726/commits","review_comments_url":"https://api.github.com/repos/keybase/client/pulls/10726/comments","review_comment_url":"https://api.github.com/repos/keybase/client/pulls/comments{/number}","comments_url":"https://api.github.com/repos/keybase/client/issues/10726/comments","statuses_url":"https://api.github.com/repos/keybase/client/statuses/4a365bba8092b075cb01315d60277b97abb4b354","head":{"label":"keybase:maxtaco/CORE-7107","ref":"maxtaco/CORE-7107","sha":"4a365bba8092b075cb01315d60277b97abb4b354","user":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"repo":{"id":29099181,"name":"client","full_name":"keybase/client","owner":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"private":false,"html_url":"https://github.com/keybase/client","description":"Keybase Go Library, Client, Service, OS X, iOS, Android, Electron","fork":false,"url":"https://api.github.com/repos/keybase/client","forks_url":"https://api.github.com/repos/keybase/client/forks","keys_url":"https://api.github.com/repos/keybase/client/keys{/key_id}","collaborators_url":"https://api.github.com/repos/keybase/client/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/keybase/client/teams","hooks_url":"https://api.github.com/repos/keybase/client/hooks","issue_events_url":"https://api.github.com/repos/keybase/client/issues/events{/number}","events_url":"https://api.github.com/repos/keybase/client/events","assignees_url":"https://api.github.com/repos/keybase/client/assignees{/user}","branches_url":"https://api.github.com/repos/keybase/client/branches{/branch}","tags_url":"https://api.github.com/repos/keybase/client/tags","blobs_url":"https://api.github.com/repos/keybase/client/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/keybase/client/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/keybase/client/git/refs{/sha}","trees_url":"https://api.github.com/repos/keybase/client/git/trees{/sha}","statuses_url":"https://api.github.com/repos/keybase/client/statuses/{sha}","languages_url":"https://api.github.com/repos/keybase/client/languages","stargazers_url":"https://api.github.com/repos/keybase/client/stargazers","contributors_url":"https://api.github.com/repos/keybase/client/contributors","subscribers_url":"https://api.github.com/repos/keybase/client/subscribers","subscription_url":"https://api.github.com/repos/keybase/client/subscription","commits_url":"https://api.github.com/repos/keybase/client/commits{/sha}","git_commits_url":"https://api.github.com/repos/keybase/client/git/commits{/sha}","comments_url":"https://api.github.com/repos/keybase/client/comments{/number}","issue_comment_url":"https://api.github.com/repos/keybase/client/issues/comments{/number}","contents_url":"https://api.github.com/repos/keybase/client/contents/{+path}","compare_url":"https://api.github.com/repos/keybase/client/compare/{base}...{head}","merges_url":"https://api.github.com/repos/keybase/client/merges","archive_url":"https://api.github.com/repos/keybase/client/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/keybase/client/downloads","issues_url":"https://api.github.com/repos/keybase/client/issues{/number}","pulls_url":"https://api.github.com/repos/keybase/client/pulls{/number}","milestones_url":"https://api.github.com/repos/keybase/client/milestones{/number}","notifications_url":"https://api.github.com/repos/keybase/client/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/keybase/client/labels{/name}","releases_url":"https://api.github.com/repos/keybase/client/releases{/id}","deployments_url":"https://api.github.com/repos/keybase/client/deployments","created_at":"2015-01-11T17:17:12Z","updated_at":"2018-02-28T15:16:50Z","pushed_at":"2018-02-28T21:20:46Z","git_url":"git://github.com/keybase/client.git","ssh_url":"git@github.com:keybase/client.git","clone_url":"https://github.com/keybase/client.git","svn_url":"https://github.com/keybase/client","homepage":"","size":223155,"stargazers_count":3296,"watchers_count":3296,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"forks_count":316,"mirror_url":null,"archived":false,"open_issues_count":1892,"license":{"key":"bsd-3-clause","name":"BSD 3-Clause \"New\" or \"Revised\" License","spdx_id":"BSD-3-Clause","url":"https://api.github.com/licenses/bsd-3-clause"},"forks":316,"open_issues":1892,"watchers":3296,"default_branch":"master"}},"base":{"label":"keybase:master","ref":"master","sha":"d55b2546d7ec377a49c9e8230ffd949e7ce9446a","user":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"repo":{"id":29099181,"name":"client","full_name":"keybase/client","owner":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"private":false,"html_url":"https://github.com/keybase/client","description":"Keybase Go Library, Client, Service, OS X, iOS, Android, Electron","fork":false,"url":"https://api.github.com/repos/keybase/client","forks_url":"https://api.github.com/repos/keybase/client/forks","keys_url":"https://api.github.com/repos/keybase/client/keys{/key_id}","collaborators_url":"https://api.github.com/repos/keybase/client/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/keybase/client/teams","hooks_url":"https://api.github.com/repos/keybase/client/hooks","issue_events_url":"https://api.github.com/repos/keybase/client/issues/events{/number}","events_url":"https://api.github.com/repos/keybase/client/events","assignees_url":"https://api.github.com/repos/keybase/client/assignees{/user}","branches_url":"https://api.github.com/repos/keybase/client/branches{/branch}","tags_url":"https://api.github.com/repos/keybase/client/tags","blobs_url":"https://api.github.com/repos/keybase/client/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/keybase/client/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/keybase/client/git/refs{/sha}","trees_url":"https://api.github.com/repos/keybase/client/git/trees{/sha}","statuses_url":"https://api.github.com/repos/keybase/client/statuses/{sha}","languages_url":"https://api.github.com/repos/keybase/client/languages","stargazers_url":"https://api.github.com/repos/keybase/client/stargazers","contributors_url":"https://api.github.com/repos/keybase/client/contributors","subscribers_url":"https://api.github.com/repos/keybase/client/subscribers","subscription_url":"https://api.github.com/repos/keybase/client/subscription","commits_url":"https://api.github.com/repos/keybase/client/commits{/sha}","git_commits_url":"https://api.github.com/repos/keybase/client/git/commits{/sha}","comments_url":"https://api.github.com/repos/keybase/client/comments{/number}","issue_comment_url":"https://api.github.com/repos/keybase/client/issues/comments{/number}","contents_url":"https://api.github.com/repos/keybase/client/contents/{+path}","compare_url":"https://api.github.com/repos/keybase/client/compare/{base}...{head}","merges_url":"https://api.github.com/repos/keybase/client/merges","archive_url":"https://api.github.com/repos/keybase/client/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/keybase/client/downloads","issues_url":"https://api.github.com/repos/keybase/client/issues{/number}","pulls_url":"https://api.github.com/repos/keybase/client/pulls{/number}","milestones_url":"https://api.github.com/repos/keybase/client/milestones{/number}","notifications_url":"https://api.github.com/repos/keybase/client/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/keybase/client/labels{/name}","releases_url":"https://api.github.com/repos/keybase/client/releases{/id}","deployments_url":"https://api.github.com/repos/keybase/client/deployments","created_at":"2015-01-11T17:17:12Z","updated_at":"2018-02-28T15:16:50Z","pushed_at":"2018-02-28T21:20:46Z","git_url":"git://github.com/keybase/client.git","ssh_url":"git@github.com:keybase/client.git","clone_url":"https://github.com/keybase/client.git","svn_url":"https://github.com/keybase/client","homepage":"","size":223155,"stargazers_count":3296,"watchers_count":3296,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"forks_count":316,"mirror_url":null,"archived":false,"open_issues_count":1892,"license":{"key":"bsd-3-clause","name":"BSD 3-Clause \"New\" or \"Revised\" License","spdx_id":"BSD-3-Clause","url":"https://api.github.com/licenses/bsd-3-clause"},"forks":316,"open_issues":1892,"watchers":3296,"default_branch":"master"}},"_links":{"self":{"href":"https://api.github.com/repos/keybase/client/pulls/10726"},"html":{"href":"https://github.com/keybase/client/pull/10726"},"issue":{"href":"https://api.github.com/repos/keybase/client/issues/10726"},"comments":{"href":"https://api.github.com/repos/keybase/client/issues/10726/comments"},"review_comments":{"href":"https://api.github.com/repos/keybase/client/pulls/10726/comments"},"review_comment":{"href":"https://api.github.com/repos/keybase/client/pulls/comments{/number}"},"commits":{"href":"https://api.github.com/repos/keybase/client/pulls/10726/commits"},"statuses":{"href":"https://api.github.com/repos/keybase/client/statuses/4a365bba8092b075cb01315d60277b97abb4b354"}},"author_association":"CONTRIBUTOR"}},"public":true,"created_at":"2018-02-28T21:20:12Z","org":{"id":5400834,"login":"keybase","gravatar_id":"","url":"https://api.github.com/orgs/keybase","avatar_url":"https://avatars.githubusercontent.com/u/5400834?"}},{"id":"7312471313","type":"PullRequestReviewCommentEvent","actor":{"id":860932,"login":"oconnor663","display_login":"oconnor663","gravatar_id":"","url":"https://api.github.com/users/oconnor663","avatar_url":"https://avatars.githubusercontent.com/u/860932?"},"repo":{"id":59787605,"name":"keybase/kbfs","url":"https://api.github.com/repos/keybase/kbfs"},"payload":{"action":"created","comment":{"url":"https://api.github.com/repos/keybase/kbfs/pulls/comments/171385042","pull_request_review_id":100228734,"id":171385042,"diff_hunk":"@@ -0,0 +1,267 @@\n+// Copyright 2018 Keybase Inc. All rights reserved.\n+// Use of this source code is governed by a BSD\n+// license that can be found in the LICENSE file.\n+\n+package main\n+\n+import (\n+\t\"context\"\n+\t\"fmt\"\n+\t\"os\"\n+\t\"os/signal\"\n+\t\"os/user\"\n+\t\"path/filepath\"\n+\t\"runtime\"\n+\t\"sort\"\n+\t\"strconv\"\n+\t\"strings\"\n+\t\"sync\"\n+\t\"syscall\"\n+\t\"time\"\n+\n+\t\"bazil.org/fuse\"\n+\t\"bazil.org/fuse/fs\"\n+\t\"github.com/strib/gomounts\"\n+)\n+\n+var kbfusePath = fuse.OSXFUSEPaths{\n+\tDevicePrefix: \"/dev/kbfuse\",\n+\tLoad:         \"/Library/Filesystems/kbfuse.fs/Contents/Resources/load_kbfuse\",\n+\tMount:        \"/Library/Filesystems/kbfuse.fs/Contents/Resources/mount_kbfuse\",\n+\tDaemonVar:    \"MOUNT_KBFUSE_DAEMON_PATH\",\n+}\n+\n+const (\n+\tmountpointTimeout = 5 * time.Second\n+)\n+\n+type symlink struct {\n+\tlink string\n+}\n+\n+func (s symlink) Attr(ctx context.Context, a *fuse.Attr) (err error) {\n+\ta.Mode = os.ModeSymlink | a.Mode | 0555\n+\ta.Valid = 0\n+\treturn nil\n+}\n+\n+func (s symlink) Readlink(ctx context.Context, req *fuse.ReadlinkRequest) (\n+\tlink string, err error) {\n+\treturn s.link, nil\n+}\n+\n+type cacheEntry struct {\n+\tmountpoint string\n+\ttime       time.Time\n+}\n+\n+type root struct {\n+\tlock            sync.RWMutex\n+\tmountpointCache map[uint32]cacheEntry\n+}\n+\n+func newRoot() *root {\n+\treturn &root{\n+\t\tmountpointCache: make(map[uint32]cacheEntry),\n+\t}\n+}\n+\n+func (r *root) Root() (fs.Node, error) {\n+\treturn r, nil\n+}\n+\n+func (r *root) Attr(ctx context.Context, attr *fuse.Attr) error {\n+\tattr.Mode = os.ModeDir | 0555\n+\treturn nil\n+}\n+\n+func (r *root) getCachedMountpoint(uid uint32) string {\n+\tr.lock.RLock()\n+\tdefer r.lock.RUnlock()\n+\tentry, ok := r.mountpointCache[uid]\n+\tif !ok {\n+\t\treturn \"\"\n+\t}\n+\tnow := time.Now()\n+\tif now.Sub(entry.time) > mountpointTimeout {\n+\t\t// Don't bother deleting the entry, since the caller should\n+\t\t// just overwrite it.\n+\t\treturn \"\"\n+\t}\n+\treturn entry.mountpoint\n+}\n+\n+func (r *root) findKBFSMount(ctx context.Context) (\n+\tmountpoint string, err error) {\n+\tuid := ctx.Value(fs.CtxHeaderUIDKey).(uint32)\n+\t// Don't let the root see anything here; we don't want a symlink\n+\t// loop back to this mount.\n+\tif uid == 0 {\n+\t\treturn \"\", fuse.ENOENT\n+\t}\n+\n+\tmountpoint = r.getCachedMountpoint(uid)\n+\tif mountpoint != \"\" {\n+\t\treturn mountpoint, nil\n+\t}\n+\n+\tdefer func() {\n+\t\tif err != nil {\n+\t\t\treturn\n+\t\t}\n+\t\t// Cache the entry if we didn't hit an error.\n+\t\tr.lock.Lock()\n+\t\tdefer r.lock.Unlock()\n+\t\tr.mountpointCache[uid] = cacheEntry{\n+\t\t\tmountpoint: mountpoint,\n+\t\t\ttime:       time.Now(),\n+\t\t}\n+\t}()\n+\n+\tu, err := user.LookupId(strconv.FormatUint(uint64(uid), 10))\n+\tif err != nil {\n+\t\treturn \"\", err\n+\t}\n+\n+\tvols, err := gomounts.GetMountedVolumes()\n+\tif err != nil {\n+\t\treturn \"\", err\n+\t}\n+\tfuseType := \"fuse\"\n+\tif runtime.GOOS == \"darwin\" {\n+\t\tfuseType = \"kbfuse\"\n+\t}\n+\tvar fuseMountPoints []string\n+\tfor _, v := range vols {\n+\t\tif v.Type != fuseType {\n+\t\t\tcontinue\n+\t\t}\n+\t\tif v.Owner != u.Uid {\n+\t\t\tcontinue\n+\t\t}\n+\t\tfuseMountPoints = append(fuseMountPoints, v.Path)\n+\t}\n+\n+\tif len(fuseMountPoints) == 0 {\n+\t\treturn \"\", fuse.ENOENT\n+\t}\n+\tif len(fuseMountPoints) == 1 {\n+\t\treturn fuseMountPoints[0], nil\n+\t}\n+\n+\t// If there is more than one, pick the first one alphabetically\n+\t// that has \"keybase\" in the path.\n+\tsort.Strings(fuseMountPoints)\n+\tfor _, mp := range fuseMountPoints {\n+\t\t// TODO: a better regexp that will rule out keybase.staging if\n+\t\t// we're in prod mode, etc.\n+\t\tif !strings.Contains(mp, \"keybase\") {\n+\t\t\tcontinue\n+\t\t}\n+\t\t// Double-check that this is a real KBFS mount.\n+\t\tif _, err := os.Stat(filepath.Join(mp, \".kbfs_error\")); err != nil {\n+\t\t\tcontinue\n+\t\t}\n+\t\treturn mp, nil\n+\t}\n+\n+\t// Give up and return the first one.\n+\treturn fuseMountPoints[0], nil\n+}\n+\n+func (r *root) ReadDirAll(ctx context.Context) ([]fuse.Dirent, error) {\n+\t_, err := r.findKBFSMount(ctx)\n+\tif err != nil {\n+\t\tif err == fuse.ENOENT {\n+\t\t\treturn []fuse.Dirent{}, nil\n+\t\t} else {\n+\t\t\treturn []fuse.Dirent{}, err\n+\t\t}\n+\t}\n+\n+\t// TODO: show the `kbfs.error.txt\" and \"kbfs.nologin.txt\" files if\n+\t// they exist?  As root, it is hard to figure out if they're\n+\t// there, though.\n+\treturn []fuse.Dirent{\n+\t\t{\n+\t\t\tType: fuse.DT_Link,\n+\t\t\tName: \"private\",\n+\t\t},\n+\t\t{\n+\t\t\tType: fuse.DT_Link,\n+\t\t\tName: \"public\",\n+\t\t},\n+\t\tfuse.Dirent{\n+\t\t\tType: fuse.DT_Link,\n+\t\t\tName: \"team\",\n+\t\t},\n+\t}, nil\n+}\n+\n+func (r *root) Lookup(\n+\tctx context.Context, req *fuse.LookupRequest, resp *fuse.LookupResponse) (\n+\tn fs.Node, err error) {\n+\tmountpoint, err := r.findKBFSMount(ctx)\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\n+\tresp.EntryValid = 0\n+\tswitch req.Name {\n+\tcase \"private\", \"public\", \"team\", \".kbfs_error\", \".kbfs_metrics\",\n+\t\t\".kbfs_profiles\", \".kbfs_reset_caches\", \".kbfs_status\",\n+\t\t\"kbfs.error.txt\", \"kbfs.nologin.txt\", \".kbfs_enable_auto_journals\",\n+\t\t\".kbfs_disable_auto_journals\", \".kbfs_enable_block_prefetching\",\n+\t\t\".kbfs_disable_block_prefetching\", \".kbfs_enable_debug_server\",\n+\t\t\".kbfs_disable_debug_server\":\n+\t\treturn symlink{filepath.Join(mountpoint, req.Name)}, nil\n+\t}\n+\treturn nil, fuse.ENOENT\n+}\n+\n+func main() {\n+\tcurrUser, err := user.Current()\n+\tif err != nil {\n+\t\tpanic(err)\n+\t}\n+\tif currUser.Uid != \"0\" {\n+\t\truntime.LockOSThread()\n+\t\t_, _, errNo := syscall.Syscall(syscall.SYS_SETUID, 0, 0, 0)","path":"redirector/go/main.go","position":228,"original_position":229,"commit_id":"a375bbaa852f7c4c5475526da029481d313d80e8","original_commit_id":"4a9c54931293f10b5568f92acdec99a7e74547c5","user":{"login":"oconnor663","id":860932,"avatar_url":"https://avatars0.githubusercontent.com/u/860932?v=4","gravatar_id":"","url":"https://api.github.com/users/oconnor663","html_url":"https://github.com/oconnor663","followers_url":"https://api.github.com/users/oconnor663/followers","following_url":"https://api.github.com/users/oconnor663/following{/other_user}","gists_url":"https://api.github.com/users/oconnor663/gists{/gist_id}","starred_url":"https://api.github.com/users/oconnor663/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oconnor663/subscriptions","organizations_url":"https://api.github.com/users/oconnor663/orgs","repos_url":"https://api.github.com/users/oconnor663/repos","events_url":"https://api.github.com/users/oconnor663/events{/privacy}","received_events_url":"https://api.github.com/users/oconnor663/received_events","type":"User","site_admin":false},"body":"Help me understand what happens if we don't make this call? My Rust redirector doesn't do any SUID step, but if I `chmod 4755` the binary, then I'm able to point it at a regular `0x755 root:root` directory and mount with no problems.","created_at":"2018-02-28T21:06:39Z","updated_at":"2018-02-28T21:06:39Z","html_url":"https://github.com/keybase/kbfs/pull/1496#discussion_r171385042","pull_request_url":"https://api.github.com/repos/keybase/kbfs/pulls/1496","author_association":"CONTRIBUTOR","_links":{"self":{"href":"https://api.github.com/repos/keybase/kbfs/pulls/comments/171385042"},"html":{"href":"https://github.com/keybase/kbfs/pull/1496#discussion_r171385042"},"pull_request":{"href":"https://api.github.com/repos/keybase/kbfs/pulls/1496"}}},"pull_request":{"url":"https://api.github.com/repos/keybase/kbfs/pulls/1496","id":172070599,"html_url":"https://github.com/keybase/kbfs/pull/1496","diff_url":"https://github.com/keybase/kbfs/pull/1496.diff","patch_url":"https://github.com/keybase/kbfs/pull/1496.patch","issue_url":"https://api.github.com/repos/keybase/kbfs/issues/1496","number":1496,"state":"open","locked":false,"title":"redirector: a Go implementation for the root redirector","user":{"login":"strib","id":8516691,"avatar_url":"https://avatars0.githubusercontent.com/u/8516691?v=4","gravatar_id":"","url":"https://api.github.com/users/strib","html_url":"https://github.com/strib","followers_url":"https://api.github.com/users/strib/followers","following_url":"https://api.github.com/users/strib/following{/other_user}","gists_url":"https://api.github.com/users/strib/gists{/gist_id}","starred_url":"https://api.github.com/users/strib/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/strib/subscriptions","organizations_url":"https://api.github.com/users/strib/orgs","repos_url":"https://api.github.com/users/strib/repos","events_url":"https://api.github.com/users/strib/events{/privacy}","received_events_url":"https://api.github.com/users/strib/received_events","type":"User","site_admin":false},"body":"This implementation of the root redirector will likely be used for macOS, at least until we figure out the kbfuse+Rust situation.\r\n\r\nNote that I needed some new bazil.org/fuse options, so I forked it to github.comkeybase/fuse and added two new features:\r\n* A NoBrowse() option that keeps the redirector from showing up in the Finder (instead, the specific user's mount will show up).\r\n* Adding the requesting user's UID to the context for every request, since `ReadDirAll` needs to know whether the requesting user has a valid mountpoint or not.  The bazil.org/fuse interface for `ReadDirAll` doesn't pass this down, so putting it in the context seemed like the easiest option for now.\r\n\r\nIssue: KBFS-2774","created_at":"2018-02-28T20:58:07Z","updated_at":"2018-02-28T21:06:39Z","closed_at":null,"merged_at":null,"merge_commit_sha":"437c5c76f895a2fc4092ddecb665a8ea1424e823","assignee":null,"assignees":[],"requested_reviewers":[{"login":"jzila","id":59594,"avatar_url":"https://avatars1.githubusercontent.com/u/59594?v=4","gravatar_id":"","url":"https://api.github.com/users/jzila","html_url":"https://github.com/jzila","followers_url":"https://api.github.com/users/jzila/followers","following_url":"https://api.github.com/users/jzila/following{/other_user}","gists_url":"https://api.github.com/users/jzila/gists{/gist_id}","starred_url":"https://api.github.com/users/jzila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jzila/subscriptions","organizations_url":"https://api.github.com/users/jzila/orgs","repos_url":"https://api.github.com/users/jzila/repos","events_url":"https://api.github.com/users/jzila/events{/privacy}","received_events_url":"https://api.github.com/users/jzila/received_events","type":"User","site_admin":false},{"login":"songgao","id":255797,"avatar_url":"https://avatars3.githubusercontent.com/u/255797?v=4","gravatar_id":"","url":"https://api.github.com/users/songgao","html_url":"https://github.com/songgao","followers_url":"https://api.github.com/users/songgao/followers","following_url":"https://api.github.com/users/songgao/following{/other_user}","gists_url":"https://api.github.com/users/songgao/gists{/gist_id}","starred_url":"https://api.github.com/users/songgao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/songgao/subscriptions","organizations_url":"https://api.github.com/users/songgao/orgs","repos_url":"https://api.github.com/users/songgao/repos","events_url":"https://api.github.com/users/songgao/events{/privacy}","received_events_url":"https://api.github.com/users/songgao/received_events","type":"User","site_admin":false},{"login":"akalin-keybase","id":13270622,"avatar_url":"https://avatars3.githubusercontent.com/u/13270622?v=4","gravatar_id":"","url":"https://api.github.com/users/akalin-keybase","html_url":"https://github.com/akalin-keybase","followers_url":"https://api.github.com/users/akalin-keybase/followers","following_url":"https://api.github.com/users/akalin-keybase/following{/other_user}","gists_url":"https://api.github.com/users/akalin-keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/akalin-keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/akalin-keybase/subscriptions","organizations_url":"https://api.github.com/users/akalin-keybase/orgs","repos_url":"https://api.github.com/users/akalin-keybase/repos","events_url":"https://api.github.com/users/akalin-keybase/events{/privacy}","received_events_url":"https://api.github.com/users/akalin-keybase/received_events","type":"User","site_admin":false}],"requested_teams":[],"labels":[],"milestone":null,"commits_url":"https://api.github.com/repos/keybase/kbfs/pulls/1496/commits","review_comments_url":"https://api.github.com/repos/keybase/kbfs/pulls/1496/comments","review_comment_url":"https://api.github.com/repos/keybase/kbfs/pulls/comments{/number}","comments_url":"https://api.github.com/repos/keybase/kbfs/issues/1496/comments","statuses_url":"https://api.github.com/repos/keybase/kbfs/statuses/a375bbaa852f7c4c5475526da029481d313d80e8","head":{"label":"keybase:strib/KBFS-2774-mount-redirector","ref":"strib/KBFS-2774-mount-redirector","sha":"a375bbaa852f7c4c5475526da029481d313d80e8","user":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"repo":{"id":59787605,"name":"kbfs","full_name":"keybase/kbfs","owner":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"private":false,"html_url":"https://github.com/keybase/kbfs","description":"Keybase Filesystem (KBFS)","fork":false,"url":"https://api.github.com/repos/keybase/kbfs","forks_url":"https://api.github.com/repos/keybase/kbfs/forks","keys_url":"https://api.github.com/repos/keybase/kbfs/keys{/key_id}","collaborators_url":"https://api.github.com/repos/keybase/kbfs/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/keybase/kbfs/teams","hooks_url":"https://api.github.com/repos/keybase/kbfs/hooks","issue_events_url":"https://api.github.com/repos/keybase/kbfs/issues/events{/number}","events_url":"https://api.github.com/repos/keybase/kbfs/events","assignees_url":"https://api.github.com/repos/keybase/kbfs/assignees{/user}","branches_url":"https://api.github.com/repos/keybase/kbfs/branches{/branch}","tags_url":"https://api.github.com/repos/keybase/kbfs/tags","blobs_url":"https://api.github.com/repos/keybase/kbfs/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/keybase/kbfs/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/keybase/kbfs/git/refs{/sha}","trees_url":"https://api.github.com/repos/keybase/kbfs/git/trees{/sha}","statuses_url":"https://api.github.com/repos/keybase/kbfs/statuses/{sha}","languages_url":"https://api.github.com/repos/keybase/kbfs/languages","stargazers_url":"https://api.github.com/repos/keybase/kbfs/stargazers","contributors_url":"https://api.github.com/repos/keybase/kbfs/contributors","subscribers_url":"https://api.github.com/repos/keybase/kbfs/subscribers","subscription_url":"https://api.github.com/repos/keybase/kbfs/subscription","commits_url":"https://api.github.com/repos/keybase/kbfs/commits{/sha}","git_commits_url":"https://api.github.com/repos/keybase/kbfs/git/commits{/sha}","comments_url":"https://api.github.com/repos/keybase/kbfs/comments{/number}","issue_comment_url":"https://api.github.com/repos/keybase/kbfs/issues/comments{/number}","contents_url":"https://api.github.com/repos/keybase/kbfs/contents/{+path}","compare_url":"https://api.github.com/repos/keybase/kbfs/compare/{base}...{head}","merges_url":"https://api.github.com/repos/keybase/kbfs/merges","archive_url":"https://api.github.com/repos/keybase/kbfs/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/keybase/kbfs/downloads","issues_url":"https://api.github.com/repos/keybase/kbfs/issues{/number}","pulls_url":"https://api.github.com/repos/keybase/kbfs/pulls{/number}","milestones_url":"https://api.github.com/repos/keybase/kbfs/milestones{/number}","notifications_url":"https://api.github.com/repos/keybase/kbfs/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/keybase/kbfs/labels{/name}","releases_url":"https://api.github.com/repos/keybase/kbfs/releases{/id}","deployments_url":"https://api.github.com/repos/keybase/kbfs/deployments","created_at":"2016-05-26T22:37:42Z","updated_at":"2018-02-28T02:25:38Z","pushed_at":"2018-02-28T21:03:09Z","git_url":"git://github.com/keybase/kbfs.git","ssh_url":"git@github.com:keybase/kbfs.git","clone_url":"https://github.com/keybase/kbfs.git","svn_url":"https://github.com/keybase/kbfs","homepage":"https://keybase.io/docs/kbfs","size":48520,"stargazers_count":885,"watchers_count":885,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"forks_count":76,"mirror_url":null,"archived":false,"open_issues_count":46,"license":{"key":"bsd-3-clause","name":"BSD 3-Clause \"New\" or \"Revised\" License","spdx_id":"BSD-3-Clause","url":"https://api.github.com/licenses/bsd-3-clause"},"forks":76,"open_issues":46,"watchers":885,"default_branch":"master"}},"base":{"label":"keybase:master","ref":"master","sha":"478a58b55a4605e2abe8699e32adc066bf1df7ee","user":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"repo":{"id":59787605,"name":"kbfs","full_name":"keybase/kbfs","owner":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"private":false,"html_url":"https://github.com/keybase/kbfs","description":"Keybase Filesystem (KBFS)","fork":false,"url":"https://api.github.com/repos/keybase/kbfs","forks_url":"https://api.github.com/repos/keybase/kbfs/forks","keys_url":"https://api.github.com/repos/keybase/kbfs/keys{/key_id}","collaborators_url":"https://api.github.com/repos/keybase/kbfs/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/keybase/kbfs/teams","hooks_url":"https://api.github.com/repos/keybase/kbfs/hooks","issue_events_url":"https://api.github.com/repos/keybase/kbfs/issues/events{/number}","events_url":"https://api.github.com/repos/keybase/kbfs/events","assignees_url":"https://api.github.com/repos/keybase/kbfs/assignees{/user}","branches_url":"https://api.github.com/repos/keybase/kbfs/branches{/branch}","tags_url":"https://api.github.com/repos/keybase/kbfs/tags","blobs_url":"https://api.github.com/repos/keybase/kbfs/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/keybase/kbfs/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/keybase/kbfs/git/refs{/sha}","trees_url":"https://api.github.com/repos/keybase/kbfs/git/trees{/sha}","statuses_url":"https://api.github.com/repos/keybase/kbfs/statuses/{sha}","languages_url":"https://api.github.com/repos/keybase/kbfs/languages","stargazers_url":"https://api.github.com/repos/keybase/kbfs/stargazers","contributors_url":"https://api.github.com/repos/keybase/kbfs/contributors","subscribers_url":"https://api.github.com/repos/keybase/kbfs/subscribers","subscription_url":"https://api.github.com/repos/keybase/kbfs/subscription","commits_url":"https://api.github.com/repos/keybase/kbfs/commits{/sha}","git_commits_url":"https://api.github.com/repos/keybase/kbfs/git/commits{/sha}","comments_url":"https://api.github.com/repos/keybase/kbfs/comments{/number}","issue_comment_url":"https://api.github.com/repos/keybase/kbfs/issues/comments{/number}","contents_url":"https://api.github.com/repos/keybase/kbfs/contents/{+path}","compare_url":"https://api.github.com/repos/keybase/kbfs/compare/{base}...{head}","merges_url":"https://api.github.com/repos/keybase/kbfs/merges","archive_url":"https://api.github.com/repos/keybase/kbfs/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/keybase/kbfs/downloads","issues_url":"https://api.github.com/repos/keybase/kbfs/issues{/number}","pulls_url":"https://api.github.com/repos/keybase/kbfs/pulls{/number}","milestones_url":"https://api.github.com/repos/keybase/kbfs/milestones{/number}","notifications_url":"https://api.github.com/repos/keybase/kbfs/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/keybase/kbfs/labels{/name}","releases_url":"https://api.github.com/repos/keybase/kbfs/releases{/id}","deployments_url":"https://api.github.com/repos/keybase/kbfs/deployments","created_at":"2016-05-26T22:37:42Z","updated_at":"2018-02-28T02:25:38Z","pushed_at":"2018-02-28T21:03:09Z","git_url":"git://github.com/keybase/kbfs.git","ssh_url":"git@github.com:keybase/kbfs.git","clone_url":"https://github.com/keybase/kbfs.git","svn_url":"https://github.com/keybase/kbfs","homepage":"https://keybase.io/docs/kbfs","size":48520,"stargazers_count":885,"watchers_count":885,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"forks_count":76,"mirror_url":null,"archived":false,"open_issues_count":46,"license":{"key":"bsd-3-clause","name":"BSD 3-Clause \"New\" or \"Revised\" License","spdx_id":"BSD-3-Clause","url":"https://api.github.com/licenses/bsd-3-clause"},"forks":76,"open_issues":46,"watchers":885,"default_branch":"master"}},"_links":{"self":{"href":"https://api.github.com/repos/keybase/kbfs/pulls/1496"},"html":{"href":"https://github.com/keybase/kbfs/pull/1496"},"issue":{"href":"https://api.github.com/repos/keybase/kbfs/issues/1496"},"comments":{"href":"https://api.github.com/repos/keybase/kbfs/issues/1496/comments"},"review_comments":{"href":"https://api.github.com/repos/keybase/kbfs/pulls/1496/comments"},"review_comment":{"href":"https://api.github.com/repos/keybase/kbfs/pulls/comments{/number}"},"commits":{"href":"https://api.github.com/repos/keybase/kbfs/pulls/1496/commits"},"statuses":{"href":"https://api.github.com/repos/keybase/kbfs/statuses/a375bbaa852f7c4c5475526da029481d313d80e8"}},"author_association":"CONTRIBUTOR"}},"public":true,"created_at":"2018-02-28T21:06:39Z","org":{"id":5400834,"login":"keybase","gravatar_id":"","url":"https://api.github.com/orgs/keybase","avatar_url":"https://avatars.githubusercontent.com/u/5400834?"}},{"id":"7311225788","type":"PullRequestReviewCommentEvent","actor":{"id":860932,"login":"oconnor663","display_login":"oconnor663","gravatar_id":"","url":"https://api.github.com/users/oconnor663","avatar_url":"https://avatars.githubusercontent.com/u/860932?"},"repo":{"id":53898911,"name":"keybase/saltpack","url":"https://api.github.com/repos/keybase/saltpack"},"payload":{"action":"created","comment":{"url":"https://api.github.com/repos/keybase/saltpack/pulls/comments/171316151","pull_request_review_id":100147394,"id":171316151,"diff_hunk":"@@ -119,9 +119,20 @@ func (pes *testEncryptStream) encryptBlock(isFinal bool) error {\n \treturn nil\n }\n \n-func (pes *testEncryptStream) init(version Version, sender BoxSecretKey, receivers []BoxPublicKey) error {\n+func (pes *testEncryptStream) init(\n+\tversion Version, sender BoxSecretKey, receivers []BoxPublicKey,\n+\tephemeralKeyCreator EphemeralKeyCreator, rng encryptRNG) error {\n+\tif err := checkKnownVersion(version); err != nil {","path":"tweakable_encryptor_test.go","position":8,"original_position":8,"commit_id":"24462f84ea08861d00473dd91e505421c12108ea","original_commit_id":"24462f84ea08861d00473dd91e505421c12108ea","user":{"login":"oconnor663","id":860932,"avatar_url":"https://avatars0.githubusercontent.com/u/860932?v=4","gravatar_id":"","url":"https://api.github.com/users/oconnor663","html_url":"https://github.com/oconnor663","followers_url":"https://api.github.com/users/oconnor663/followers","following_url":"https://api.github.com/users/oconnor663/following{/other_user}","gists_url":"https://api.github.com/users/oconnor663/gists{/gist_id}","starred_url":"https://api.github.com/users/oconnor663/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oconnor663/subscriptions","organizations_url":"https://api.github.com/users/oconnor663/orgs","repos_url":"https://api.github.com/users/oconnor663/repos","events_url":"https://api.github.com/users/oconnor663/events{/privacy}","received_events_url":"https://api.github.com/users/oconnor663/received_events","type":"User","site_admin":false},"body":"Unfortunate, I guess they diverged over time after this version got forked off?","created_at":"2018-02-28T17:06:47Z","updated_at":"2018-02-28T17:06:47Z","html_url":"https://github.com/keybase/saltpack/pull/49#discussion_r171316151","pull_request_url":"https://api.github.com/repos/keybase/saltpack/pulls/49","author_association":"CONTRIBUTOR","_links":{"self":{"href":"https://api.github.com/repos/keybase/saltpack/pulls/comments/171316151"},"html":{"href":"https://github.com/keybase/saltpack/pull/49#discussion_r171316151"},"pull_request":{"href":"https://api.github.com/repos/keybase/saltpack/pulls/49"}},"in_reply_to_id":170446715},"pull_request":{"url":"https://api.github.com/repos/keybase/saltpack/pulls/49","id":171165063,"html_url":"https://github.com/keybase/saltpack/pull/49","diff_url":"https://github.com/keybase/saltpack/pull/49.diff","patch_url":"https://github.com/keybase/saltpack/pull/49.patch","issue_url":"https://api.github.com/repos/keybase/saltpack/issues/49","number":49,"state":"open","locked":false,"title":"Dep-inject functions involving randomness","user":{"login":"akalin-keybase","id":13270622,"avatar_url":"https://avatars3.githubusercontent.com/u/13270622?v=4","gravatar_id":"","url":"https://api.github.com/users/akalin-keybase","html_url":"https://github.com/akalin-keybase","followers_url":"https://api.github.com/users/akalin-keybase/followers","following_url":"https://api.github.com/users/akalin-keybase/following{/other_user}","gists_url":"https://api.github.com/users/akalin-keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/akalin-keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/akalin-keybase/subscriptions","organizations_url":"https://api.github.com/users/akalin-keybase/orgs","repos_url":"https://api.github.com/users/akalin-keybase/repos","events_url":"https://api.github.com/users/akalin-keybase/events{/privacy}","received_events_url":"https://api.github.com/users/akalin-keybase/received_events","type":"User","site_admin":false},"body":"This is in preparation for adding more hardcoded tests.\r\n\r\nSeparate out ephemeral key generation into its own interface\r\nseparate from keys and keyrings.\r\n\r\nMake signcryption return an error if there are no receivers.","created_at":"2018-02-24T06:46:04Z","updated_at":"2018-02-28T17:06:47Z","closed_at":null,"merged_at":null,"merge_commit_sha":"a809083a57c58bc56e77cbe18599913009b8c4f9","assignee":null,"assignees":[],"requested_reviewers":[{"login":"oconnor663","id":860932,"avatar_url":"https://avatars0.githubusercontent.com/u/860932?v=4","gravatar_id":"","url":"https://api.github.com/users/oconnor663","html_url":"https://github.com/oconnor663","followers_url":"https://api.github.com/users/oconnor663/followers","following_url":"https://api.github.com/users/oconnor663/following{/other_user}","gists_url":"https://api.github.com/users/oconnor663/gists{/gist_id}","starred_url":"https://api.github.com/users/oconnor663/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oconnor663/subscriptions","organizations_url":"https://api.github.com/users/oconnor663/orgs","repos_url":"https://api.github.com/users/oconnor663/repos","events_url":"https://api.github.com/users/oconnor663/events{/privacy}","received_events_url":"https://api.github.com/users/oconnor663/received_events","type":"User","site_admin":false}],"requested_teams":[],"labels":[],"milestone":null,"commits_url":"https://api.github.com/repos/keybase/saltpack/pulls/49/commits","review_comments_url":"https://api.github.com/repos/keybase/saltpack/pulls/49/comments","review_comment_url":"https://api.github.com/repos/keybase/saltpack/pulls/comments{/number}","comments_url":"https://api.github.com/repos/keybase/saltpack/issues/49/comments","statuses_url":"https://api.github.com/repos/keybase/saltpack/statuses/24462f84ea08861d00473dd91e505421c12108ea","head":{"label":"keybase:akalin/rand-interface","ref":"akalin/rand-interface","sha":"24462f84ea08861d00473dd91e505421c12108ea","user":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"repo":{"id":53898911,"name":"saltpack","full_name":"keybase/saltpack","owner":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"private":false,"html_url":"https://github.com/keybase/saltpack","description":"a modern crypto messaging format","fork":false,"url":"https://api.github.com/repos/keybase/saltpack","forks_url":"https://api.github.com/repos/keybase/saltpack/forks","keys_url":"https://api.github.com/repos/keybase/saltpack/keys{/key_id}","collaborators_url":"https://api.github.com/repos/keybase/saltpack/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/keybase/saltpack/teams","hooks_url":"https://api.github.com/repos/keybase/saltpack/hooks","issue_events_url":"https://api.github.com/repos/keybase/saltpack/issues/events{/number}","events_url":"https://api.github.com/repos/keybase/saltpack/events","assignees_url":"https://api.github.com/repos/keybase/saltpack/assignees{/user}","branches_url":"https://api.github.com/repos/keybase/saltpack/branches{/branch}","tags_url":"https://api.github.com/repos/keybase/saltpack/tags","blobs_url":"https://api.github.com/repos/keybase/saltpack/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/keybase/saltpack/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/keybase/saltpack/git/refs{/sha}","trees_url":"https://api.github.com/repos/keybase/saltpack/git/trees{/sha}","statuses_url":"https://api.github.com/repos/keybase/saltpack/statuses/{sha}","languages_url":"https://api.github.com/repos/keybase/saltpack/languages","stargazers_url":"https://api.github.com/repos/keybase/saltpack/stargazers","contributors_url":"https://api.github.com/repos/keybase/saltpack/contributors","subscribers_url":"https://api.github.com/repos/keybase/saltpack/subscribers","subscription_url":"https://api.github.com/repos/keybase/saltpack/subscription","commits_url":"https://api.github.com/repos/keybase/saltpack/commits{/sha}","git_commits_url":"https://api.github.com/repos/keybase/saltpack/git/commits{/sha}","comments_url":"https://api.github.com/repos/keybase/saltpack/comments{/number}","issue_comment_url":"https://api.github.com/repos/keybase/saltpack/issues/comments{/number}","contents_url":"https://api.github.com/repos/keybase/saltpack/contents/{+path}","compare_url":"https://api.github.com/repos/keybase/saltpack/compare/{base}...{head}","merges_url":"https://api.github.com/repos/keybase/saltpack/merges","archive_url":"https://api.github.com/repos/keybase/saltpack/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/keybase/saltpack/downloads","issues_url":"https://api.github.com/repos/keybase/saltpack/issues{/number}","pulls_url":"https://api.github.com/repos/keybase/saltpack/pulls{/number}","milestones_url":"https://api.github.com/repos/keybase/saltpack/milestones{/number}","notifications_url":"https://api.github.com/repos/keybase/saltpack/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/keybase/saltpack/labels{/name}","releases_url":"https://api.github.com/repos/keybase/saltpack/releases{/id}","deployments_url":"https://api.github.com/repos/keybase/saltpack/deployments","created_at":"2016-03-14T23:16:51Z","updated_at":"2018-02-26T17:26:19Z","pushed_at":"2018-02-26T13:57:09Z","git_url":"git://github.com/keybase/saltpack.git","ssh_url":"git@github.com:keybase/saltpack.git","clone_url":"https://github.com/keybase/saltpack.git","svn_url":"https://github.com/keybase/saltpack","homepage":"https://saltpack.org/","size":791,"stargazers_count":187,"watchers_count":187,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"forks_count":15,"mirror_url":null,"archived":false,"open_issues_count":6,"license":{"key":"bsd-3-clause","name":"BSD 3-Clause \"New\" or \"Revised\" License","spdx_id":"BSD-3-Clause","url":"https://api.github.com/licenses/bsd-3-clause"},"forks":15,"open_issues":6,"watchers":187,"default_branch":"master"}},"base":{"label":"keybase:master","ref":"master","sha":"2fda0838fec99dd7345943a2f02ee20a0e06340e","user":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"repo":{"id":53898911,"name":"saltpack","full_name":"keybase/saltpack","owner":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"private":false,"html_url":"https://github.com/keybase/saltpack","description":"a modern crypto messaging format","fork":false,"url":"https://api.github.com/repos/keybase/saltpack","forks_url":"https://api.github.com/repos/keybase/saltpack/forks","keys_url":"https://api.github.com/repos/keybase/saltpack/keys{/key_id}","collaborators_url":"https://api.github.com/repos/keybase/saltpack/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/keybase/saltpack/teams","hooks_url":"https://api.github.com/repos/keybase/saltpack/hooks","issue_events_url":"https://api.github.com/repos/keybase/saltpack/issues/events{/number}","events_url":"https://api.github.com/repos/keybase/saltpack/events","assignees_url":"https://api.github.com/repos/keybase/saltpack/assignees{/user}","branches_url":"https://api.github.com/repos/keybase/saltpack/branches{/branch}","tags_url":"https://api.github.com/repos/keybase/saltpack/tags","blobs_url":"https://api.github.com/repos/keybase/saltpack/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/keybase/saltpack/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/keybase/saltpack/git/refs{/sha}","trees_url":"https://api.github.com/repos/keybase/saltpack/git/trees{/sha}","statuses_url":"https://api.github.com/repos/keybase/saltpack/statuses/{sha}","languages_url":"https://api.github.com/repos/keybase/saltpack/languages","stargazers_url":"https://api.github.com/repos/keybase/saltpack/stargazers","contributors_url":"https://api.github.com/repos/keybase/saltpack/contributors","subscribers_url":"https://api.github.com/repos/keybase/saltpack/subscribers","subscription_url":"https://api.github.com/repos/keybase/saltpack/subscription","commits_url":"https://api.github.com/repos/keybase/saltpack/commits{/sha}","git_commits_url":"https://api.github.com/repos/keybase/saltpack/git/commits{/sha}","comments_url":"https://api.github.com/repos/keybase/saltpack/comments{/number}","issue_comment_url":"https://api.github.com/repos/keybase/saltpack/issues/comments{/number}","contents_url":"https://api.github.com/repos/keybase/saltpack/contents/{+path}","compare_url":"https://api.github.com/repos/keybase/saltpack/compare/{base}...{head}","merges_url":"https://api.github.com/repos/keybase/saltpack/merges","archive_url":"https://api.github.com/repos/keybase/saltpack/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/keybase/saltpack/downloads","issues_url":"https://api.github.com/repos/keybase/saltpack/issues{/number}","pulls_url":"https://api.github.com/repos/keybase/saltpack/pulls{/number}","milestones_url":"https://api.github.com/repos/keybase/saltpack/milestones{/number}","notifications_url":"https://api.github.com/repos/keybase/saltpack/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/keybase/saltpack/labels{/name}","releases_url":"https://api.github.com/repos/keybase/saltpack/releases{/id}","deployments_url":"https://api.github.com/repos/keybase/saltpack/deployments","created_at":"2016-03-14T23:16:51Z","updated_at":"2018-02-26T17:26:19Z","pushed_at":"2018-02-26T13:57:09Z","git_url":"git://github.com/keybase/saltpack.git","ssh_url":"git@github.com:keybase/saltpack.git","clone_url":"https://github.com/keybase/saltpack.git","svn_url":"https://github.com/keybase/saltpack","homepage":"https://saltpack.org/","size":791,"stargazers_count":187,"watchers_count":187,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"forks_count":15,"mirror_url":null,"archived":false,"open_issues_count":6,"license":{"key":"bsd-3-clause","name":"BSD 3-Clause \"New\" or \"Revised\" License","spdx_id":"BSD-3-Clause","url":"https://api.github.com/licenses/bsd-3-clause"},"forks":15,"open_issues":6,"watchers":187,"default_branch":"master"}},"_links":{"self":{"href":"https://api.github.com/repos/keybase/saltpack/pulls/49"},"html":{"href":"https://github.com/keybase/saltpack/pull/49"},"issue":{"href":"https://api.github.com/repos/keybase/saltpack/issues/49"},"comments":{"href":"https://api.github.com/repos/keybase/saltpack/issues/49/comments"},"review_comments":{"href":"https://api.github.com/repos/keybase/saltpack/pulls/49/comments"},"review_comment":{"href":"https://api.github.com/repos/keybase/saltpack/pulls/comments{/number}"},"commits":{"href":"https://api.github.com/repos/keybase/saltpack/pulls/49/commits"},"statuses":{"href":"https://api.github.com/repos/keybase/saltpack/statuses/24462f84ea08861d00473dd91e505421c12108ea"}},"author_association":"CONTRIBUTOR"}},"public":true,"created_at":"2018-02-28T17:06:47Z","org":{"id":5400834,"login":"keybase","gravatar_id":"","url":"https://api.github.com/orgs/keybase","avatar_url":"https://avatars.githubusercontent.com/u/5400834?"}},{"id":"7311208729","type":"PullRequestReviewCommentEvent","actor":{"id":860932,"login":"oconnor663","display_login":"oconnor663","gravatar_id":"","url":"https://api.github.com/users/oconnor663","avatar_url":"https://avatars.githubusercontent.com/u/860932?"},"repo":{"id":53898911,"name":"keybase/saltpack","url":"https://api.github.com/repos/keybase/saltpack"},"payload":{"action":"created","comment":{"url":"https://api.github.com/repos/keybase/saltpack/pulls/comments/171315340","pull_request_review_id":100146394,"id":171315340,"diff_hunk":"@@ -205,12 +204,29 @@ func shuffleSigncryptionReceivers(receiverBoxKeys []BoxPublicKey, receiverSymmet\n \treturn receivers\n }\n \n+// signcryptRNG is an interface encapsulating all the randomness\n+// (aside from ephemeral key generation) that happens during\n+// signcryption. Tests can override it to make encryption\n+// deterministic.\n+type signcryptRNG interface {\n+\tcreateSymmetricKey() (*SymmetricKey, error)\n+\tshuffleReceivers(receiverBoxKeys []BoxPublicKey, receiverSymmetricKeys []ReceiverSymmetricKey) []receiverKeysMaker\n+}\n+\n // This generates the payload key, and encrypts it for all the different\n // recipients of the two different types. Symmetric key recipients and DH key\n // recipients use different types of identifiers, but they are the same length,\n // and should both be indistinguishable from random noise.\n-func (sss *signcryptSealStream) init(receivers []receiverKeysMaker) error {\n-\tephemeralKey, err := sss.keyring.CreateEphemeralKey()\n+func (sss *signcryptSealStream) init(\n+\treceiverBoxKeys []BoxPublicKey, receiverSymmetricKeys []ReceiverSymmetricKey,\n+\tephemeralKeyCreator EphemeralKeyCreator, rng signcryptRNG) error {\n+\tif len(receiverBoxKeys)+len(receiverSymmetricKeys) == 0 {","path":"signcrypt_seal.go","position":30,"original_position":30,"commit_id":"24462f84ea08861d00473dd91e505421c12108ea","original_commit_id":"24462f84ea08861d00473dd91e505421c12108ea","user":{"login":"oconnor663","id":860932,"avatar_url":"https://avatars0.githubusercontent.com/u/860932?v=4","gravatar_id":"","url":"https://api.github.com/users/oconnor663","html_url":"https://github.com/oconnor663","followers_url":"https://api.github.com/users/oconnor663/followers","following_url":"https://api.github.com/users/oconnor663/following{/other_user}","gists_url":"https://api.github.com/users/oconnor663/gists{/gist_id}","starred_url":"https://api.github.com/users/oconnor663/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oconnor663/subscriptions","organizations_url":"https://api.github.com/users/oconnor663/orgs","repos_url":"https://api.github.com/users/oconnor663/repos","events_url":"https://api.github.com/users/oconnor663/events{/privacy}","received_events_url":"https://api.github.com/users/oconnor663/received_events","type":"User","site_admin":false},"body":"I don't think so. Maybe we should just copy the `checkReceivers` function wholesale?","created_at":"2018-02-28T17:03:54Z","updated_at":"2018-02-28T17:03:54Z","html_url":"https://github.com/keybase/saltpack/pull/49#discussion_r171315340","pull_request_url":"https://api.github.com/repos/keybase/saltpack/pulls/49","author_association":"CONTRIBUTOR","_links":{"self":{"href":"https://api.github.com/repos/keybase/saltpack/pulls/comments/171315340"},"html":{"href":"https://github.com/keybase/saltpack/pull/49#discussion_r171315340"},"pull_request":{"href":"https://api.github.com/repos/keybase/saltpack/pulls/49"}},"in_reply_to_id":170446761},"pull_request":{"url":"https://api.github.com/repos/keybase/saltpack/pulls/49","id":171165063,"html_url":"https://github.com/keybase/saltpack/pull/49","diff_url":"https://github.com/keybase/saltpack/pull/49.diff","patch_url":"https://github.com/keybase/saltpack/pull/49.patch","issue_url":"https://api.github.com/repos/keybase/saltpack/issues/49","number":49,"state":"open","locked":false,"title":"Dep-inject functions involving randomness","user":{"login":"akalin-keybase","id":13270622,"avatar_url":"https://avatars3.githubusercontent.com/u/13270622?v=4","gravatar_id":"","url":"https://api.github.com/users/akalin-keybase","html_url":"https://github.com/akalin-keybase","followers_url":"https://api.github.com/users/akalin-keybase/followers","following_url":"https://api.github.com/users/akalin-keybase/following{/other_user}","gists_url":"https://api.github.com/users/akalin-keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/akalin-keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/akalin-keybase/subscriptions","organizations_url":"https://api.github.com/users/akalin-keybase/orgs","repos_url":"https://api.github.com/users/akalin-keybase/repos","events_url":"https://api.github.com/users/akalin-keybase/events{/privacy}","received_events_url":"https://api.github.com/users/akalin-keybase/received_events","type":"User","site_admin":false},"body":"This is in preparation for adding more hardcoded tests.\r\n\r\nSeparate out ephemeral key generation into its own interface\r\nseparate from keys and keyrings.\r\n\r\nMake signcryption return an error if there are no receivers.","created_at":"2018-02-24T06:46:04Z","updated_at":"2018-02-28T17:03:54Z","closed_at":null,"merged_at":null,"merge_commit_sha":"a809083a57c58bc56e77cbe18599913009b8c4f9","assignee":null,"assignees":[],"requested_reviewers":[{"login":"oconnor663","id":860932,"avatar_url":"https://avatars0.githubusercontent.com/u/860932?v=4","gravatar_id":"","url":"https://api.github.com/users/oconnor663","html_url":"https://github.com/oconnor663","followers_url":"https://api.github.com/users/oconnor663/followers","following_url":"https://api.github.com/users/oconnor663/following{/other_user}","gists_url":"https://api.github.com/users/oconnor663/gists{/gist_id}","starred_url":"https://api.github.com/users/oconnor663/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oconnor663/subscriptions","organizations_url":"https://api.github.com/users/oconnor663/orgs","repos_url":"https://api.github.com/users/oconnor663/repos","events_url":"https://api.github.com/users/oconnor663/events{/privacy}","received_events_url":"https://api.github.com/users/oconnor663/received_events","type":"User","site_admin":false}],"requested_teams":[],"labels":[],"milestone":null,"commits_url":"https://api.github.com/repos/keybase/saltpack/pulls/49/commits","review_comments_url":"https://api.github.com/repos/keybase/saltpack/pulls/49/comments","review_comment_url":"https://api.github.com/repos/keybase/saltpack/pulls/comments{/number}","comments_url":"https://api.github.com/repos/keybase/saltpack/issues/49/comments","statuses_url":"https://api.github.com/repos/keybase/saltpack/statuses/24462f84ea08861d00473dd91e505421c12108ea","head":{"label":"keybase:akalin/rand-interface","ref":"akalin/rand-interface","sha":"24462f84ea08861d00473dd91e505421c12108ea","user":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"repo":{"id":53898911,"name":"saltpack","full_name":"keybase/saltpack","owner":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"private":false,"html_url":"https://github.com/keybase/saltpack","description":"a modern crypto messaging format","fork":false,"url":"https://api.github.com/repos/keybase/saltpack","forks_url":"https://api.github.com/repos/keybase/saltpack/forks","keys_url":"https://api.github.com/repos/keybase/saltpack/keys{/key_id}","collaborators_url":"https://api.github.com/repos/keybase/saltpack/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/keybase/saltpack/teams","hooks_url":"https://api.github.com/repos/keybase/saltpack/hooks","issue_events_url":"https://api.github.com/repos/keybase/saltpack/issues/events{/number}","events_url":"https://api.github.com/repos/keybase/saltpack/events","assignees_url":"https://api.github.com/repos/keybase/saltpack/assignees{/user}","branches_url":"https://api.github.com/repos/keybase/saltpack/branches{/branch}","tags_url":"https://api.github.com/repos/keybase/saltpack/tags","blobs_url":"https://api.github.com/repos/keybase/saltpack/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/keybase/saltpack/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/keybase/saltpack/git/refs{/sha}","trees_url":"https://api.github.com/repos/keybase/saltpack/git/trees{/sha}","statuses_url":"https://api.github.com/repos/keybase/saltpack/statuses/{sha}","languages_url":"https://api.github.com/repos/keybase/saltpack/languages","stargazers_url":"https://api.github.com/repos/keybase/saltpack/stargazers","contributors_url":"https://api.github.com/repos/keybase/saltpack/contributors","subscribers_url":"https://api.github.com/repos/keybase/saltpack/subscribers","subscription_url":"https://api.github.com/repos/keybase/saltpack/subscription","commits_url":"https://api.github.com/repos/keybase/saltpack/commits{/sha}","git_commits_url":"https://api.github.com/repos/keybase/saltpack/git/commits{/sha}","comments_url":"https://api.github.com/repos/keybase/saltpack/comments{/number}","issue_comment_url":"https://api.github.com/repos/keybase/saltpack/issues/comments{/number}","contents_url":"https://api.github.com/repos/keybase/saltpack/contents/{+path}","compare_url":"https://api.github.com/repos/keybase/saltpack/compare/{base}...{head}","merges_url":"https://api.github.com/repos/keybase/saltpack/merges","archive_url":"https://api.github.com/repos/keybase/saltpack/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/keybase/saltpack/downloads","issues_url":"https://api.github.com/repos/keybase/saltpack/issues{/number}","pulls_url":"https://api.github.com/repos/keybase/saltpack/pulls{/number}","milestones_url":"https://api.github.com/repos/keybase/saltpack/milestones{/number}","notifications_url":"https://api.github.com/repos/keybase/saltpack/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/keybase/saltpack/labels{/name}","releases_url":"https://api.github.com/repos/keybase/saltpack/releases{/id}","deployments_url":"https://api.github.com/repos/keybase/saltpack/deployments","created_at":"2016-03-14T23:16:51Z","updated_at":"2018-02-26T17:26:19Z","pushed_at":"2018-02-26T13:57:09Z","git_url":"git://github.com/keybase/saltpack.git","ssh_url":"git@github.com:keybase/saltpack.git","clone_url":"https://github.com/keybase/saltpack.git","svn_url":"https://github.com/keybase/saltpack","homepage":"https://saltpack.org/","size":791,"stargazers_count":187,"watchers_count":187,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"forks_count":15,"mirror_url":null,"archived":false,"open_issues_count":6,"license":{"key":"bsd-3-clause","name":"BSD 3-Clause \"New\" or \"Revised\" License","spdx_id":"BSD-3-Clause","url":"https://api.github.com/licenses/bsd-3-clause"},"forks":15,"open_issues":6,"watchers":187,"default_branch":"master"}},"base":{"label":"keybase:master","ref":"master","sha":"2fda0838fec99dd7345943a2f02ee20a0e06340e","user":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"repo":{"id":53898911,"name":"saltpack","full_name":"keybase/saltpack","owner":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"private":false,"html_url":"https://github.com/keybase/saltpack","description":"a modern crypto messaging format","fork":false,"url":"https://api.github.com/repos/keybase/saltpack","forks_url":"https://api.github.com/repos/keybase/saltpack/forks","keys_url":"https://api.github.com/repos/keybase/saltpack/keys{/key_id}","collaborators_url":"https://api.github.com/repos/keybase/saltpack/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/keybase/saltpack/teams","hooks_url":"https://api.github.com/repos/keybase/saltpack/hooks","issue_events_url":"https://api.github.com/repos/keybase/saltpack/issues/events{/number}","events_url":"https://api.github.com/repos/keybase/saltpack/events","assignees_url":"https://api.github.com/repos/keybase/saltpack/assignees{/user}","branches_url":"https://api.github.com/repos/keybase/saltpack/branches{/branch}","tags_url":"https://api.github.com/repos/keybase/saltpack/tags","blobs_url":"https://api.github.com/repos/keybase/saltpack/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/keybase/saltpack/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/keybase/saltpack/git/refs{/sha}","trees_url":"https://api.github.com/repos/keybase/saltpack/git/trees{/sha}","statuses_url":"https://api.github.com/repos/keybase/saltpack/statuses/{sha}","languages_url":"https://api.github.com/repos/keybase/saltpack/languages","stargazers_url":"https://api.github.com/repos/keybase/saltpack/stargazers","contributors_url":"https://api.github.com/repos/keybase/saltpack/contributors","subscribers_url":"https://api.github.com/repos/keybase/saltpack/subscribers","subscription_url":"https://api.github.com/repos/keybase/saltpack/subscription","commits_url":"https://api.github.com/repos/keybase/saltpack/commits{/sha}","git_commits_url":"https://api.github.com/repos/keybase/saltpack/git/commits{/sha}","comments_url":"https://api.github.com/repos/keybase/saltpack/comments{/number}","issue_comment_url":"https://api.github.com/repos/keybase/saltpack/issues/comments{/number}","contents_url":"https://api.github.com/repos/keybase/saltpack/contents/{+path}","compare_url":"https://api.github.com/repos/keybase/saltpack/compare/{base}...{head}","merges_url":"https://api.github.com/repos/keybase/saltpack/merges","archive_url":"https://api.github.com/repos/keybase/saltpack/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/keybase/saltpack/downloads","issues_url":"https://api.github.com/repos/keybase/saltpack/issues{/number}","pulls_url":"https://api.github.com/repos/keybase/saltpack/pulls{/number}","milestones_url":"https://api.github.com/repos/keybase/saltpack/milestones{/number}","notifications_url":"https://api.github.com/repos/keybase/saltpack/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/keybase/saltpack/labels{/name}","releases_url":"https://api.github.com/repos/keybase/saltpack/releases{/id}","deployments_url":"https://api.github.com/repos/keybase/saltpack/deployments","created_at":"2016-03-14T23:16:51Z","updated_at":"2018-02-26T17:26:19Z","pushed_at":"2018-02-26T13:57:09Z","git_url":"git://github.com/keybase/saltpack.git","ssh_url":"git@github.com:keybase/saltpack.git","clone_url":"https://github.com/keybase/saltpack.git","svn_url":"https://github.com/keybase/saltpack","homepage":"https://saltpack.org/","size":791,"stargazers_count":187,"watchers_count":187,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"forks_count":15,"mirror_url":null,"archived":false,"open_issues_count":6,"license":{"key":"bsd-3-clause","name":"BSD 3-Clause \"New\" or \"Revised\" License","spdx_id":"BSD-3-Clause","url":"https://api.github.com/licenses/bsd-3-clause"},"forks":15,"open_issues":6,"watchers":187,"default_branch":"master"}},"_links":{"self":{"href":"https://api.github.com/repos/keybase/saltpack/pulls/49"},"html":{"href":"https://github.com/keybase/saltpack/pull/49"},"issue":{"href":"https://api.github.com/repos/keybase/saltpack/issues/49"},"comments":{"href":"https://api.github.com/repos/keybase/saltpack/issues/49/comments"},"review_comments":{"href":"https://api.github.com/repos/keybase/saltpack/pulls/49/comments"},"review_comment":{"href":"https://api.github.com/repos/keybase/saltpack/pulls/comments{/number}"},"commits":{"href":"https://api.github.com/repos/keybase/saltpack/pulls/49/commits"},"statuses":{"href":"https://api.github.com/repos/keybase/saltpack/statuses/24462f84ea08861d00473dd91e505421c12108ea"}},"author_association":"CONTRIBUTOR"}},"public":true,"created_at":"2018-02-28T17:03:54Z","org":{"id":5400834,"login":"keybase","gravatar_id":"","url":"https://api.github.com/orgs/keybase","avatar_url":"https://avatars.githubusercontent.com/u/5400834?"}},{"id":"7310930460","type":"PullRequestReviewCommentEvent","actor":{"id":860932,"login":"oconnor663","display_login":"oconnor663","gravatar_id":"","url":"https://api.github.com/users/oconnor663","avatar_url":"https://avatars.githubusercontent.com/u/860932?"},"repo":{"id":53898911,"name":"keybase/saltpack","url":"https://api.github.com/repos/keybase/saltpack"},"payload":{"action":"created","comment":{"url":"https://api.github.com/repos/keybase/saltpack/pulls/comments/171299298","pull_request_review_id":100127466,"id":171299298,"diff_hunk":"@@ -28,17 +28,23 @@ const MessageTypeDetachedSignature MessageType = 2\n // signcrypted message.\n const MessageTypeSigncryption MessageType = 3\n \n+// Version1 returns the Version for Saltpack V1.\n func Version1() Version {\n \treturn Version{Major: 1, Minor: 0}\n }\n+\n+// Version2 returns the Version for Saltpack V2.\n func Version2() Version {\n \treturn Version{Major: 2, Minor: 0}\n }\n \n+// CurrentVersion returns the Version for the currently-used Saltpack\n+// version.\n func CurrentVersion() Version {\n-\treturn Version1()\n+\treturn Version2()","path":"const.go","position":18,"original_position":18,"commit_id":"f3fe06479a952749fcdcba1074ed92579bdedf31","original_commit_id":"01411f8b2ef8983fce29b55cc167270db93b8da8","user":{"login":"oconnor663","id":860932,"avatar_url":"https://avatars0.githubusercontent.com/u/860932?v=4","gravatar_id":"","url":"https://api.github.com/users/oconnor663","html_url":"https://github.com/oconnor663","followers_url":"https://api.github.com/users/oconnor663/followers","following_url":"https://api.github.com/users/oconnor663/following{/other_user}","gists_url":"https://api.github.com/users/oconnor663/gists{/gist_id}","starred_url":"https://api.github.com/users/oconnor663/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oconnor663/subscriptions","organizations_url":"https://api.github.com/users/oconnor663/orgs","repos_url":"https://api.github.com/users/oconnor663/repos","events_url":"https://api.github.com/users/oconnor663/events{/privacy}","received_events_url":"https://api.github.com/users/oconnor663/received_events","type":"User","site_admin":false},"body":"It looks like we always explicitly supply the version in `client`, so this will only affect hypothetical 3rd party callers who keep the default? It does seem like we should bump it, if that's right.","created_at":"2018-02-28T16:17:53Z","updated_at":"2018-02-28T16:18:41Z","html_url":"https://github.com/keybase/saltpack/pull/48#discussion_r171299298","pull_request_url":"https://api.github.com/repos/keybase/saltpack/pulls/48","author_association":"CONTRIBUTOR","_links":{"self":{"href":"https://api.github.com/repos/keybase/saltpack/pulls/comments/171299298"},"html":{"href":"https://github.com/keybase/saltpack/pull/48#discussion_r171299298"},"pull_request":{"href":"https://api.github.com/repos/keybase/saltpack/pulls/48"}},"in_reply_to_id":170192013},"pull_request":{"url":"https://api.github.com/repos/keybase/saltpack/pulls/48","id":170957971,"html_url":"https://github.com/keybase/saltpack/pull/48","diff_url":"https://github.com/keybase/saltpack/pull/48.diff","patch_url":"https://github.com/keybase/saltpack/pull/48.patch","issue_url":"https://api.github.com/repos/keybase/saltpack/issues/48","number":48,"state":"open","locked":false,"title":"Fix go vet and golint errors","user":{"login":"akalin-keybase","id":13270622,"avatar_url":"https://avatars3.githubusercontent.com/u/13270622?v=4","gravatar_id":"","url":"https://api.github.com/users/akalin-keybase","html_url":"https://github.com/akalin-keybase","followers_url":"https://api.github.com/users/akalin-keybase/followers","following_url":"https://api.github.com/users/akalin-keybase/following{/other_user}","gists_url":"https://api.github.com/users/akalin-keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/akalin-keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/akalin-keybase/subscriptions","organizations_url":"https://api.github.com/users/akalin-keybase/orgs","repos_url":"https://api.github.com/users/akalin-keybase/repos","events_url":"https://api.github.com/users/akalin-keybase/events{/privacy}","received_events_url":"https://api.github.com/users/akalin-keybase/received_events","type":"User","site_admin":false},"body":"Also bump CurrentVersion.","created_at":"2018-02-23T08:33:19Z","updated_at":"2018-02-28T16:18:41Z","closed_at":null,"merged_at":null,"merge_commit_sha":"69329156c405fad6e7b274fbef6c8c31502463d9","assignee":null,"assignees":[],"requested_reviewers":[],"requested_teams":[],"labels":[],"milestone":null,"commits_url":"https://api.github.com/repos/keybase/saltpack/pulls/48/commits","review_comments_url":"https://api.github.com/repos/keybase/saltpack/pulls/48/comments","review_comment_url":"https://api.github.com/repos/keybase/saltpack/pulls/comments{/number}","comments_url":"https://api.github.com/repos/keybase/saltpack/issues/48/comments","statuses_url":"https://api.github.com/repos/keybase/saltpack/statuses/f3fe06479a952749fcdcba1074ed92579bdedf31","head":{"label":"keybase:akalin/fix-vet-lint","ref":"akalin/fix-vet-lint","sha":"f3fe06479a952749fcdcba1074ed92579bdedf31","user":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"repo":{"id":53898911,"name":"saltpack","full_name":"keybase/saltpack","owner":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"private":false,"html_url":"https://github.com/keybase/saltpack","description":"a modern crypto messaging format","fork":false,"url":"https://api.github.com/repos/keybase/saltpack","forks_url":"https://api.github.com/repos/keybase/saltpack/forks","keys_url":"https://api.github.com/repos/keybase/saltpack/keys{/key_id}","collaborators_url":"https://api.github.com/repos/keybase/saltpack/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/keybase/saltpack/teams","hooks_url":"https://api.github.com/repos/keybase/saltpack/hooks","issue_events_url":"https://api.github.com/repos/keybase/saltpack/issues/events{/number}","events_url":"https://api.github.com/repos/keybase/saltpack/events","assignees_url":"https://api.github.com/repos/keybase/saltpack/assignees{/user}","branches_url":"https://api.github.com/repos/keybase/saltpack/branches{/branch}","tags_url":"https://api.github.com/repos/keybase/saltpack/tags","blobs_url":"https://api.github.com/repos/keybase/saltpack/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/keybase/saltpack/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/keybase/saltpack/git/refs{/sha}","trees_url":"https://api.github.com/repos/keybase/saltpack/git/trees{/sha}","statuses_url":"https://api.github.com/repos/keybase/saltpack/statuses/{sha}","languages_url":"https://api.github.com/repos/keybase/saltpack/languages","stargazers_url":"https://api.github.com/repos/keybase/saltpack/stargazers","contributors_url":"https://api.github.com/repos/keybase/saltpack/contributors","subscribers_url":"https://api.github.com/repos/keybase/saltpack/subscribers","subscription_url":"https://api.github.com/repos/keybase/saltpack/subscription","commits_url":"https://api.github.com/repos/keybase/saltpack/commits{/sha}","git_commits_url":"https://api.github.com/repos/keybase/saltpack/git/commits{/sha}","comments_url":"https://api.github.com/repos/keybase/saltpack/comments{/number}","issue_comment_url":"https://api.github.com/repos/keybase/saltpack/issues/comments{/number}","contents_url":"https://api.github.com/repos/keybase/saltpack/contents/{+path}","compare_url":"https://api.github.com/repos/keybase/saltpack/compare/{base}...{head}","merges_url":"https://api.github.com/repos/keybase/saltpack/merges","archive_url":"https://api.github.com/repos/keybase/saltpack/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/keybase/saltpack/downloads","issues_url":"https://api.github.com/repos/keybase/saltpack/issues{/number}","pulls_url":"https://api.github.com/repos/keybase/saltpack/pulls{/number}","milestones_url":"https://api.github.com/repos/keybase/saltpack/milestones{/number}","notifications_url":"https://api.github.com/repos/keybase/saltpack/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/keybase/saltpack/labels{/name}","releases_url":"https://api.github.com/repos/keybase/saltpack/releases{/id}","deployments_url":"https://api.github.com/repos/keybase/saltpack/deployments","created_at":"2016-03-14T23:16:51Z","updated_at":"2018-02-26T17:26:19Z","pushed_at":"2018-02-26T13:57:09Z","git_url":"git://github.com/keybase/saltpack.git","ssh_url":"git@github.com:keybase/saltpack.git","clone_url":"https://github.com/keybase/saltpack.git","svn_url":"https://github.com/keybase/saltpack","homepage":"https://saltpack.org/","size":791,"stargazers_count":187,"watchers_count":187,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"forks_count":15,"mirror_url":null,"archived":false,"open_issues_count":6,"license":{"key":"bsd-3-clause","name":"BSD 3-Clause \"New\" or \"Revised\" License","spdx_id":"BSD-3-Clause","url":"https://api.github.com/licenses/bsd-3-clause"},"forks":15,"open_issues":6,"watchers":187,"default_branch":"master"}},"base":{"label":"keybase:master","ref":"master","sha":"2fda0838fec99dd7345943a2f02ee20a0e06340e","user":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"repo":{"id":53898911,"name":"saltpack","full_name":"keybase/saltpack","owner":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"private":false,"html_url":"https://github.com/keybase/saltpack","description":"a modern crypto messaging format","fork":false,"url":"https://api.github.com/repos/keybase/saltpack","forks_url":"https://api.github.com/repos/keybase/saltpack/forks","keys_url":"https://api.github.com/repos/keybase/saltpack/keys{/key_id}","collaborators_url":"https://api.github.com/repos/keybase/saltpack/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/keybase/saltpack/teams","hooks_url":"https://api.github.com/repos/keybase/saltpack/hooks","issue_events_url":"https://api.github.com/repos/keybase/saltpack/issues/events{/number}","events_url":"https://api.github.com/repos/keybase/saltpack/events","assignees_url":"https://api.github.com/repos/keybase/saltpack/assignees{/user}","branches_url":"https://api.github.com/repos/keybase/saltpack/branches{/branch}","tags_url":"https://api.github.com/repos/keybase/saltpack/tags","blobs_url":"https://api.github.com/repos/keybase/saltpack/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/keybase/saltpack/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/keybase/saltpack/git/refs{/sha}","trees_url":"https://api.github.com/repos/keybase/saltpack/git/trees{/sha}","statuses_url":"https://api.github.com/repos/keybase/saltpack/statuses/{sha}","languages_url":"https://api.github.com/repos/keybase/saltpack/languages","stargazers_url":"https://api.github.com/repos/keybase/saltpack/stargazers","contributors_url":"https://api.github.com/repos/keybase/saltpack/contributors","subscribers_url":"https://api.github.com/repos/keybase/saltpack/subscribers","subscription_url":"https://api.github.com/repos/keybase/saltpack/subscription","commits_url":"https://api.github.com/repos/keybase/saltpack/commits{/sha}","git_commits_url":"https://api.github.com/repos/keybase/saltpack/git/commits{/sha}","comments_url":"https://api.github.com/repos/keybase/saltpack/comments{/number}","issue_comment_url":"https://api.github.com/repos/keybase/saltpack/issues/comments{/number}","contents_url":"https://api.github.com/repos/keybase/saltpack/contents/{+path}","compare_url":"https://api.github.com/repos/keybase/saltpack/compare/{base}...{head}","merges_url":"https://api.github.com/repos/keybase/saltpack/merges","archive_url":"https://api.github.com/repos/keybase/saltpack/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/keybase/saltpack/downloads","issues_url":"https://api.github.com/repos/keybase/saltpack/issues{/number}","pulls_url":"https://api.github.com/repos/keybase/saltpack/pulls{/number}","milestones_url":"https://api.github.com/repos/keybase/saltpack/milestones{/number}","notifications_url":"https://api.github.com/repos/keybase/saltpack/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/keybase/saltpack/labels{/name}","releases_url":"https://api.github.com/repos/keybase/saltpack/releases{/id}","deployments_url":"https://api.github.com/repos/keybase/saltpack/deployments","created_at":"2016-03-14T23:16:51Z","updated_at":"2018-02-26T17:26:19Z","pushed_at":"2018-02-26T13:57:09Z","git_url":"git://github.com/keybase/saltpack.git","ssh_url":"git@github.com:keybase/saltpack.git","clone_url":"https://github.com/keybase/saltpack.git","svn_url":"https://github.com/keybase/saltpack","homepage":"https://saltpack.org/","size":791,"stargazers_count":187,"watchers_count":187,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"forks_count":15,"mirror_url":null,"archived":false,"open_issues_count":6,"license":{"key":"bsd-3-clause","name":"BSD 3-Clause \"New\" or \"Revised\" License","spdx_id":"BSD-3-Clause","url":"https://api.github.com/licenses/bsd-3-clause"},"forks":15,"open_issues":6,"watchers":187,"default_branch":"master"}},"_links":{"self":{"href":"https://api.github.com/repos/keybase/saltpack/pulls/48"},"html":{"href":"https://github.com/keybase/saltpack/pull/48"},"issue":{"href":"https://api.github.com/repos/keybase/saltpack/issues/48"},"comments":{"href":"https://api.github.com/repos/keybase/saltpack/issues/48/comments"},"review_comments":{"href":"https://api.github.com/repos/keybase/saltpack/pulls/48/comments"},"review_comment":{"href":"https://api.github.com/repos/keybase/saltpack/pulls/comments{/number}"},"commits":{"href":"https://api.github.com/repos/keybase/saltpack/pulls/48/commits"},"statuses":{"href":"https://api.github.com/repos/keybase/saltpack/statuses/f3fe06479a952749fcdcba1074ed92579bdedf31"}},"author_association":"CONTRIBUTOR"}},"public":true,"created_at":"2018-02-28T16:17:53Z","org":{"id":5400834,"login":"keybase","gravatar_id":"","url":"https://api.github.com/orgs/keybase","avatar_url":"https://avatars.githubusercontent.com/u/5400834?"}},{"id":"7306761987","type":"IssueCommentEvent","actor":{"id":860932,"login":"oconnor663","display_login":"oconnor663","gravatar_id":"","url":"https://api.github.com/users/oconnor663","avatar_url":"https://avatars.githubusercontent.com/u/860932?"},"repo":{"id":59787605,"name":"keybase/kbfs","url":"https://api.github.com/repos/keybase/kbfs"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/keybase/kbfs/issues/1491","repository_url":"https://api.github.com/repos/keybase/kbfs","labels_url":"https://api.github.com/repos/keybase/kbfs/issues/1491/labels{/name}","comments_url":"https://api.github.com/repos/keybase/kbfs/issues/1491/comments","events_url":"https://api.github.com/repos/keybase/kbfs/issues/1491/events","html_url":"https://github.com/keybase/kbfs/pull/1491","id":300373454,"number":1491,"title":"initial Linux-only implementation of the Rust redirector","user":{"login":"oconnor663","id":860932,"avatar_url":"https://avatars0.githubusercontent.com/u/860932?v=4","gravatar_id":"","url":"https://api.github.com/users/oconnor663","html_url":"https://github.com/oconnor663","followers_url":"https://api.github.com/users/oconnor663/followers","following_url":"https://api.github.com/users/oconnor663/following{/other_user}","gists_url":"https://api.github.com/users/oconnor663/gists{/gist_id}","starred_url":"https://api.github.com/users/oconnor663/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oconnor663/subscriptions","organizations_url":"https://api.github.com/users/oconnor663/orgs","repos_url":"https://api.github.com/users/oconnor663/repos","events_url":"https://api.github.com/users/oconnor663/events{/privacy}","received_events_url":"https://api.github.com/users/oconnor663/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-02-26T19:53:14Z","updated_at":"2018-02-27T23:19:25Z","closed_at":null,"author_association":"CONTRIBUTOR","pull_request":{"url":"https://api.github.com/repos/keybase/kbfs/pulls/1491","html_url":"https://github.com/keybase/kbfs/pull/1491","diff_url":"https://github.com/keybase/kbfs/pull/1491.diff","patch_url":"https://github.com/keybase/kbfs/pull/1491.patch"},"body":"r? @strib @akalin-keybase \r\n\r\ncc @jzila "},"comment":{"url":"https://api.github.com/repos/keybase/kbfs/issues/comments/369062702","html_url":"https://github.com/keybase/kbfs/pull/1491#issuecomment-369062702","issue_url":"https://api.github.com/repos/keybase/kbfs/issues/1491","id":369062702,"user":{"login":"oconnor663","id":860932,"avatar_url":"https://avatars0.githubusercontent.com/u/860932?v=4","gravatar_id":"","url":"https://api.github.com/users/oconnor663","html_url":"https://github.com/oconnor663","followers_url":"https://api.github.com/users/oconnor663/followers","following_url":"https://api.github.com/users/oconnor663/following{/other_user}","gists_url":"https://api.github.com/users/oconnor663/gists{/gist_id}","starred_url":"https://api.github.com/users/oconnor663/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oconnor663/subscriptions","organizations_url":"https://api.github.com/users/oconnor663/orgs","repos_url":"https://api.github.com/users/oconnor663/repos","events_url":"https://api.github.com/users/oconnor663/events{/privacy}","received_events_url":"https://api.github.com/users/oconnor663/received_events","type":"User","site_admin":false},"created_at":"2018-02-27T23:19:25Z","updated_at":"2018-02-27T23:19:25Z","author_association":"CONTRIBUTOR","body":"Applied some of Strib's feedback, but not quite finished yet."}},"public":true,"created_at":"2018-02-27T23:19:25Z","org":{"id":5400834,"login":"keybase","gravatar_id":"","url":"https://api.github.com/orgs/keybase","avatar_url":"https://avatars.githubusercontent.com/u/5400834?"}},{"id":"7306760793","type":"PushEvent","actor":{"id":860932,"login":"oconnor663","display_login":"oconnor663","gravatar_id":"","url":"https://api.github.com/users/oconnor663","avatar_url":"https://avatars.githubusercontent.com/u/860932?"},"repo":{"id":59787605,"name":"keybase/kbfs","url":"https://api.github.com/repos/keybase/kbfs"},"payload":{"push_id":2363710121,"size":1,"distinct_size":1,"ref":"refs/heads/jack/rust_redirector","head":"4dfafc3d8e38b063d5f0e06b8d2324eede8bada5","before":"e02a80616271b86332aa07b366e648c7a92d9f42","commits":[{"sha":"4dfafc3d8e38b063d5f0e06b8d2324eede8bada5","author":{"email":"oconnor663@gmail.com","name":"Jack O'Connor"},"message":"some of strib's feedback","distinct":true,"url":"https://api.github.com/repos/keybase/kbfs/commits/4dfafc3d8e38b063d5f0e06b8d2324eede8bada5"}]},"public":true,"created_at":"2018-02-27T23:19:05Z","org":{"id":5400834,"login":"keybase","gravatar_id":"","url":"https://api.github.com/orgs/keybase","avatar_url":"https://avatars.githubusercontent.com/u/5400834?"}},{"id":"7306759209","type":"PullRequestReviewCommentEvent","actor":{"id":860932,"login":"oconnor663","display_login":"oconnor663","gravatar_id":"","url":"https://api.github.com/users/oconnor663","avatar_url":"https://avatars.githubusercontent.com/u/860932?"},"repo":{"id":59787605,"name":"keybase/kbfs","url":"https://api.github.com/repos/keybase/kbfs"},"payload":{"action":"created","comment":{"url":"https://api.github.com/repos/keybase/kbfs/pulls/comments/171099615","pull_request_review_id":99893885,"id":171099615,"diff_hunk":"@@ -0,0 +1,180 @@\n+extern crate env_logger;\n+extern crate fuse;\n+extern crate libc;\n+extern crate log;\n+extern crate time;\n+\n+use std::env;\n+use std::ffi::OsStr;\n+use std::fs::File;\n+use std::io::prelude::*;\n+use std::io::BufReader;\n+use std::os::unix::prelude::*;\n+use std::path::PathBuf;\n+use libc::ENOENT;\n+use time::Timespec;\n+use fuse::{FileAttr, FileType, Filesystem, ReplyAttr, ReplyData, ReplyDirectory, ReplyEntry,\n+           Request};\n+\n+// A TTL of zero for all our attribute replies.\n+// TODO: Should this be nonzero for performance reasons?\n+const TTL: Timespec = Timespec { sec: 0, nsec: 0 };\n+\n+// FD 1 is a magical value that we can't change, but the others are arbitrary.\n+const ROOT_DIR_INODE: u64 = 1;\n+const PRIVATE_LINK_INODE: u64 = 2;\n+const PUBLIC_LINK_INODE: u64 = 3;\n+const TEAM_LINK_INODE: u64 = 4;\n+\n+struct Redirector {\n+    // We use the process start time for all of our stat timestamps.\n+    start_time: Timespec,\n+}\n+\n+impl Redirector {\n+    fn root_dir_attr(&self) -> FileAttr {\n+        FileAttr {\n+            ino: ROOT_DIR_INODE,\n+            size: 0,\n+            blocks: 0,\n+            atime: self.start_time,\n+            mtime: self.start_time,\n+            ctime: self.start_time,\n+            crtime: self.start_time,\n+            kind: FileType::Directory,\n+            perm: 0o755,\n+            nlink: 0,\n+            uid: 0,\n+            gid: 0,\n+            rdev: 0,\n+            flags: 0,\n+        }\n+    }\n+\n+    fn link_attr(&self, ino: u64) -> FileAttr {\n+        FileAttr {\n+            ino,\n+            size: 0,\n+            blocks: 0,\n+            atime: self.start_time,\n+            mtime: self.start_time,\n+            ctime: self.start_time,\n+            crtime: self.start_time,\n+            kind: FileType::Symlink,\n+            perm: 0o644,\n+            nlink: 0,\n+            uid: 0,\n+            gid: 0,\n+            rdev: 0,\n+            flags: 0,\n+        }\n+    }\n+}\n+\n+impl Filesystem for Redirector {\n+    fn lookup(&mut self, _req: &Request, _parent: u64, name: &OsStr, reply: ReplyEntry) {\n+        match name.to_str() {\n+            Some(\"private\") => reply.entry(&TTL, &self.link_attr(PRIVATE_LINK_INODE), 0),\n+            Some(\"public\") => reply.entry(&TTL, &self.link_attr(PUBLIC_LINK_INODE), 0),\n+            Some(\"team\") => reply.entry(&TTL, &self.link_attr(TEAM_LINK_INODE), 0),\n+            _ => reply.error(ENOENT),\n+        }\n+    }\n+\n+    fn getattr(&mut self, _req: &Request, ino: u64, reply: ReplyAttr) {\n+        match ino {\n+            ROOT_DIR_INODE => reply.attr(&TTL, &self.root_dir_attr()),\n+            PRIVATE_LINK_INODE | PUBLIC_LINK_INODE | TEAM_LINK_INODE => {\n+                reply.attr(&TTL, &self.link_attr(ino))\n+            }\n+            _ => reply.error(ENOENT),\n+        }\n+    }\n+\n+    fn readlink(&mut self, req: &Request, ino: u64, reply: ReplyData) {\n+        let subdir = match ino {\n+            PRIVATE_LINK_INODE => \"private\",\n+            PUBLIC_LINK_INODE => \"public\",\n+            TEAM_LINK_INODE => \"team\",\n+            _ => return reply.error(ENOENT),\n+        };\n+        // TODO: Should we cache the mountpoint somehow?\n+        if let Some(mountpoint) = get_keybase_fuse_mount(req.uid()) {\n+            let target = mountpoint.join(subdir);\n+            reply.data(target.as_os_str().as_bytes());\n+        } else {\n+            reply.error(ENOENT);\n+        }\n+    }\n+\n+    fn readdir(\n+        &mut self,\n+        _req: &Request,\n+        ino: u64,\n+        _fh: u64,\n+        offset: i64,\n+        mut reply: ReplyDirectory,\n+    ) {\n+        if ino == ROOT_DIR_INODE {\n+            if offset == 0 {\n+                reply.add(ROOT_DIR_INODE, 0, FileType::Directory, \".\");\n+                reply.add(ROOT_DIR_INODE, 1, FileType::Directory, \"..\");\n+                reply.add(PRIVATE_LINK_INODE, 2, FileType::Symlink, \"private\");\n+                reply.add(PUBLIC_LINK_INODE, 3, FileType::Symlink, \"public\");\n+                reply.add(TEAM_LINK_INODE, 4, FileType::Symlink, \"team\");\n+            }\n+            reply.ok();\n+        } else {\n+            reply.error(ENOENT);\n+        }\n+    }\n+}\n+\n+// This is explicitly only implemented for Linux, so that building on other\n+// platforms is a compiler error.\n+#[cfg(target_os = \"linux\")]\n+fn get_keybase_fuse_mount(uid: u32) -> Option<PathBuf> {\n+    let uid_str = format!(\"user_id={}\", uid);\n+    let file = File::open(\"/proc/mounts\").expect(\"failed to open /proc/mounts\");\n+    let reader = BufReader::new(file);\n+    // TODO: Avoid assuming UTF8?\n+    // TODO: Sort the paths first?\n+    for line in reader.lines() {\n+        let line = line.expect(\"failed to read from /proc/mounts\");\n+        let parts: Vec<&str> = line.split_whitespace().collect();\n+        // Check the mount type.\n+        if parts[2] != \"fuse\" {\n+            continue;\n+        }\n+        // Look for the uid in the mount options.\n+        if parts[3].split(',').find(|s| s == &uid_str).is_none() {\n+            continue;\n+        }\n+        // Make sure \"keybase\" is in the path somewhere. We do this loosely,\n+        // rather than splitting exactly on slashes, to handle \"keybase.devel\"\n+        // etc.\n+        if parts[1].to_lowercase().find(\"keybase\").is_none() {\n+            continue;\n+        }\n+        let path: PathBuf = parts[1].into();\n+        // TODO: We want to check that .kbfs_error exists, but the kbfsfuse\n+        // mount doesn't currently set \"allow_root\".\n+        return Some(path);\n+    }\n+    None\n+}\n+\n+fn main() {\n+    // The rust-fuse library writes logs using the standard log crate\n+    // interface. To init a log backend that will actually print those,\n+    // uncomment this line:\n+    // env_logger::Builder::new().filter(None, log::LevelFilter::Debug).init();\n+\n+    let redirector = Redirector {\n+        start_time: time::get_time(),\n+    };\n+    let mountpoint = env::args_os().nth(1).expect(\"must have a path argument\");\n+    let options = &[\"-o\", \"allow_other\", \"-o\", \"fsname=keybase-redirector\"];\n+    let options_osstr: Vec<&OsStr> = options.iter().map(|o| o.as_ref()).collect();\n+    fuse::mount(redirector, &mountpoint, &options_osstr).expect(\"mount returned an error\");","path":"redirector.rs/src/main.rs","position":179,"original_position":179,"commit_id":"e02a80616271b86332aa07b366e648c7a92d9f42","original_commit_id":"e02a80616271b86332aa07b366e648c7a92d9f42","user":{"login":"oconnor663","id":860932,"avatar_url":"https://avatars0.githubusercontent.com/u/860932?v=4","gravatar_id":"","url":"https://api.github.com/users/oconnor663","html_url":"https://github.com/oconnor663","followers_url":"https://api.github.com/users/oconnor663/followers","following_url":"https://api.github.com/users/oconnor663/following{/other_user}","gists_url":"https://api.github.com/users/oconnor663/gists{/gist_id}","starred_url":"https://api.github.com/users/oconnor663/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oconnor663/subscriptions","organizations_url":"https://api.github.com/users/oconnor663/orgs","repos_url":"https://api.github.com/users/oconnor663/repos","events_url":"https://api.github.com/users/oconnor663/events{/privacy}","received_events_url":"https://api.github.com/users/oconnor663/received_events","type":"User","site_admin":false},"body":"If `run_keybase` is invoking the redirector with redirected output and a backgrounding `&`, does it matter what error code the redirector exits with? Maybe we want to make sure the log file doesn't grow in this case?","created_at":"2018-02-27T23:18:41Z","updated_at":"2018-02-27T23:18:41Z","html_url":"https://github.com/keybase/kbfs/pull/1491#discussion_r171099615","pull_request_url":"https://api.github.com/repos/keybase/kbfs/pulls/1491","author_association":"CONTRIBUTOR","_links":{"self":{"href":"https://api.github.com/repos/keybase/kbfs/pulls/comments/171099615"},"html":{"href":"https://github.com/keybase/kbfs/pull/1491#discussion_r171099615"},"pull_request":{"href":"https://api.github.com/repos/keybase/kbfs/pulls/1491"}},"in_reply_to_id":170764258},"pull_request":{"url":"https://api.github.com/repos/keybase/kbfs/pulls/1491","id":171474775,"html_url":"https://github.com/keybase/kbfs/pull/1491","diff_url":"https://github.com/keybase/kbfs/pull/1491.diff","patch_url":"https://github.com/keybase/kbfs/pull/1491.patch","issue_url":"https://api.github.com/repos/keybase/kbfs/issues/1491","number":1491,"state":"open","locked":false,"title":"initial Linux-only implementation of the Rust redirector","user":{"login":"oconnor663","id":860932,"avatar_url":"https://avatars0.githubusercontent.com/u/860932?v=4","gravatar_id":"","url":"https://api.github.com/users/oconnor663","html_url":"https://github.com/oconnor663","followers_url":"https://api.github.com/users/oconnor663/followers","following_url":"https://api.github.com/users/oconnor663/following{/other_user}","gists_url":"https://api.github.com/users/oconnor663/gists{/gist_id}","starred_url":"https://api.github.com/users/oconnor663/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oconnor663/subscriptions","organizations_url":"https://api.github.com/users/oconnor663/orgs","repos_url":"https://api.github.com/users/oconnor663/repos","events_url":"https://api.github.com/users/oconnor663/events{/privacy}","received_events_url":"https://api.github.com/users/oconnor663/received_events","type":"User","site_admin":false},"body":"r? @strib @akalin-keybase \r\n\r\ncc @jzila ","created_at":"2018-02-26T19:53:14Z","updated_at":"2018-02-27T23:18:41Z","closed_at":null,"merged_at":null,"merge_commit_sha":"34d9279de3079943939e029a63d6d15bf46e2ebe","assignee":null,"assignees":[],"requested_reviewers":[],"requested_teams":[],"labels":[],"milestone":null,"commits_url":"https://api.github.com/repos/keybase/kbfs/pulls/1491/commits","review_comments_url":"https://api.github.com/repos/keybase/kbfs/pulls/1491/comments","review_comment_url":"https://api.github.com/repos/keybase/kbfs/pulls/comments{/number}","comments_url":"https://api.github.com/repos/keybase/kbfs/issues/1491/comments","statuses_url":"https://api.github.com/repos/keybase/kbfs/statuses/e02a80616271b86332aa07b366e648c7a92d9f42","head":{"label":"keybase:jack/rust_redirector","ref":"jack/rust_redirector","sha":"e02a80616271b86332aa07b366e648c7a92d9f42","user":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"repo":{"id":59787605,"name":"kbfs","full_name":"keybase/kbfs","owner":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"private":false,"html_url":"https://github.com/keybase/kbfs","description":"Keybase Filesystem (KBFS)","fork":false,"url":"https://api.github.com/repos/keybase/kbfs","forks_url":"https://api.github.com/repos/keybase/kbfs/forks","keys_url":"https://api.github.com/repos/keybase/kbfs/keys{/key_id}","collaborators_url":"https://api.github.com/repos/keybase/kbfs/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/keybase/kbfs/teams","hooks_url":"https://api.github.com/repos/keybase/kbfs/hooks","issue_events_url":"https://api.github.com/repos/keybase/kbfs/issues/events{/number}","events_url":"https://api.github.com/repos/keybase/kbfs/events","assignees_url":"https://api.github.com/repos/keybase/kbfs/assignees{/user}","branches_url":"https://api.github.com/repos/keybase/kbfs/branches{/branch}","tags_url":"https://api.github.com/repos/keybase/kbfs/tags","blobs_url":"https://api.github.com/repos/keybase/kbfs/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/keybase/kbfs/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/keybase/kbfs/git/refs{/sha}","trees_url":"https://api.github.com/repos/keybase/kbfs/git/trees{/sha}","statuses_url":"https://api.github.com/repos/keybase/kbfs/statuses/{sha}","languages_url":"https://api.github.com/repos/keybase/kbfs/languages","stargazers_url":"https://api.github.com/repos/keybase/kbfs/stargazers","contributors_url":"https://api.github.com/repos/keybase/kbfs/contributors","subscribers_url":"https://api.github.com/repos/keybase/kbfs/subscribers","subscription_url":"https://api.github.com/repos/keybase/kbfs/subscription","commits_url":"https://api.github.com/repos/keybase/kbfs/commits{/sha}","git_commits_url":"https://api.github.com/repos/keybase/kbfs/git/commits{/sha}","comments_url":"https://api.github.com/repos/keybase/kbfs/comments{/number}","issue_comment_url":"https://api.github.com/repos/keybase/kbfs/issues/comments{/number}","contents_url":"https://api.github.com/repos/keybase/kbfs/contents/{+path}","compare_url":"https://api.github.com/repos/keybase/kbfs/compare/{base}...{head}","merges_url":"https://api.github.com/repos/keybase/kbfs/merges","archive_url":"https://api.github.com/repos/keybase/kbfs/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/keybase/kbfs/downloads","issues_url":"https://api.github.com/repos/keybase/kbfs/issues{/number}","pulls_url":"https://api.github.com/repos/keybase/kbfs/pulls{/number}","milestones_url":"https://api.github.com/repos/keybase/kbfs/milestones{/number}","notifications_url":"https://api.github.com/repos/keybase/kbfs/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/keybase/kbfs/labels{/name}","releases_url":"https://api.github.com/repos/keybase/kbfs/releases{/id}","deployments_url":"https://api.github.com/repos/keybase/kbfs/deployments","created_at":"2016-05-26T22:37:42Z","updated_at":"2018-02-27T19:35:08Z","pushed_at":"2018-02-27T19:36:42Z","git_url":"git://github.com/keybase/kbfs.git","ssh_url":"git@github.com:keybase/kbfs.git","clone_url":"https://github.com/keybase/kbfs.git","svn_url":"https://github.com/keybase/kbfs","homepage":"https://keybase.io/docs/kbfs","size":48517,"stargazers_count":884,"watchers_count":884,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"forks_count":76,"mirror_url":null,"archived":false,"open_issues_count":45,"license":{"key":"bsd-3-clause","name":"BSD 3-Clause \"New\" or \"Revised\" License","spdx_id":"BSD-3-Clause","url":"https://api.github.com/licenses/bsd-3-clause"},"forks":76,"open_issues":45,"watchers":884,"default_branch":"master"}},"base":{"label":"keybase:master","ref":"master","sha":"a2daa6ef4d35a216543363322670809b42c67818","user":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"repo":{"id":59787605,"name":"kbfs","full_name":"keybase/kbfs","owner":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"private":false,"html_url":"https://github.com/keybase/kbfs","description":"Keybase Filesystem (KBFS)","fork":false,"url":"https://api.github.com/repos/keybase/kbfs","forks_url":"https://api.github.com/repos/keybase/kbfs/forks","keys_url":"https://api.github.com/repos/keybase/kbfs/keys{/key_id}","collaborators_url":"https://api.github.com/repos/keybase/kbfs/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/keybase/kbfs/teams","hooks_url":"https://api.github.com/repos/keybase/kbfs/hooks","issue_events_url":"https://api.github.com/repos/keybase/kbfs/issues/events{/number}","events_url":"https://api.github.com/repos/keybase/kbfs/events","assignees_url":"https://api.github.com/repos/keybase/kbfs/assignees{/user}","branches_url":"https://api.github.com/repos/keybase/kbfs/branches{/branch}","tags_url":"https://api.github.com/repos/keybase/kbfs/tags","blobs_url":"https://api.github.com/repos/keybase/kbfs/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/keybase/kbfs/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/keybase/kbfs/git/refs{/sha}","trees_url":"https://api.github.com/repos/keybase/kbfs/git/trees{/sha}","statuses_url":"https://api.github.com/repos/keybase/kbfs/statuses/{sha}","languages_url":"https://api.github.com/repos/keybase/kbfs/languages","stargazers_url":"https://api.github.com/repos/keybase/kbfs/stargazers","contributors_url":"https://api.github.com/repos/keybase/kbfs/contributors","subscribers_url":"https://api.github.com/repos/keybase/kbfs/subscribers","subscription_url":"https://api.github.com/repos/keybase/kbfs/subscription","commits_url":"https://api.github.com/repos/keybase/kbfs/commits{/sha}","git_commits_url":"https://api.github.com/repos/keybase/kbfs/git/commits{/sha}","comments_url":"https://api.github.com/repos/keybase/kbfs/comments{/number}","issue_comment_url":"https://api.github.com/repos/keybase/kbfs/issues/comments{/number}","contents_url":"https://api.github.com/repos/keybase/kbfs/contents/{+path}","compare_url":"https://api.github.com/repos/keybase/kbfs/compare/{base}...{head}","merges_url":"https://api.github.com/repos/keybase/kbfs/merges","archive_url":"https://api.github.com/repos/keybase/kbfs/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/keybase/kbfs/downloads","issues_url":"https://api.github.com/repos/keybase/kbfs/issues{/number}","pulls_url":"https://api.github.com/repos/keybase/kbfs/pulls{/number}","milestones_url":"https://api.github.com/repos/keybase/kbfs/milestones{/number}","notifications_url":"https://api.github.com/repos/keybase/kbfs/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/keybase/kbfs/labels{/name}","releases_url":"https://api.github.com/repos/keybase/kbfs/releases{/id}","deployments_url":"https://api.github.com/repos/keybase/kbfs/deployments","created_at":"2016-05-26T22:37:42Z","updated_at":"2018-02-27T19:35:08Z","pushed_at":"2018-02-27T19:36:42Z","git_url":"git://github.com/keybase/kbfs.git","ssh_url":"git@github.com:keybase/kbfs.git","clone_url":"https://github.com/keybase/kbfs.git","svn_url":"https://github.com/keybase/kbfs","homepage":"https://keybase.io/docs/kbfs","size":48517,"stargazers_count":884,"watchers_count":884,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"forks_count":76,"mirror_url":null,"archived":false,"open_issues_count":45,"license":{"key":"bsd-3-clause","name":"BSD 3-Clause \"New\" or \"Revised\" License","spdx_id":"BSD-3-Clause","url":"https://api.github.com/licenses/bsd-3-clause"},"forks":76,"open_issues":45,"watchers":884,"default_branch":"master"}},"_links":{"self":{"href":"https://api.github.com/repos/keybase/kbfs/pulls/1491"},"html":{"href":"https://github.com/keybase/kbfs/pull/1491"},"issue":{"href":"https://api.github.com/repos/keybase/kbfs/issues/1491"},"comments":{"href":"https://api.github.com/repos/keybase/kbfs/issues/1491/comments"},"review_comments":{"href":"https://api.github.com/repos/keybase/kbfs/pulls/1491/comments"},"review_comment":{"href":"https://api.github.com/repos/keybase/kbfs/pulls/comments{/number}"},"commits":{"href":"https://api.github.com/repos/keybase/kbfs/pulls/1491/commits"},"statuses":{"href":"https://api.github.com/repos/keybase/kbfs/statuses/e02a80616271b86332aa07b366e648c7a92d9f42"}},"author_association":"CONTRIBUTOR"}},"public":true,"created_at":"2018-02-27T23:18:41Z","org":{"id":5400834,"login":"keybase","gravatar_id":"","url":"https://api.github.com/orgs/keybase","avatar_url":"https://avatars.githubusercontent.com/u/5400834?"}},{"id":"7306751938","type":"PullRequestReviewCommentEvent","actor":{"id":860932,"login":"oconnor663","display_login":"oconnor663","gravatar_id":"","url":"https://api.github.com/users/oconnor663","avatar_url":"https://avatars.githubusercontent.com/u/860932?"},"repo":{"id":59787605,"name":"keybase/kbfs","url":"https://api.github.com/repos/keybase/kbfs"},"payload":{"action":"created","comment":{"url":"https://api.github.com/repos/keybase/kbfs/pulls/comments/171099232","pull_request_review_id":99893459,"id":171099232,"diff_hunk":"@@ -0,0 +1,180 @@\n+extern crate env_logger;\n+extern crate fuse;\n+extern crate libc;\n+extern crate log;\n+extern crate time;\n+\n+use std::env;\n+use std::ffi::OsStr;\n+use std::fs::File;\n+use std::io::prelude::*;\n+use std::io::BufReader;\n+use std::os::unix::prelude::*;\n+use std::path::PathBuf;\n+use libc::ENOENT;\n+use time::Timespec;\n+use fuse::{FileAttr, FileType, Filesystem, ReplyAttr, ReplyData, ReplyDirectory, ReplyEntry,\n+           Request};\n+\n+// A TTL of zero for all our attribute replies.\n+// TODO: Should this be nonzero for performance reasons?\n+const TTL: Timespec = Timespec { sec: 0, nsec: 0 };\n+\n+// FD 1 is a magical value that we can't change, but the others are arbitrary.\n+const ROOT_DIR_INODE: u64 = 1;\n+const PRIVATE_LINK_INODE: u64 = 2;\n+const PUBLIC_LINK_INODE: u64 = 3;\n+const TEAM_LINK_INODE: u64 = 4;\n+\n+struct Redirector {\n+    // We use the process start time for all of our stat timestamps.\n+    start_time: Timespec,\n+}\n+\n+impl Redirector {\n+    fn root_dir_attr(&self) -> FileAttr {\n+        FileAttr {\n+            ino: ROOT_DIR_INODE,\n+            size: 0,\n+            blocks: 0,\n+            atime: self.start_time,\n+            mtime: self.start_time,\n+            ctime: self.start_time,\n+            crtime: self.start_time,\n+            kind: FileType::Directory,\n+            perm: 0o755,\n+            nlink: 0,\n+            uid: 0,\n+            gid: 0,\n+            rdev: 0,\n+            flags: 0,\n+        }\n+    }\n+\n+    fn link_attr(&self, ino: u64) -> FileAttr {\n+        FileAttr {\n+            ino,\n+            size: 0,\n+            blocks: 0,\n+            atime: self.start_time,\n+            mtime: self.start_time,\n+            ctime: self.start_time,\n+            crtime: self.start_time,\n+            kind: FileType::Symlink,\n+            perm: 0o644,\n+            nlink: 0,\n+            uid: 0,\n+            gid: 0,\n+            rdev: 0,\n+            flags: 0,\n+        }\n+    }\n+}\n+\n+impl Filesystem for Redirector {\n+    fn lookup(&mut self, _req: &Request, _parent: u64, name: &OsStr, reply: ReplyEntry) {\n+        match name.to_str() {\n+            Some(\"private\") => reply.entry(&TTL, &self.link_attr(PRIVATE_LINK_INODE), 0),\n+            Some(\"public\") => reply.entry(&TTL, &self.link_attr(PUBLIC_LINK_INODE), 0),\n+            Some(\"team\") => reply.entry(&TTL, &self.link_attr(TEAM_LINK_INODE), 0),\n+            _ => reply.error(ENOENT),\n+        }\n+    }\n+\n+    fn getattr(&mut self, _req: &Request, ino: u64, reply: ReplyAttr) {\n+        match ino {\n+            ROOT_DIR_INODE => reply.attr(&TTL, &self.root_dir_attr()),\n+            PRIVATE_LINK_INODE | PUBLIC_LINK_INODE | TEAM_LINK_INODE => {\n+                reply.attr(&TTL, &self.link_attr(ino))\n+            }\n+            _ => reply.error(ENOENT),\n+        }\n+    }\n+\n+    fn readlink(&mut self, req: &Request, ino: u64, reply: ReplyData) {\n+        let subdir = match ino {\n+            PRIVATE_LINK_INODE => \"private\",\n+            PUBLIC_LINK_INODE => \"public\",\n+            TEAM_LINK_INODE => \"team\",\n+            _ => return reply.error(ENOENT),\n+        };\n+        // TODO: Should we cache the mountpoint somehow?\n+        if let Some(mountpoint) = get_keybase_fuse_mount(req.uid()) {\n+            let target = mountpoint.join(subdir);\n+            reply.data(target.as_os_str().as_bytes());\n+        } else {\n+            reply.error(ENOENT);\n+        }\n+    }\n+\n+    fn readdir(\n+        &mut self,\n+        _req: &Request,\n+        ino: u64,\n+        _fh: u64,\n+        offset: i64,\n+        mut reply: ReplyDirectory,\n+    ) {\n+        if ino == ROOT_DIR_INODE {\n+            if offset == 0 {\n+                reply.add(ROOT_DIR_INODE, 0, FileType::Directory, \".\");\n+                reply.add(ROOT_DIR_INODE, 1, FileType::Directory, \"..\");\n+                reply.add(PRIVATE_LINK_INODE, 2, FileType::Symlink, \"private\");\n+                reply.add(PUBLIC_LINK_INODE, 3, FileType::Symlink, \"public\");\n+                reply.add(TEAM_LINK_INODE, 4, FileType::Symlink, \"team\");\n+            }\n+            reply.ok();\n+        } else {\n+            reply.error(ENOENT);\n+        }\n+    }\n+}\n+\n+// This is explicitly only implemented for Linux, so that building on other\n+// platforms is a compiler error.\n+#[cfg(target_os = \"linux\")]\n+fn get_keybase_fuse_mount(uid: u32) -> Option<PathBuf> {\n+    let uid_str = format!(\"user_id={}\", uid);\n+    let file = File::open(\"/proc/mounts\").expect(\"failed to open /proc/mounts\");\n+    let reader = BufReader::new(file);\n+    // TODO: Avoid assuming UTF8?\n+    // TODO: Sort the paths first?\n+    for line in reader.lines() {\n+        let line = line.expect(\"failed to read from /proc/mounts\");\n+        let parts: Vec<&str> = line.split_whitespace().collect();\n+        // Check the mount type.\n+        if parts[2] != \"fuse\" {\n+            continue;\n+        }\n+        // Look for the uid in the mount options.\n+        if parts[3].split(',').find(|s| s == &uid_str).is_none() {\n+            continue;\n+        }\n+        // Make sure \"keybase\" is in the path somewhere. We do this loosely,\n+        // rather than splitting exactly on slashes, to handle \"keybase.devel\"\n+        // etc.\n+        if parts[1].to_lowercase().find(\"keybase\").is_none() {\n+            continue;\n+        }\n+        let path: PathBuf = parts[1].into();\n+        // TODO: We want to check that .kbfs_error exists, but the kbfsfuse\n+        // mount doesn't currently set \"allow_root\".\n+        return Some(path);\n+    }\n+    None\n+}\n+\n+fn main() {\n+    // The rust-fuse library writes logs using the standard log crate","path":"redirector.rs/src/main.rs","position":168,"original_position":168,"commit_id":"e02a80616271b86332aa07b366e648c7a92d9f42","original_commit_id":"e02a80616271b86332aa07b366e648c7a92d9f42","user":{"login":"oconnor663","id":860932,"avatar_url":"https://avatars0.githubusercontent.com/u/860932?v=4","gravatar_id":"","url":"https://api.github.com/users/oconnor663","html_url":"https://github.com/oconnor663","followers_url":"https://api.github.com/users/oconnor663/followers","following_url":"https://api.github.com/users/oconnor663/following{/other_user}","gists_url":"https://api.github.com/users/oconnor663/gists{/gist_id}","starred_url":"https://api.github.com/users/oconnor663/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oconnor663/subscriptions","organizations_url":"https://api.github.com/users/oconnor663/orgs","repos_url":"https://api.github.com/users/oconnor663/repos","events_url":"https://api.github.com/users/oconnor663/events{/privacy}","received_events_url":"https://api.github.com/users/oconnor663/received_events","type":"User","site_admin":false},"body":"This crate provides standard `error`/`warn`/etc methods, and an interface for backends to register to receive them: https://github.com/rust-lang-nursery/log. The rust-fuse library makes `debug` calls using those interfaces, but they're no-ops unless `main` registers a backend.","created_at":"2018-02-27T23:16:44Z","updated_at":"2018-02-27T23:16:44Z","html_url":"https://github.com/keybase/kbfs/pull/1491#discussion_r171099232","pull_request_url":"https://api.github.com/repos/keybase/kbfs/pulls/1491","author_association":"CONTRIBUTOR","_links":{"self":{"href":"https://api.github.com/repos/keybase/kbfs/pulls/comments/171099232"},"html":{"href":"https://github.com/keybase/kbfs/pull/1491#discussion_r171099232"},"pull_request":{"href":"https://api.github.com/repos/keybase/kbfs/pulls/1491"}},"in_reply_to_id":170748623},"pull_request":{"url":"https://api.github.com/repos/keybase/kbfs/pulls/1491","id":171474775,"html_url":"https://github.com/keybase/kbfs/pull/1491","diff_url":"https://github.com/keybase/kbfs/pull/1491.diff","patch_url":"https://github.com/keybase/kbfs/pull/1491.patch","issue_url":"https://api.github.com/repos/keybase/kbfs/issues/1491","number":1491,"state":"open","locked":false,"title":"initial Linux-only implementation of the Rust redirector","user":{"login":"oconnor663","id":860932,"avatar_url":"https://avatars0.githubusercontent.com/u/860932?v=4","gravatar_id":"","url":"https://api.github.com/users/oconnor663","html_url":"https://github.com/oconnor663","followers_url":"https://api.github.com/users/oconnor663/followers","following_url":"https://api.github.com/users/oconnor663/following{/other_user}","gists_url":"https://api.github.com/users/oconnor663/gists{/gist_id}","starred_url":"https://api.github.com/users/oconnor663/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oconnor663/subscriptions","organizations_url":"https://api.github.com/users/oconnor663/orgs","repos_url":"https://api.github.com/users/oconnor663/repos","events_url":"https://api.github.com/users/oconnor663/events{/privacy}","received_events_url":"https://api.github.com/users/oconnor663/received_events","type":"User","site_admin":false},"body":"r? @strib @akalin-keybase \r\n\r\ncc @jzila ","created_at":"2018-02-26T19:53:14Z","updated_at":"2018-02-27T23:16:44Z","closed_at":null,"merged_at":null,"merge_commit_sha":"34d9279de3079943939e029a63d6d15bf46e2ebe","assignee":null,"assignees":[],"requested_reviewers":[],"requested_teams":[],"labels":[],"milestone":null,"commits_url":"https://api.github.com/repos/keybase/kbfs/pulls/1491/commits","review_comments_url":"https://api.github.com/repos/keybase/kbfs/pulls/1491/comments","review_comment_url":"https://api.github.com/repos/keybase/kbfs/pulls/comments{/number}","comments_url":"https://api.github.com/repos/keybase/kbfs/issues/1491/comments","statuses_url":"https://api.github.com/repos/keybase/kbfs/statuses/e02a80616271b86332aa07b366e648c7a92d9f42","head":{"label":"keybase:jack/rust_redirector","ref":"jack/rust_redirector","sha":"e02a80616271b86332aa07b366e648c7a92d9f42","user":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"repo":{"id":59787605,"name":"kbfs","full_name":"keybase/kbfs","owner":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"private":false,"html_url":"https://github.com/keybase/kbfs","description":"Keybase Filesystem (KBFS)","fork":false,"url":"https://api.github.com/repos/keybase/kbfs","forks_url":"https://api.github.com/repos/keybase/kbfs/forks","keys_url":"https://api.github.com/repos/keybase/kbfs/keys{/key_id}","collaborators_url":"https://api.github.com/repos/keybase/kbfs/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/keybase/kbfs/teams","hooks_url":"https://api.github.com/repos/keybase/kbfs/hooks","issue_events_url":"https://api.github.com/repos/keybase/kbfs/issues/events{/number}","events_url":"https://api.github.com/repos/keybase/kbfs/events","assignees_url":"https://api.github.com/repos/keybase/kbfs/assignees{/user}","branches_url":"https://api.github.com/repos/keybase/kbfs/branches{/branch}","tags_url":"https://api.github.com/repos/keybase/kbfs/tags","blobs_url":"https://api.github.com/repos/keybase/kbfs/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/keybase/kbfs/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/keybase/kbfs/git/refs{/sha}","trees_url":"https://api.github.com/repos/keybase/kbfs/git/trees{/sha}","statuses_url":"https://api.github.com/repos/keybase/kbfs/statuses/{sha}","languages_url":"https://api.github.com/repos/keybase/kbfs/languages","stargazers_url":"https://api.github.com/repos/keybase/kbfs/stargazers","contributors_url":"https://api.github.com/repos/keybase/kbfs/contributors","subscribers_url":"https://api.github.com/repos/keybase/kbfs/subscribers","subscription_url":"https://api.github.com/repos/keybase/kbfs/subscription","commits_url":"https://api.github.com/repos/keybase/kbfs/commits{/sha}","git_commits_url":"https://api.github.com/repos/keybase/kbfs/git/commits{/sha}","comments_url":"https://api.github.com/repos/keybase/kbfs/comments{/number}","issue_comment_url":"https://api.github.com/repos/keybase/kbfs/issues/comments{/number}","contents_url":"https://api.github.com/repos/keybase/kbfs/contents/{+path}","compare_url":"https://api.github.com/repos/keybase/kbfs/compare/{base}...{head}","merges_url":"https://api.github.com/repos/keybase/kbfs/merges","archive_url":"https://api.github.com/repos/keybase/kbfs/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/keybase/kbfs/downloads","issues_url":"https://api.github.com/repos/keybase/kbfs/issues{/number}","pulls_url":"https://api.github.com/repos/keybase/kbfs/pulls{/number}","milestones_url":"https://api.github.com/repos/keybase/kbfs/milestones{/number}","notifications_url":"https://api.github.com/repos/keybase/kbfs/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/keybase/kbfs/labels{/name}","releases_url":"https://api.github.com/repos/keybase/kbfs/releases{/id}","deployments_url":"https://api.github.com/repos/keybase/kbfs/deployments","created_at":"2016-05-26T22:37:42Z","updated_at":"2018-02-27T19:35:08Z","pushed_at":"2018-02-27T19:36:42Z","git_url":"git://github.com/keybase/kbfs.git","ssh_url":"git@github.com:keybase/kbfs.git","clone_url":"https://github.com/keybase/kbfs.git","svn_url":"https://github.com/keybase/kbfs","homepage":"https://keybase.io/docs/kbfs","size":48517,"stargazers_count":884,"watchers_count":884,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"forks_count":76,"mirror_url":null,"archived":false,"open_issues_count":45,"license":{"key":"bsd-3-clause","name":"BSD 3-Clause \"New\" or \"Revised\" License","spdx_id":"BSD-3-Clause","url":"https://api.github.com/licenses/bsd-3-clause"},"forks":76,"open_issues":45,"watchers":884,"default_branch":"master"}},"base":{"label":"keybase:master","ref":"master","sha":"a2daa6ef4d35a216543363322670809b42c67818","user":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"repo":{"id":59787605,"name":"kbfs","full_name":"keybase/kbfs","owner":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"private":false,"html_url":"https://github.com/keybase/kbfs","description":"Keybase Filesystem (KBFS)","fork":false,"url":"https://api.github.com/repos/keybase/kbfs","forks_url":"https://api.github.com/repos/keybase/kbfs/forks","keys_url":"https://api.github.com/repos/keybase/kbfs/keys{/key_id}","collaborators_url":"https://api.github.com/repos/keybase/kbfs/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/keybase/kbfs/teams","hooks_url":"https://api.github.com/repos/keybase/kbfs/hooks","issue_events_url":"https://api.github.com/repos/keybase/kbfs/issues/events{/number}","events_url":"https://api.github.com/repos/keybase/kbfs/events","assignees_url":"https://api.github.com/repos/keybase/kbfs/assignees{/user}","branches_url":"https://api.github.com/repos/keybase/kbfs/branches{/branch}","tags_url":"https://api.github.com/repos/keybase/kbfs/tags","blobs_url":"https://api.github.com/repos/keybase/kbfs/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/keybase/kbfs/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/keybase/kbfs/git/refs{/sha}","trees_url":"https://api.github.com/repos/keybase/kbfs/git/trees{/sha}","statuses_url":"https://api.github.com/repos/keybase/kbfs/statuses/{sha}","languages_url":"https://api.github.com/repos/keybase/kbfs/languages","stargazers_url":"https://api.github.com/repos/keybase/kbfs/stargazers","contributors_url":"https://api.github.com/repos/keybase/kbfs/contributors","subscribers_url":"https://api.github.com/repos/keybase/kbfs/subscribers","subscription_url":"https://api.github.com/repos/keybase/kbfs/subscription","commits_url":"https://api.github.com/repos/keybase/kbfs/commits{/sha}","git_commits_url":"https://api.github.com/repos/keybase/kbfs/git/commits{/sha}","comments_url":"https://api.github.com/repos/keybase/kbfs/comments{/number}","issue_comment_url":"https://api.github.com/repos/keybase/kbfs/issues/comments{/number}","contents_url":"https://api.github.com/repos/keybase/kbfs/contents/{+path}","compare_url":"https://api.github.com/repos/keybase/kbfs/compare/{base}...{head}","merges_url":"https://api.github.com/repos/keybase/kbfs/merges","archive_url":"https://api.github.com/repos/keybase/kbfs/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/keybase/kbfs/downloads","issues_url":"https://api.github.com/repos/keybase/kbfs/issues{/number}","pulls_url":"https://api.github.com/repos/keybase/kbfs/pulls{/number}","milestones_url":"https://api.github.com/repos/keybase/kbfs/milestones{/number}","notifications_url":"https://api.github.com/repos/keybase/kbfs/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/keybase/kbfs/labels{/name}","releases_url":"https://api.github.com/repos/keybase/kbfs/releases{/id}","deployments_url":"https://api.github.com/repos/keybase/kbfs/deployments","created_at":"2016-05-26T22:37:42Z","updated_at":"2018-02-27T19:35:08Z","pushed_at":"2018-02-27T19:36:42Z","git_url":"git://github.com/keybase/kbfs.git","ssh_url":"git@github.com:keybase/kbfs.git","clone_url":"https://github.com/keybase/kbfs.git","svn_url":"https://github.com/keybase/kbfs","homepage":"https://keybase.io/docs/kbfs","size":48517,"stargazers_count":884,"watchers_count":884,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"forks_count":76,"mirror_url":null,"archived":false,"open_issues_count":45,"license":{"key":"bsd-3-clause","name":"BSD 3-Clause \"New\" or \"Revised\" License","spdx_id":"BSD-3-Clause","url":"https://api.github.com/licenses/bsd-3-clause"},"forks":76,"open_issues":45,"watchers":884,"default_branch":"master"}},"_links":{"self":{"href":"https://api.github.com/repos/keybase/kbfs/pulls/1491"},"html":{"href":"https://github.com/keybase/kbfs/pull/1491"},"issue":{"href":"https://api.github.com/repos/keybase/kbfs/issues/1491"},"comments":{"href":"https://api.github.com/repos/keybase/kbfs/issues/1491/comments"},"review_comments":{"href":"https://api.github.com/repos/keybase/kbfs/pulls/1491/comments"},"review_comment":{"href":"https://api.github.com/repos/keybase/kbfs/pulls/comments{/number}"},"commits":{"href":"https://api.github.com/repos/keybase/kbfs/pulls/1491/commits"},"statuses":{"href":"https://api.github.com/repos/keybase/kbfs/statuses/e02a80616271b86332aa07b366e648c7a92d9f42"}},"author_association":"CONTRIBUTOR"}},"public":true,"created_at":"2018-02-27T23:16:44Z","org":{"id":5400834,"login":"keybase","gravatar_id":"","url":"https://api.github.com/orgs/keybase","avatar_url":"https://avatars.githubusercontent.com/u/5400834?"}},{"id":"7306743153","type":"IssueCommentEvent","actor":{"id":860932,"login":"oconnor663","display_login":"oconnor663","gravatar_id":"","url":"https://api.github.com/users/oconnor663","avatar_url":"https://avatars.githubusercontent.com/u/860932?"},"repo":{"id":29099181,"name":"keybase/client","url":"https://api.github.com/repos/keybase/client"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/keybase/client/issues/10703","repository_url":"https://api.github.com/repos/keybase/client","labels_url":"https://api.github.com/repos/keybase/client/issues/10703/labels{/name}","comments_url":"https://api.github.com/repos/keybase/client/issues/10703/comments","events_url":"https://api.github.com/repos/keybase/client/issues/10703/events","html_url":"https://github.com/keybase/client/pull/10703","id":300437499,"number":10703,"title":"packaging: use root redirector on Linux instead of /keybase symlink","user":{"login":"strib","id":8516691,"avatar_url":"https://avatars0.githubusercontent.com/u/8516691?v=4","gravatar_id":"","url":"https://api.github.com/users/strib","html_url":"https://github.com/strib","followers_url":"https://api.github.com/users/strib/followers","following_url":"https://api.github.com/users/strib/following{/other_user}","gists_url":"https://api.github.com/users/strib/gists{/gist_id}","starred_url":"https://api.github.com/users/strib/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/strib/subscriptions","organizations_url":"https://api.github.com/users/strib/orgs","repos_url":"https://api.github.com/users/strib/repos","events_url":"https://api.github.com/users/strib/events{/privacy}","received_events_url":"https://api.github.com/users/strib/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2018-02-26T23:33:55Z","updated_at":"2018-02-27T23:14:24Z","closed_at":null,"author_association":"CONTRIBUTOR","pull_request":{"url":"https://api.github.com/repos/keybase/client/pulls/10703","html_url":"https://github.com/keybase/client/pull/10703","diff_url":"https://github.com/keybase/client/pull/10703.diff","patch_url":"https://github.com/keybase/client/pull/10703.patch"},"body":"This installs the `keybase-redirector` binary for linux packages.  Right now it just builds the Go one for testing; I'll merge this in on a branch (not `master` yet) and update it for the Rust redirector once that's ready.\r\n\r\nThe post-install script:\r\n\r\n* Removes `keybasehelper` and various directories that are no longer needed.\r\n* If the `/keybase` symlink is present, it gets removed and, if KBFS is currently mounted somewhere, the redirector is run in its place.\r\n* If there's a regular mount at `/keybase` from some older package (owned by some non-root user), it unmounts KBFS and makes `/keybase` owned by root.  It doesn't start the redirector by default in this case, since some user needs to run `run_keybase` anyway.\r\n* If there's already a redirector running at `/keybase`, it gets killed and restarted by root, in case the binary has been updated in this package.\r\n* If this is a fresh install, it prepares the `/keybase` directory but doesn't run the redirector yet.\r\n* Redirector logs go in `/root/.cache/keybase/keybase.redirector.log` if the redirector is started this way.\r\n\r\nThe `run_keybase` script attempts to launch the root redirector under `nohup` as whatever user runs the script.  This assumes that the redirector will quit silently, with a 0 exit code, if its already running.  It uses `nohup` even for the systemd case, because a) it's a very simple service, b) if it crashes it's no big deal, KBFS will still be working at the per-use mountpoint, and c) it's easy to start it again with another call to `run_keybase`. Redirector logs go in `/home/$USER/.cache/keybase/keybase.redirector.log` if the redirector is started this way.  \r\n\r\nIssue: KBFS-2783"},"comment":{"url":"https://api.github.com/repos/keybase/client/issues/comments/369061578","html_url":"https://github.com/keybase/client/pull/10703#issuecomment-369061578","issue_url":"https://api.github.com/repos/keybase/client/issues/10703","id":369061578,"user":{"login":"oconnor663","id":860932,"avatar_url":"https://avatars0.githubusercontent.com/u/860932?v=4","gravatar_id":"","url":"https://api.github.com/users/oconnor663","html_url":"https://github.com/oconnor663","followers_url":"https://api.github.com/users/oconnor663/followers","following_url":"https://api.github.com/users/oconnor663/following{/other_user}","gists_url":"https://api.github.com/users/oconnor663/gists{/gist_id}","starred_url":"https://api.github.com/users/oconnor663/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oconnor663/subscriptions","organizations_url":"https://api.github.com/users/oconnor663/orgs","repos_url":"https://api.github.com/users/oconnor663/repos","events_url":"https://api.github.com/users/oconnor663/events{/privacy}","received_events_url":"https://api.github.com/users/oconnor663/received_events","type":"User","site_admin":false},"created_at":"2018-02-27T23:14:24Z","updated_at":"2018-02-27T23:14:24Z","author_association":"CONTRIBUTOR","body":"Btw, what happens if someone `kill`'s the redirector process? Subsequent calls to `run_keybase` will fail to remount it until you do an explicit `fusermount -u` with root permissions, right? Is that ok? (I guess killing the redirector requires root permissions to begin with, so maybe we don't care.)"}},"public":true,"created_at":"2018-02-27T23:14:24Z","org":{"id":5400834,"login":"keybase","gravatar_id":"","url":"https://api.github.com/orgs/keybase","avatar_url":"https://avatars.githubusercontent.com/u/5400834?"}},{"id":"7306731351","type":"PullRequestReviewCommentEvent","actor":{"id":860932,"login":"oconnor663","display_login":"oconnor663","gravatar_id":"","url":"https://api.github.com/users/oconnor663","avatar_url":"https://avatars.githubusercontent.com/u/860932?"},"repo":{"id":59787605,"name":"keybase/kbfs","url":"https://api.github.com/repos/keybase/kbfs"},"payload":{"action":"created","comment":{"url":"https://api.github.com/repos/keybase/kbfs/pulls/comments/171098272","pull_request_review_id":99892266,"id":171098272,"diff_hunk":"@@ -0,0 +1,180 @@\n+extern crate env_logger;\n+extern crate fuse;\n+extern crate libc;\n+extern crate log;\n+extern crate time;\n+\n+use std::env;\n+use std::ffi::OsStr;\n+use std::fs::File;\n+use std::io::prelude::*;\n+use std::io::BufReader;\n+use std::os::unix::prelude::*;\n+use std::path::PathBuf;\n+use libc::ENOENT;\n+use time::Timespec;\n+use fuse::{FileAttr, FileType, Filesystem, ReplyAttr, ReplyData, ReplyDirectory, ReplyEntry,\n+           Request};\n+\n+// A TTL of zero for all our attribute replies.\n+// TODO: Should this be nonzero for performance reasons?\n+const TTL: Timespec = Timespec { sec: 0, nsec: 0 };\n+\n+// FD 1 is a magical value that we can't change, but the others are arbitrary.\n+const ROOT_DIR_INODE: u64 = 1;\n+const PRIVATE_LINK_INODE: u64 = 2;\n+const PUBLIC_LINK_INODE: u64 = 3;\n+const TEAM_LINK_INODE: u64 = 4;\n+\n+struct Redirector {\n+    // We use the process start time for all of our stat timestamps.\n+    start_time: Timespec,\n+}\n+\n+impl Redirector {\n+    fn root_dir_attr(&self) -> FileAttr {\n+        FileAttr {\n+            ino: ROOT_DIR_INODE,\n+            size: 0,\n+            blocks: 0,\n+            atime: self.start_time,\n+            mtime: self.start_time,\n+            ctime: self.start_time,\n+            crtime: self.start_time,\n+            kind: FileType::Directory,\n+            perm: 0o755,\n+            nlink: 0,\n+            uid: 0,\n+            gid: 0,\n+            rdev: 0,\n+            flags: 0,\n+        }\n+    }\n+\n+    fn link_attr(&self, ino: u64) -> FileAttr {\n+        FileAttr {\n+            ino,\n+            size: 0,\n+            blocks: 0,\n+            atime: self.start_time,\n+            mtime: self.start_time,\n+            ctime: self.start_time,\n+            crtime: self.start_time,\n+            kind: FileType::Symlink,\n+            perm: 0o644,\n+            nlink: 0,\n+            uid: 0,\n+            gid: 0,\n+            rdev: 0,\n+            flags: 0,\n+        }\n+    }\n+}\n+\n+impl Filesystem for Redirector {\n+    fn lookup(&mut self, _req: &Request, _parent: u64, name: &OsStr, reply: ReplyEntry) {\n+        match name.to_str() {\n+            Some(\"private\") => reply.entry(&TTL, &self.link_attr(PRIVATE_LINK_INODE), 0),\n+            Some(\"public\") => reply.entry(&TTL, &self.link_attr(PUBLIC_LINK_INODE), 0),\n+            Some(\"team\") => reply.entry(&TTL, &self.link_attr(TEAM_LINK_INODE), 0),\n+            _ => reply.error(ENOENT),\n+        }\n+    }\n+\n+    fn getattr(&mut self, _req: &Request, ino: u64, reply: ReplyAttr) {\n+        match ino {\n+            ROOT_DIR_INODE => reply.attr(&TTL, &self.root_dir_attr()),\n+            PRIVATE_LINK_INODE | PUBLIC_LINK_INODE | TEAM_LINK_INODE => {\n+                reply.attr(&TTL, &self.link_attr(ino))\n+            }\n+            _ => reply.error(ENOENT),\n+        }\n+    }\n+\n+    fn readlink(&mut self, req: &Request, ino: u64, reply: ReplyData) {\n+        let subdir = match ino {\n+            PRIVATE_LINK_INODE => \"private\",\n+            PUBLIC_LINK_INODE => \"public\",\n+            TEAM_LINK_INODE => \"team\",\n+            _ => return reply.error(ENOENT),\n+        };\n+        // TODO: Should we cache the mountpoint somehow?\n+        if let Some(mountpoint) = get_keybase_fuse_mount(req.uid()) {\n+            let target = mountpoint.join(subdir);\n+            reply.data(target.as_os_str().as_bytes());\n+        } else {\n+            reply.error(ENOENT);\n+        }\n+    }\n+\n+    fn readdir(\n+        &mut self,\n+        _req: &Request,\n+        ino: u64,\n+        _fh: u64,\n+        offset: i64,\n+        mut reply: ReplyDirectory,\n+    ) {\n+        if ino == ROOT_DIR_INODE {\n+            if offset == 0 {\n+                reply.add(ROOT_DIR_INODE, 0, FileType::Directory, \".\");\n+                reply.add(ROOT_DIR_INODE, 1, FileType::Directory, \"..\");\n+                reply.add(PRIVATE_LINK_INODE, 2, FileType::Symlink, \"private\");\n+                reply.add(PUBLIC_LINK_INODE, 3, FileType::Symlink, \"public\");\n+                reply.add(TEAM_LINK_INODE, 4, FileType::Symlink, \"team\");\n+            }\n+            reply.ok();\n+        } else {\n+            reply.error(ENOENT);\n+        }\n+    }\n+}\n+\n+// This is explicitly only implemented for Linux, so that building on other\n+// platforms is a compiler error.\n+#[cfg(target_os = \"linux\")]\n+fn get_keybase_fuse_mount(uid: u32) -> Option<PathBuf> {\n+    let uid_str = format!(\"user_id={}\", uid);\n+    let file = File::open(\"/proc/mounts\").expect(\"failed to open /proc/mounts\");\n+    let reader = BufReader::new(file);\n+    // TODO: Avoid assuming UTF8?\n+    // TODO: Sort the paths first?\n+    for line in reader.lines() {\n+        let line = line.expect(\"failed to read from /proc/mounts\");\n+        let parts: Vec<&str> = line.split_whitespace().collect();\n+        // Check the mount type.\n+        if parts[2] != \"fuse\" {\n+            continue;\n+        }\n+        // Look for the uid in the mount options.\n+        if parts[3].split(',').find(|s| s == &uid_str).is_none() {\n+            continue;\n+        }\n+        // Make sure \"keybase\" is in the path somewhere. We do this loosely,\n+        // rather than splitting exactly on slashes, to handle \"keybase.devel\"\n+        // etc.\n+        if parts[1].to_lowercase().find(\"keybase\").is_none() {\n+            continue;\n+        }\n+        let path: PathBuf = parts[1].into();\n+        // TODO: We want to check that .kbfs_error exists, but the kbfsfuse\n+        // mount doesn't currently set \"allow_root\".\n+        return Some(path);\n+    }\n+    None\n+}\n+\n+fn main() {\n+    // The rust-fuse library writes logs using the standard log crate\n+    // interface. To init a log backend that will actually print those,\n+    // uncomment this line:\n+    // env_logger::Builder::new().filter(None, log::LevelFilter::Debug).init();\n+\n+    let redirector = Redirector {\n+        start_time: time::get_time(),\n+    };\n+    let mountpoint = env::args_os().nth(1).expect(\"must have a path argument\");\n+    let options = &[\"-o\", \"allow_other\", \"-o\", \"fsname=keybase-redirector\"];\n+    let options_osstr: Vec<&OsStr> = options.iter().map(|o| o.as_ref()).collect();\n+    fuse::mount(redirector, &mountpoint, &options_osstr).expect(\"mount returned an error\");","path":"redirector.rs/src/main.rs","position":179,"original_position":179,"commit_id":"e02a80616271b86332aa07b366e648c7a92d9f42","original_commit_id":"e02a80616271b86332aa07b366e648c7a92d9f42","user":{"login":"oconnor663","id":860932,"avatar_url":"https://avatars0.githubusercontent.com/u/860932?v=4","gravatar_id":"","url":"https://api.github.com/users/oconnor663","html_url":"https://github.com/oconnor663","followers_url":"https://api.github.com/users/oconnor663/followers","following_url":"https://api.github.com/users/oconnor663/following{/other_user}","gists_url":"https://api.github.com/users/oconnor663/gists{/gist_id}","starred_url":"https://api.github.com/users/oconnor663/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oconnor663/subscriptions","organizations_url":"https://api.github.com/users/oconnor663/orgs","repos_url":"https://api.github.com/users/oconnor663/repos","events_url":"https://api.github.com/users/oconnor663/events{/privacy}","received_events_url":"https://api.github.com/users/oconnor663/received_events","type":"User","site_admin":false},"body":"I might be misunderstanding something important. Doesn't the SETUID bit in the file permissions take care of this?","created_at":"2018-02-27T23:11:23Z","updated_at":"2018-02-27T23:11:24Z","html_url":"https://github.com/keybase/kbfs/pull/1491#discussion_r171098272","pull_request_url":"https://api.github.com/repos/keybase/kbfs/pulls/1491","author_association":"CONTRIBUTOR","_links":{"self":{"href":"https://api.github.com/repos/keybase/kbfs/pulls/comments/171098272"},"html":{"href":"https://github.com/keybase/kbfs/pull/1491#discussion_r171098272"},"pull_request":{"href":"https://api.github.com/repos/keybase/kbfs/pulls/1491"}},"in_reply_to_id":170737678},"pull_request":{"url":"https://api.github.com/repos/keybase/kbfs/pulls/1491","id":171474775,"html_url":"https://github.com/keybase/kbfs/pull/1491","diff_url":"https://github.com/keybase/kbfs/pull/1491.diff","patch_url":"https://github.com/keybase/kbfs/pull/1491.patch","issue_url":"https://api.github.com/repos/keybase/kbfs/issues/1491","number":1491,"state":"open","locked":false,"title":"initial Linux-only implementation of the Rust redirector","user":{"login":"oconnor663","id":860932,"avatar_url":"https://avatars0.githubusercontent.com/u/860932?v=4","gravatar_id":"","url":"https://api.github.com/users/oconnor663","html_url":"https://github.com/oconnor663","followers_url":"https://api.github.com/users/oconnor663/followers","following_url":"https://api.github.com/users/oconnor663/following{/other_user}","gists_url":"https://api.github.com/users/oconnor663/gists{/gist_id}","starred_url":"https://api.github.com/users/oconnor663/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oconnor663/subscriptions","organizations_url":"https://api.github.com/users/oconnor663/orgs","repos_url":"https://api.github.com/users/oconnor663/repos","events_url":"https://api.github.com/users/oconnor663/events{/privacy}","received_events_url":"https://api.github.com/users/oconnor663/received_events","type":"User","site_admin":false},"body":"r? @strib @akalin-keybase \r\n\r\ncc @jzila ","created_at":"2018-02-26T19:53:14Z","updated_at":"2018-02-27T23:11:24Z","closed_at":null,"merged_at":null,"merge_commit_sha":"34d9279de3079943939e029a63d6d15bf46e2ebe","assignee":null,"assignees":[],"requested_reviewers":[],"requested_teams":[],"labels":[],"milestone":null,"commits_url":"https://api.github.com/repos/keybase/kbfs/pulls/1491/commits","review_comments_url":"https://api.github.com/repos/keybase/kbfs/pulls/1491/comments","review_comment_url":"https://api.github.com/repos/keybase/kbfs/pulls/comments{/number}","comments_url":"https://api.github.com/repos/keybase/kbfs/issues/1491/comments","statuses_url":"https://api.github.com/repos/keybase/kbfs/statuses/e02a80616271b86332aa07b366e648c7a92d9f42","head":{"label":"keybase:jack/rust_redirector","ref":"jack/rust_redirector","sha":"e02a80616271b86332aa07b366e648c7a92d9f42","user":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"repo":{"id":59787605,"name":"kbfs","full_name":"keybase/kbfs","owner":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"private":false,"html_url":"https://github.com/keybase/kbfs","description":"Keybase Filesystem (KBFS)","fork":false,"url":"https://api.github.com/repos/keybase/kbfs","forks_url":"https://api.github.com/repos/keybase/kbfs/forks","keys_url":"https://api.github.com/repos/keybase/kbfs/keys{/key_id}","collaborators_url":"https://api.github.com/repos/keybase/kbfs/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/keybase/kbfs/teams","hooks_url":"https://api.github.com/repos/keybase/kbfs/hooks","issue_events_url":"https://api.github.com/repos/keybase/kbfs/issues/events{/number}","events_url":"https://api.github.com/repos/keybase/kbfs/events","assignees_url":"https://api.github.com/repos/keybase/kbfs/assignees{/user}","branches_url":"https://api.github.com/repos/keybase/kbfs/branches{/branch}","tags_url":"https://api.github.com/repos/keybase/kbfs/tags","blobs_url":"https://api.github.com/repos/keybase/kbfs/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/keybase/kbfs/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/keybase/kbfs/git/refs{/sha}","trees_url":"https://api.github.com/repos/keybase/kbfs/git/trees{/sha}","statuses_url":"https://api.github.com/repos/keybase/kbfs/statuses/{sha}","languages_url":"https://api.github.com/repos/keybase/kbfs/languages","stargazers_url":"https://api.github.com/repos/keybase/kbfs/stargazers","contributors_url":"https://api.github.com/repos/keybase/kbfs/contributors","subscribers_url":"https://api.github.com/repos/keybase/kbfs/subscribers","subscription_url":"https://api.github.com/repos/keybase/kbfs/subscription","commits_url":"https://api.github.com/repos/keybase/kbfs/commits{/sha}","git_commits_url":"https://api.github.com/repos/keybase/kbfs/git/commits{/sha}","comments_url":"https://api.github.com/repos/keybase/kbfs/comments{/number}","issue_comment_url":"https://api.github.com/repos/keybase/kbfs/issues/comments{/number}","contents_url":"https://api.github.com/repos/keybase/kbfs/contents/{+path}","compare_url":"https://api.github.com/repos/keybase/kbfs/compare/{base}...{head}","merges_url":"https://api.github.com/repos/keybase/kbfs/merges","archive_url":"https://api.github.com/repos/keybase/kbfs/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/keybase/kbfs/downloads","issues_url":"https://api.github.com/repos/keybase/kbfs/issues{/number}","pulls_url":"https://api.github.com/repos/keybase/kbfs/pulls{/number}","milestones_url":"https://api.github.com/repos/keybase/kbfs/milestones{/number}","notifications_url":"https://api.github.com/repos/keybase/kbfs/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/keybase/kbfs/labels{/name}","releases_url":"https://api.github.com/repos/keybase/kbfs/releases{/id}","deployments_url":"https://api.github.com/repos/keybase/kbfs/deployments","created_at":"2016-05-26T22:37:42Z","updated_at":"2018-02-27T19:35:08Z","pushed_at":"2018-02-27T19:36:42Z","git_url":"git://github.com/keybase/kbfs.git","ssh_url":"git@github.com:keybase/kbfs.git","clone_url":"https://github.com/keybase/kbfs.git","svn_url":"https://github.com/keybase/kbfs","homepage":"https://keybase.io/docs/kbfs","size":48517,"stargazers_count":884,"watchers_count":884,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"forks_count":76,"mirror_url":null,"archived":false,"open_issues_count":45,"license":{"key":"bsd-3-clause","name":"BSD 3-Clause \"New\" or \"Revised\" License","spdx_id":"BSD-3-Clause","url":"https://api.github.com/licenses/bsd-3-clause"},"forks":76,"open_issues":45,"watchers":884,"default_branch":"master"}},"base":{"label":"keybase:master","ref":"master","sha":"a2daa6ef4d35a216543363322670809b42c67818","user":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"repo":{"id":59787605,"name":"kbfs","full_name":"keybase/kbfs","owner":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"private":false,"html_url":"https://github.com/keybase/kbfs","description":"Keybase Filesystem (KBFS)","fork":false,"url":"https://api.github.com/repos/keybase/kbfs","forks_url":"https://api.github.com/repos/keybase/kbfs/forks","keys_url":"https://api.github.com/repos/keybase/kbfs/keys{/key_id}","collaborators_url":"https://api.github.com/repos/keybase/kbfs/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/keybase/kbfs/teams","hooks_url":"https://api.github.com/repos/keybase/kbfs/hooks","issue_events_url":"https://api.github.com/repos/keybase/kbfs/issues/events{/number}","events_url":"https://api.github.com/repos/keybase/kbfs/events","assignees_url":"https://api.github.com/repos/keybase/kbfs/assignees{/user}","branches_url":"https://api.github.com/repos/keybase/kbfs/branches{/branch}","tags_url":"https://api.github.com/repos/keybase/kbfs/tags","blobs_url":"https://api.github.com/repos/keybase/kbfs/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/keybase/kbfs/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/keybase/kbfs/git/refs{/sha}","trees_url":"https://api.github.com/repos/keybase/kbfs/git/trees{/sha}","statuses_url":"https://api.github.com/repos/keybase/kbfs/statuses/{sha}","languages_url":"https://api.github.com/repos/keybase/kbfs/languages","stargazers_url":"https://api.github.com/repos/keybase/kbfs/stargazers","contributors_url":"https://api.github.com/repos/keybase/kbfs/contributors","subscribers_url":"https://api.github.com/repos/keybase/kbfs/subscribers","subscription_url":"https://api.github.com/repos/keybase/kbfs/subscription","commits_url":"https://api.github.com/repos/keybase/kbfs/commits{/sha}","git_commits_url":"https://api.github.com/repos/keybase/kbfs/git/commits{/sha}","comments_url":"https://api.github.com/repos/keybase/kbfs/comments{/number}","issue_comment_url":"https://api.github.com/repos/keybase/kbfs/issues/comments{/number}","contents_url":"https://api.github.com/repos/keybase/kbfs/contents/{+path}","compare_url":"https://api.github.com/repos/keybase/kbfs/compare/{base}...{head}","merges_url":"https://api.github.com/repos/keybase/kbfs/merges","archive_url":"https://api.github.com/repos/keybase/kbfs/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/keybase/kbfs/downloads","issues_url":"https://api.github.com/repos/keybase/kbfs/issues{/number}","pulls_url":"https://api.github.com/repos/keybase/kbfs/pulls{/number}","milestones_url":"https://api.github.com/repos/keybase/kbfs/milestones{/number}","notifications_url":"https://api.github.com/repos/keybase/kbfs/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/keybase/kbfs/labels{/name}","releases_url":"https://api.github.com/repos/keybase/kbfs/releases{/id}","deployments_url":"https://api.github.com/repos/keybase/kbfs/deployments","created_at":"2016-05-26T22:37:42Z","updated_at":"2018-02-27T19:35:08Z","pushed_at":"2018-02-27T19:36:42Z","git_url":"git://github.com/keybase/kbfs.git","ssh_url":"git@github.com:keybase/kbfs.git","clone_url":"https://github.com/keybase/kbfs.git","svn_url":"https://github.com/keybase/kbfs","homepage":"https://keybase.io/docs/kbfs","size":48517,"stargazers_count":884,"watchers_count":884,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"forks_count":76,"mirror_url":null,"archived":false,"open_issues_count":45,"license":{"key":"bsd-3-clause","name":"BSD 3-Clause \"New\" or \"Revised\" License","spdx_id":"BSD-3-Clause","url":"https://api.github.com/licenses/bsd-3-clause"},"forks":76,"open_issues":45,"watchers":884,"default_branch":"master"}},"_links":{"self":{"href":"https://api.github.com/repos/keybase/kbfs/pulls/1491"},"html":{"href":"https://github.com/keybase/kbfs/pull/1491"},"issue":{"href":"https://api.github.com/repos/keybase/kbfs/issues/1491"},"comments":{"href":"https://api.github.com/repos/keybase/kbfs/issues/1491/comments"},"review_comments":{"href":"https://api.github.com/repos/keybase/kbfs/pulls/1491/comments"},"review_comment":{"href":"https://api.github.com/repos/keybase/kbfs/pulls/comments{/number}"},"commits":{"href":"https://api.github.com/repos/keybase/kbfs/pulls/1491/commits"},"statuses":{"href":"https://api.github.com/repos/keybase/kbfs/statuses/e02a80616271b86332aa07b366e648c7a92d9f42"}},"author_association":"CONTRIBUTOR"}},"public":true,"created_at":"2018-02-27T23:11:23Z","org":{"id":5400834,"login":"keybase","gravatar_id":"","url":"https://api.github.com/orgs/keybase","avatar_url":"https://avatars.githubusercontent.com/u/5400834?"}},{"id":"7306642584","type":"PullRequestReviewCommentEvent","actor":{"id":860932,"login":"oconnor663","display_login":"oconnor663","gravatar_id":"","url":"https://api.github.com/users/oconnor663","avatar_url":"https://avatars.githubusercontent.com/u/860932?"},"repo":{"id":29099181,"name":"keybase/client","url":"https://api.github.com/repos/keybase/client"},"payload":{"action":"created","comment":{"url":"https://api.github.com/repos/keybase/client/pulls/comments/171074784","pull_request_review_id":99857614,"id":171074784,"diff_hunk":"@@ -1,56 +1,83 @@\n #! /usr/bin/env bash\n \n # This script handles distro-independent Linux post-install tasks. Currently\n-# that means creating the /keybase directory and making it writable. The deb-\n+# that means managing the /keybase redirector mountpoint. The deb-\n # and rpm-specific post-install scripts call into this after doing their\n # distro-specific work, which is mainly setting up package repos for updates.\n \n set -u\n \n-# Create the /keybase symlink to the first mountpoint, if it doesn't\n-# already exist. We can't use a regular [ -e ... ] check, because\n-# stat'ing /keybase fails with a permissions error when kbfsfuse is\n-# mounted, so that check always returns false. Instead we check\n-# whether mkdir succeeds.\n-rootlink=\"/keybase\"\n-vardir=\"/var/lib/keybase\"\n-mount1=\"$vardir/mount1\"\n-sample=\"/opt/keybase/mount-readme\"\n-khuser=\"keybasehelper\"\n-khbin=\"/usr/bin/keybase-mount-helper\"\n-\n-# Create the keybasehelper system user, without login privileges.\n-if useradd --system -s /bin/false -U -M $khuser &> /dev/null ; then\n-    echo Created $khuser system user for managing mountpoints.\n-fi\n+rootmount=\"/keybase\"\n+krbin=\"/usr/bin/keybase-redirector\"\n \n-chown \"$khuser\":\"$khuser\" \"$khbin\"\n-chmod 4755 \"$khbin\"\n-if mkdir $vardir &> /dev/null ; then\n-    ln -s \"$sample\" \"$mount1\"\n-    chown -R \"$khuser\":\"$khuser\" \"$vardir\"\n-fi\n+vardirDeprecated=\"/var/lib/keybase\"\n+khuserDeprecated=\"keybasehelper\"\n+khbinDeprecated=\"/usr/bin/keybase-mount-helper\"\n+optDeprecated=\"/opt/keybase/mount-readme\"\n+\n+chown root:root \"$krbin\"\n+chmod 4755 \"$krbin\"\n \n-currlink=`readlink $rootlink`\n-if [ -z \"$currlink\" ] ; then\n-    if fusermount -uz \"$rootlink\" &> /dev/null ; then\n+run_redirector() {\n+  logdir=\"${XDG_CACHE_HOME:-$HOME/.cache}/keybase\"\n+  mkdir -p \"$logdir\"\n+  nohup \"$krbin\" \"$rootmount\" >> $logdir/keybase.redirector.log 2>&1 &\n+}\n+\n+currlink=$(readlink -m \"$rootmount\")","path":"packaging/linux/post_install.sh","position":53,"original_position":53,"commit_id":"16c2a00c4b780ee2c47d725f0f6759452f729d63","original_commit_id":"16c2a00c4b780ee2c47d725f0f6759452f729d63","user":{"login":"oconnor663","id":860932,"avatar_url":"https://avatars0.githubusercontent.com/u/860932?v=4","gravatar_id":"","url":"https://api.github.com/users/oconnor663","html_url":"https://github.com/oconnor663","followers_url":"https://api.github.com/users/oconnor663/followers","following_url":"https://api.github.com/users/oconnor663/following{/other_user}","gists_url":"https://api.github.com/users/oconnor663/gists{/gist_id}","starred_url":"https://api.github.com/users/oconnor663/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oconnor663/subscriptions","organizations_url":"https://api.github.com/users/oconnor663/orgs","repos_url":"https://api.github.com/users/oconnor663/repos","events_url":"https://api.github.com/users/oconnor663/events{/privacy}","received_events_url":"https://api.github.com/users/oconnor663/received_events","type":"User","site_admin":false},"body":"Let's quote this `$(..)`","created_at":"2018-02-27T21:37:51Z","updated_at":"2018-02-27T22:49:56Z","html_url":"https://github.com/keybase/client/pull/10703#discussion_r171074784","pull_request_url":"https://api.github.com/repos/keybase/client/pulls/10703","author_association":"CONTRIBUTOR","_links":{"self":{"href":"https://api.github.com/repos/keybase/client/pulls/comments/171074784"},"html":{"href":"https://github.com/keybase/client/pull/10703#discussion_r171074784"},"pull_request":{"href":"https://api.github.com/repos/keybase/client/pulls/10703"}}},"pull_request":{"url":"https://api.github.com/repos/keybase/client/pulls/10703","id":171522845,"html_url":"https://github.com/keybase/client/pull/10703","diff_url":"https://github.com/keybase/client/pull/10703.diff","patch_url":"https://github.com/keybase/client/pull/10703.patch","issue_url":"https://api.github.com/repos/keybase/client/issues/10703","number":10703,"state":"open","locked":false,"title":"packaging: use root redirector on Linux instead of /keybase symlink","user":{"login":"strib","id":8516691,"avatar_url":"https://avatars0.githubusercontent.com/u/8516691?v=4","gravatar_id":"","url":"https://api.github.com/users/strib","html_url":"https://github.com/strib","followers_url":"https://api.github.com/users/strib/followers","following_url":"https://api.github.com/users/strib/following{/other_user}","gists_url":"https://api.github.com/users/strib/gists{/gist_id}","starred_url":"https://api.github.com/users/strib/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/strib/subscriptions","organizations_url":"https://api.github.com/users/strib/orgs","repos_url":"https://api.github.com/users/strib/repos","events_url":"https://api.github.com/users/strib/events{/privacy}","received_events_url":"https://api.github.com/users/strib/received_events","type":"User","site_admin":false},"body":"This installs the `keybase-redirector` binary for linux packages.  Right now it just builds the Go one for testing; I'll merge this in on a branch (not `master` yet) and update it for the Rust redirector once that's ready.\r\n\r\nThe post-install script:\r\n\r\n* Removes `keybasehelper` and various directories that are no longer needed.\r\n* If the `/keybase` symlink is present, it gets removed and, if KBFS is currently mounted somewhere, the redirector is run in its place.\r\n* If there's a regular mount at `/keybase` from some older package (owned by some non-root user), it unmounts KBFS and makes `/keybase` owned by root.  It doesn't start the redirector by default in this case, since some user needs to run `run_keybase` anyway.\r\n* If there's already a redirector running at `/keybase`, it gets killed and restarted by root, in case the binary has been updated in this package.\r\n* If this is a fresh install, it prepares the `/keybase` directory but doesn't run the redirector yet.\r\n* Redirector logs go in `/root/.cache/keybase/keybase.redirector.log` if the redirector is started this way.\r\n\r\nThe `run_keybase` script attempts to launch the root redirector under `nohup` as whatever user runs the script.  This assumes that the redirector will quit silently, with a 0 exit code, if its already running.  It uses `nohup` even for the systemd case, because a) it's a very simple service, b) if it crashes it's no big deal, KBFS will still be working at the per-use mountpoint, and c) it's easy to start it again with another call to `run_keybase`. Redirector logs go in `/home/$USER/.cache/keybase/keybase.redirector.log` if the redirector is started this way.  \r\n\r\nIssue: KBFS-2783","created_at":"2018-02-26T23:33:55Z","updated_at":"2018-02-27T22:49:56Z","closed_at":null,"merged_at":null,"merge_commit_sha":"4d249ffc66fa237f3bfe60cdcce927e3e27234f0","assignee":null,"assignees":[],"requested_reviewers":[],"requested_teams":[],"labels":[],"milestone":null,"commits_url":"https://api.github.com/repos/keybase/client/pulls/10703/commits","review_comments_url":"https://api.github.com/repos/keybase/client/pulls/10703/comments","review_comment_url":"https://api.github.com/repos/keybase/client/pulls/comments{/number}","comments_url":"https://api.github.com/repos/keybase/client/issues/10703/comments","statuses_url":"https://api.github.com/repos/keybase/client/statuses/16c2a00c4b780ee2c47d725f0f6759452f729d63","head":{"label":"keybase:strib/KBFS-2783-linux-root-redirector","ref":"strib/KBFS-2783-linux-root-redirector","sha":"16c2a00c4b780ee2c47d725f0f6759452f729d63","user":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"repo":{"id":29099181,"name":"client","full_name":"keybase/client","owner":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"private":false,"html_url":"https://github.com/keybase/client","description":"Keybase Go Library, Client, Service, OS X, iOS, Android, Electron","fork":false,"url":"https://api.github.com/repos/keybase/client","forks_url":"https://api.github.com/repos/keybase/client/forks","keys_url":"https://api.github.com/repos/keybase/client/keys{/key_id}","collaborators_url":"https://api.github.com/repos/keybase/client/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/keybase/client/teams","hooks_url":"https://api.github.com/repos/keybase/client/hooks","issue_events_url":"https://api.github.com/repos/keybase/client/issues/events{/number}","events_url":"https://api.github.com/repos/keybase/client/events","assignees_url":"https://api.github.com/repos/keybase/client/assignees{/user}","branches_url":"https://api.github.com/repos/keybase/client/branches{/branch}","tags_url":"https://api.github.com/repos/keybase/client/tags","blobs_url":"https://api.github.com/repos/keybase/client/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/keybase/client/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/keybase/client/git/refs{/sha}","trees_url":"https://api.github.com/repos/keybase/client/git/trees{/sha}","statuses_url":"https://api.github.com/repos/keybase/client/statuses/{sha}","languages_url":"https://api.github.com/repos/keybase/client/languages","stargazers_url":"https://api.github.com/repos/keybase/client/stargazers","contributors_url":"https://api.github.com/repos/keybase/client/contributors","subscribers_url":"https://api.github.com/repos/keybase/client/subscribers","subscription_url":"https://api.github.com/repos/keybase/client/subscription","commits_url":"https://api.github.com/repos/keybase/client/commits{/sha}","git_commits_url":"https://api.github.com/repos/keybase/client/git/commits{/sha}","comments_url":"https://api.github.com/repos/keybase/client/comments{/number}","issue_comment_url":"https://api.github.com/repos/keybase/client/issues/comments{/number}","contents_url":"https://api.github.com/repos/keybase/client/contents/{+path}","compare_url":"https://api.github.com/repos/keybase/client/compare/{base}...{head}","merges_url":"https://api.github.com/repos/keybase/client/merges","archive_url":"https://api.github.com/repos/keybase/client/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/keybase/client/downloads","issues_url":"https://api.github.com/repos/keybase/client/issues{/number}","pulls_url":"https://api.github.com/repos/keybase/client/pulls{/number}","milestones_url":"https://api.github.com/repos/keybase/client/milestones{/number}","notifications_url":"https://api.github.com/repos/keybase/client/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/keybase/client/labels{/name}","releases_url":"https://api.github.com/repos/keybase/client/releases{/id}","deployments_url":"https://api.github.com/repos/keybase/client/deployments","created_at":"2015-01-11T17:17:12Z","updated_at":"2018-02-27T21:58:58Z","pushed_at":"2018-02-27T22:48:52Z","git_url":"git://github.com/keybase/client.git","ssh_url":"git@github.com:keybase/client.git","clone_url":"https://github.com/keybase/client.git","svn_url":"https://github.com/keybase/client","homepage":"","size":222868,"stargazers_count":3291,"watchers_count":3291,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"forks_count":316,"mirror_url":null,"archived":false,"open_issues_count":1894,"license":{"key":"bsd-3-clause","name":"BSD 3-Clause \"New\" or \"Revised\" License","spdx_id":"BSD-3-Clause","url":"https://api.github.com/licenses/bsd-3-clause"},"forks":316,"open_issues":1894,"watchers":3291,"default_branch":"master"}},"base":{"label":"keybase:strib/KBFS-2782-root-redirector","ref":"strib/KBFS-2782-root-redirector","sha":"e003a13399620f9fa7adce65c9e0e91988f884e6","user":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"repo":{"id":29099181,"name":"client","full_name":"keybase/client","owner":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"private":false,"html_url":"https://github.com/keybase/client","description":"Keybase Go Library, Client, Service, OS X, iOS, Android, Electron","fork":false,"url":"https://api.github.com/repos/keybase/client","forks_url":"https://api.github.com/repos/keybase/client/forks","keys_url":"https://api.github.com/repos/keybase/client/keys{/key_id}","collaborators_url":"https://api.github.com/repos/keybase/client/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/keybase/client/teams","hooks_url":"https://api.github.com/repos/keybase/client/hooks","issue_events_url":"https://api.github.com/repos/keybase/client/issues/events{/number}","events_url":"https://api.github.com/repos/keybase/client/events","assignees_url":"https://api.github.com/repos/keybase/client/assignees{/user}","branches_url":"https://api.github.com/repos/keybase/client/branches{/branch}","tags_url":"https://api.github.com/repos/keybase/client/tags","blobs_url":"https://api.github.com/repos/keybase/client/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/keybase/client/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/keybase/client/git/refs{/sha}","trees_url":"https://api.github.com/repos/keybase/client/git/trees{/sha}","statuses_url":"https://api.github.com/repos/keybase/client/statuses/{sha}","languages_url":"https://api.github.com/repos/keybase/client/languages","stargazers_url":"https://api.github.com/repos/keybase/client/stargazers","contributors_url":"https://api.github.com/repos/keybase/client/contributors","subscribers_url":"https://api.github.com/repos/keybase/client/subscribers","subscription_url":"https://api.github.com/repos/keybase/client/subscription","commits_url":"https://api.github.com/repos/keybase/client/commits{/sha}","git_commits_url":"https://api.github.com/repos/keybase/client/git/commits{/sha}","comments_url":"https://api.github.com/repos/keybase/client/comments{/number}","issue_comment_url":"https://api.github.com/repos/keybase/client/issues/comments{/number}","contents_url":"https://api.github.com/repos/keybase/client/contents/{+path}","compare_url":"https://api.github.com/repos/keybase/client/compare/{base}...{head}","merges_url":"https://api.github.com/repos/keybase/client/merges","archive_url":"https://api.github.com/repos/keybase/client/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/keybase/client/downloads","issues_url":"https://api.github.com/repos/keybase/client/issues{/number}","pulls_url":"https://api.github.com/repos/keybase/client/pulls{/number}","milestones_url":"https://api.github.com/repos/keybase/client/milestones{/number}","notifications_url":"https://api.github.com/repos/keybase/client/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/keybase/client/labels{/name}","releases_url":"https://api.github.com/repos/keybase/client/releases{/id}","deployments_url":"https://api.github.com/repos/keybase/client/deployments","created_at":"2015-01-11T17:17:12Z","updated_at":"2018-02-27T21:58:58Z","pushed_at":"2018-02-27T22:48:52Z","git_url":"git://github.com/keybase/client.git","ssh_url":"git@github.com:keybase/client.git","clone_url":"https://github.com/keybase/client.git","svn_url":"https://github.com/keybase/client","homepage":"","size":222868,"stargazers_count":3291,"watchers_count":3291,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"forks_count":316,"mirror_url":null,"archived":false,"open_issues_count":1894,"license":{"key":"bsd-3-clause","name":"BSD 3-Clause \"New\" or \"Revised\" License","spdx_id":"BSD-3-Clause","url":"https://api.github.com/licenses/bsd-3-clause"},"forks":316,"open_issues":1894,"watchers":3291,"default_branch":"master"}},"_links":{"self":{"href":"https://api.github.com/repos/keybase/client/pulls/10703"},"html":{"href":"https://github.com/keybase/client/pull/10703"},"issue":{"href":"https://api.github.com/repos/keybase/client/issues/10703"},"comments":{"href":"https://api.github.com/repos/keybase/client/issues/10703/comments"},"review_comments":{"href":"https://api.github.com/repos/keybase/client/pulls/10703/comments"},"review_comment":{"href":"https://api.github.com/repos/keybase/client/pulls/comments{/number}"},"commits":{"href":"https://api.github.com/repos/keybase/client/pulls/10703/commits"},"statuses":{"href":"https://api.github.com/repos/keybase/client/statuses/16c2a00c4b780ee2c47d725f0f6759452f729d63"}},"author_association":"CONTRIBUTOR"}},"public":true,"created_at":"2018-02-27T21:37:51Z","org":{"id":5400834,"login":"keybase","gravatar_id":"","url":"https://api.github.com/orgs/keybase","avatar_url":"https://avatars.githubusercontent.com/u/5400834?"}},{"id":"7306642578","type":"PullRequestReviewCommentEvent","actor":{"id":860932,"login":"oconnor663","display_login":"oconnor663","gravatar_id":"","url":"https://api.github.com/users/oconnor663","avatar_url":"https://avatars.githubusercontent.com/u/860932?"},"repo":{"id":29099181,"name":"keybase/client","url":"https://api.github.com/repos/keybase/client"},"payload":{"action":"created","comment":{"url":"https://api.github.com/repos/keybase/client/pulls/comments/171069476","pull_request_review_id":99857614,"id":171069476,"diff_hunk":"@@ -113,13 +113,14 @@ export debian_arch=i386\n # OpenSUSE. This is the most compatible set of dependencies we've\n # found.  \"psmisc\" provides \"killall\", which is used in run_keybase.\n # \"initscripts\" provides \"service\", which is used to start atd in the\n-# post-install.\n-dependencies=\"Requires: at, fuse, libXss.so.1, initscripts, psmisc\"\n+# post-install. \"coreutils\" provides \"nohup\", which is used in\n+# run_keybase.\n+dependencies=\"Requires: at, fuse, libXss.so.1, initscripts, psmisc, coreutils\"","path":"packaging/linux/rpm/package_binaries.sh","position":8,"original_position":8,"commit_id":"16c2a00c4b780ee2c47d725f0f6759452f729d63","original_commit_id":"16c2a00c4b780ee2c47d725f0f6759452f729d63","user":{"login":"oconnor663","id":860932,"avatar_url":"https://avatars0.githubusercontent.com/u/860932?v=4","gravatar_id":"","url":"https://api.github.com/users/oconnor663","html_url":"https://github.com/oconnor663","followers_url":"https://api.github.com/users/oconnor663/followers","following_url":"https://api.github.com/users/oconnor663/following{/other_user}","gists_url":"https://api.github.com/users/oconnor663/gists{/gist_id}","starred_url":"https://api.github.com/users/oconnor663/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oconnor663/subscriptions","organizations_url":"https://api.github.com/users/oconnor663/orgs","repos_url":"https://api.github.com/users/oconnor663/repos","events_url":"https://api.github.com/users/oconnor663/events{/privacy}","received_events_url":"https://api.github.com/users/oconnor663/received_events","type":"User","site_admin":false},"body":"What happens if we don't have `coreutils` here? Is it just that Docker tests fail without it? I wonder if we should use images with more standard packages preinstalled?","created_at":"2018-02-27T21:19:00Z","updated_at":"2018-02-27T22:49:56Z","html_url":"https://github.com/keybase/client/pull/10703#discussion_r171069476","pull_request_url":"https://api.github.com/repos/keybase/client/pulls/10703","author_association":"CONTRIBUTOR","_links":{"self":{"href":"https://api.github.com/repos/keybase/client/pulls/comments/171069476"},"html":{"href":"https://github.com/keybase/client/pull/10703#discussion_r171069476"},"pull_request":{"href":"https://api.github.com/repos/keybase/client/pulls/10703"}}},"pull_request":{"url":"https://api.github.com/repos/keybase/client/pulls/10703","id":171522845,"html_url":"https://github.com/keybase/client/pull/10703","diff_url":"https://github.com/keybase/client/pull/10703.diff","patch_url":"https://github.com/keybase/client/pull/10703.patch","issue_url":"https://api.github.com/repos/keybase/client/issues/10703","number":10703,"state":"open","locked":false,"title":"packaging: use root redirector on Linux instead of /keybase symlink","user":{"login":"strib","id":8516691,"avatar_url":"https://avatars0.githubusercontent.com/u/8516691?v=4","gravatar_id":"","url":"https://api.github.com/users/strib","html_url":"https://github.com/strib","followers_url":"https://api.github.com/users/strib/followers","following_url":"https://api.github.com/users/strib/following{/other_user}","gists_url":"https://api.github.com/users/strib/gists{/gist_id}","starred_url":"https://api.github.com/users/strib/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/strib/subscriptions","organizations_url":"https://api.github.com/users/strib/orgs","repos_url":"https://api.github.com/users/strib/repos","events_url":"https://api.github.com/users/strib/events{/privacy}","received_events_url":"https://api.github.com/users/strib/received_events","type":"User","site_admin":false},"body":"This installs the `keybase-redirector` binary for linux packages.  Right now it just builds the Go one for testing; I'll merge this in on a branch (not `master` yet) and update it for the Rust redirector once that's ready.\r\n\r\nThe post-install script:\r\n\r\n* Removes `keybasehelper` and various directories that are no longer needed.\r\n* If the `/keybase` symlink is present, it gets removed and, if KBFS is currently mounted somewhere, the redirector is run in its place.\r\n* If there's a regular mount at `/keybase` from some older package (owned by some non-root user), it unmounts KBFS and makes `/keybase` owned by root.  It doesn't start the redirector by default in this case, since some user needs to run `run_keybase` anyway.\r\n* If there's already a redirector running at `/keybase`, it gets killed and restarted by root, in case the binary has been updated in this package.\r\n* If this is a fresh install, it prepares the `/keybase` directory but doesn't run the redirector yet.\r\n* Redirector logs go in `/root/.cache/keybase/keybase.redirector.log` if the redirector is started this way.\r\n\r\nThe `run_keybase` script attempts to launch the root redirector under `nohup` as whatever user runs the script.  This assumes that the redirector will quit silently, with a 0 exit code, if its already running.  It uses `nohup` even for the systemd case, because a) it's a very simple service, b) if it crashes it's no big deal, KBFS will still be working at the per-use mountpoint, and c) it's easy to start it again with another call to `run_keybase`. Redirector logs go in `/home/$USER/.cache/keybase/keybase.redirector.log` if the redirector is started this way.  \r\n\r\nIssue: KBFS-2783","created_at":"2018-02-26T23:33:55Z","updated_at":"2018-02-27T22:49:56Z","closed_at":null,"merged_at":null,"merge_commit_sha":"4d249ffc66fa237f3bfe60cdcce927e3e27234f0","assignee":null,"assignees":[],"requested_reviewers":[],"requested_teams":[],"labels":[],"milestone":null,"commits_url":"https://api.github.com/repos/keybase/client/pulls/10703/commits","review_comments_url":"https://api.github.com/repos/keybase/client/pulls/10703/comments","review_comment_url":"https://api.github.com/repos/keybase/client/pulls/comments{/number}","comments_url":"https://api.github.com/repos/keybase/client/issues/10703/comments","statuses_url":"https://api.github.com/repos/keybase/client/statuses/16c2a00c4b780ee2c47d725f0f6759452f729d63","head":{"label":"keybase:strib/KBFS-2783-linux-root-redirector","ref":"strib/KBFS-2783-linux-root-redirector","sha":"16c2a00c4b780ee2c47d725f0f6759452f729d63","user":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"repo":{"id":29099181,"name":"client","full_name":"keybase/client","owner":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"private":false,"html_url":"https://github.com/keybase/client","description":"Keybase Go Library, Client, Service, OS X, iOS, Android, Electron","fork":false,"url":"https://api.github.com/repos/keybase/client","forks_url":"https://api.github.com/repos/keybase/client/forks","keys_url":"https://api.github.com/repos/keybase/client/keys{/key_id}","collaborators_url":"https://api.github.com/repos/keybase/client/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/keybase/client/teams","hooks_url":"https://api.github.com/repos/keybase/client/hooks","issue_events_url":"https://api.github.com/repos/keybase/client/issues/events{/number}","events_url":"https://api.github.com/repos/keybase/client/events","assignees_url":"https://api.github.com/repos/keybase/client/assignees{/user}","branches_url":"https://api.github.com/repos/keybase/client/branches{/branch}","tags_url":"https://api.github.com/repos/keybase/client/tags","blobs_url":"https://api.github.com/repos/keybase/client/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/keybase/client/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/keybase/client/git/refs{/sha}","trees_url":"https://api.github.com/repos/keybase/client/git/trees{/sha}","statuses_url":"https://api.github.com/repos/keybase/client/statuses/{sha}","languages_url":"https://api.github.com/repos/keybase/client/languages","stargazers_url":"https://api.github.com/repos/keybase/client/stargazers","contributors_url":"https://api.github.com/repos/keybase/client/contributors","subscribers_url":"https://api.github.com/repos/keybase/client/subscribers","subscription_url":"https://api.github.com/repos/keybase/client/subscription","commits_url":"https://api.github.com/repos/keybase/client/commits{/sha}","git_commits_url":"https://api.github.com/repos/keybase/client/git/commits{/sha}","comments_url":"https://api.github.com/repos/keybase/client/comments{/number}","issue_comment_url":"https://api.github.com/repos/keybase/client/issues/comments{/number}","contents_url":"https://api.github.com/repos/keybase/client/contents/{+path}","compare_url":"https://api.github.com/repos/keybase/client/compare/{base}...{head}","merges_url":"https://api.github.com/repos/keybase/client/merges","archive_url":"https://api.github.com/repos/keybase/client/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/keybase/client/downloads","issues_url":"https://api.github.com/repos/keybase/client/issues{/number}","pulls_url":"https://api.github.com/repos/keybase/client/pulls{/number}","milestones_url":"https://api.github.com/repos/keybase/client/milestones{/number}","notifications_url":"https://api.github.com/repos/keybase/client/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/keybase/client/labels{/name}","releases_url":"https://api.github.com/repos/keybase/client/releases{/id}","deployments_url":"https://api.github.com/repos/keybase/client/deployments","created_at":"2015-01-11T17:17:12Z","updated_at":"2018-02-27T21:58:58Z","pushed_at":"2018-02-27T22:48:52Z","git_url":"git://github.com/keybase/client.git","ssh_url":"git@github.com:keybase/client.git","clone_url":"https://github.com/keybase/client.git","svn_url":"https://github.com/keybase/client","homepage":"","size":222868,"stargazers_count":3291,"watchers_count":3291,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"forks_count":316,"mirror_url":null,"archived":false,"open_issues_count":1894,"license":{"key":"bsd-3-clause","name":"BSD 3-Clause \"New\" or \"Revised\" License","spdx_id":"BSD-3-Clause","url":"https://api.github.com/licenses/bsd-3-clause"},"forks":316,"open_issues":1894,"watchers":3291,"default_branch":"master"}},"base":{"label":"keybase:strib/KBFS-2782-root-redirector","ref":"strib/KBFS-2782-root-redirector","sha":"e003a13399620f9fa7adce65c9e0e91988f884e6","user":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"repo":{"id":29099181,"name":"client","full_name":"keybase/client","owner":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"private":false,"html_url":"https://github.com/keybase/client","description":"Keybase Go Library, Client, Service, OS X, iOS, Android, Electron","fork":false,"url":"https://api.github.com/repos/keybase/client","forks_url":"https://api.github.com/repos/keybase/client/forks","keys_url":"https://api.github.com/repos/keybase/client/keys{/key_id}","collaborators_url":"https://api.github.com/repos/keybase/client/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/keybase/client/teams","hooks_url":"https://api.github.com/repos/keybase/client/hooks","issue_events_url":"https://api.github.com/repos/keybase/client/issues/events{/number}","events_url":"https://api.github.com/repos/keybase/client/events","assignees_url":"https://api.github.com/repos/keybase/client/assignees{/user}","branches_url":"https://api.github.com/repos/keybase/client/branches{/branch}","tags_url":"https://api.github.com/repos/keybase/client/tags","blobs_url":"https://api.github.com/repos/keybase/client/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/keybase/client/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/keybase/client/git/refs{/sha}","trees_url":"https://api.github.com/repos/keybase/client/git/trees{/sha}","statuses_url":"https://api.github.com/repos/keybase/client/statuses/{sha}","languages_url":"https://api.github.com/repos/keybase/client/languages","stargazers_url":"https://api.github.com/repos/keybase/client/stargazers","contributors_url":"https://api.github.com/repos/keybase/client/contributors","subscribers_url":"https://api.github.com/repos/keybase/client/subscribers","subscription_url":"https://api.github.com/repos/keybase/client/subscription","commits_url":"https://api.github.com/repos/keybase/client/commits{/sha}","git_commits_url":"https://api.github.com/repos/keybase/client/git/commits{/sha}","comments_url":"https://api.github.com/repos/keybase/client/comments{/number}","issue_comment_url":"https://api.github.com/repos/keybase/client/issues/comments{/number}","contents_url":"https://api.github.com/repos/keybase/client/contents/{+path}","compare_url":"https://api.github.com/repos/keybase/client/compare/{base}...{head}","merges_url":"https://api.github.com/repos/keybase/client/merges","archive_url":"https://api.github.com/repos/keybase/client/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/keybase/client/downloads","issues_url":"https://api.github.com/repos/keybase/client/issues{/number}","pulls_url":"https://api.github.com/repos/keybase/client/pulls{/number}","milestones_url":"https://api.github.com/repos/keybase/client/milestones{/number}","notifications_url":"https://api.github.com/repos/keybase/client/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/keybase/client/labels{/name}","releases_url":"https://api.github.com/repos/keybase/client/releases{/id}","deployments_url":"https://api.github.com/repos/keybase/client/deployments","created_at":"2015-01-11T17:17:12Z","updated_at":"2018-02-27T21:58:58Z","pushed_at":"2018-02-27T22:48:52Z","git_url":"git://github.com/keybase/client.git","ssh_url":"git@github.com:keybase/client.git","clone_url":"https://github.com/keybase/client.git","svn_url":"https://github.com/keybase/client","homepage":"","size":222868,"stargazers_count":3291,"watchers_count":3291,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"forks_count":316,"mirror_url":null,"archived":false,"open_issues_count":1894,"license":{"key":"bsd-3-clause","name":"BSD 3-Clause \"New\" or \"Revised\" License","spdx_id":"BSD-3-Clause","url":"https://api.github.com/licenses/bsd-3-clause"},"forks":316,"open_issues":1894,"watchers":3291,"default_branch":"master"}},"_links":{"self":{"href":"https://api.github.com/repos/keybase/client/pulls/10703"},"html":{"href":"https://github.com/keybase/client/pull/10703"},"issue":{"href":"https://api.github.com/repos/keybase/client/issues/10703"},"comments":{"href":"https://api.github.com/repos/keybase/client/issues/10703/comments"},"review_comments":{"href":"https://api.github.com/repos/keybase/client/pulls/10703/comments"},"review_comment":{"href":"https://api.github.com/repos/keybase/client/pulls/comments{/number}"},"commits":{"href":"https://api.github.com/repos/keybase/client/pulls/10703/commits"},"statuses":{"href":"https://api.github.com/repos/keybase/client/statuses/16c2a00c4b780ee2c47d725f0f6759452f729d63"}},"author_association":"CONTRIBUTOR"}},"public":true,"created_at":"2018-02-27T21:19:00Z","org":{"id":5400834,"login":"keybase","gravatar_id":"","url":"https://api.github.com/orgs/keybase","avatar_url":"https://avatars.githubusercontent.com/u/5400834?"}},{"id":"7306129122","type":"PullRequestReviewCommentEvent","actor":{"id":860932,"login":"oconnor663","display_login":"oconnor663","gravatar_id":"","url":"https://api.github.com/users/oconnor663","avatar_url":"https://avatars.githubusercontent.com/u/860932?"},"repo":{"id":29099181,"name":"keybase/client","url":"https://api.github.com/repos/keybase/client"},"payload":{"action":"created","comment":{"url":"https://api.github.com/repos/keybase/client/pulls/comments/171065159","pull_request_review_id":99853488,"id":171065159,"diff_hunk":"@@ -30,8 +30,10 @@ if [ \"$mode\" = \"production\" ] ; then\n   repo_url=\"http://dist.keybase.io/linux/deb/repo\"\n elif [ \"$mode\" = \"prerelease\" ] ; then\n   repo_url=\"http://prerelease.keybase.io/deb\"\n-  # \"psmisc\" provides \"killall\", which is used in run_keybase.\n-  dependencies=\"Depends: libappindicator1, fuse, libgconf-2-4, psmisc\"\n+  # * \"psmisc\" provides \"killall\", which is used in run_keybase and\n+  #   post_install.sh.\n+  # * \"coreutils\" provides \"nohup\", which is used in run_keybase.\n+  dependencies=\"Depends: libappindicator1, fuse, libgconf-2-4, psmisc, coreutils\"","path":"packaging/linux/deb/package_binaries.sh","position":9,"original_position":9,"commit_id":"16c2a00c4b780ee2c47d725f0f6759452f729d63","original_commit_id":"d6fc396668e9e5bbf6233af55a8b158856c6dd52","user":{"login":"oconnor663","id":860932,"avatar_url":"https://avatars0.githubusercontent.com/u/860932?v=4","gravatar_id":"","url":"https://api.github.com/users/oconnor663","html_url":"https://github.com/oconnor663","followers_url":"https://api.github.com/users/oconnor663/followers","following_url":"https://api.github.com/users/oconnor663/following{/other_user}","gists_url":"https://api.github.com/users/oconnor663/gists{/gist_id}","starred_url":"https://api.github.com/users/oconnor663/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oconnor663/subscriptions","organizations_url":"https://api.github.com/users/oconnor663/orgs","repos_url":"https://api.github.com/users/oconnor663/repos","events_url":"https://api.github.com/users/oconnor663/events{/privacy}","received_events_url":"https://api.github.com/users/oconnor663/received_events","type":"User","site_admin":false},"body":"Are you referring to the item about specifying \"essential\" dependencies? Could you clarify?\r\n\r\nI assume that we run into problems in some Docker environments if we don't make this dependency explicit? Is that right @strib?","created_at":"2018-02-27T21:03:23Z","updated_at":"2018-02-27T21:03:23Z","html_url":"https://github.com/keybase/client/pull/10703#discussion_r171065159","pull_request_url":"https://api.github.com/repos/keybase/client/pulls/10703","author_association":"CONTRIBUTOR","_links":{"self":{"href":"https://api.github.com/repos/keybase/client/pulls/comments/171065159"},"html":{"href":"https://github.com/keybase/client/pull/10703#discussion_r171065159"},"pull_request":{"href":"https://api.github.com/repos/keybase/client/pulls/10703"}},"in_reply_to_id":171055366},"pull_request":{"url":"https://api.github.com/repos/keybase/client/pulls/10703","id":171522845,"html_url":"https://github.com/keybase/client/pull/10703","diff_url":"https://github.com/keybase/client/pull/10703.diff","patch_url":"https://github.com/keybase/client/pull/10703.patch","issue_url":"https://api.github.com/repos/keybase/client/issues/10703","number":10703,"state":"open","locked":false,"title":"packaging: use root redirector on Linux instead of /keybase symlink","user":{"login":"strib","id":8516691,"avatar_url":"https://avatars0.githubusercontent.com/u/8516691?v=4","gravatar_id":"","url":"https://api.github.com/users/strib","html_url":"https://github.com/strib","followers_url":"https://api.github.com/users/strib/followers","following_url":"https://api.github.com/users/strib/following{/other_user}","gists_url":"https://api.github.com/users/strib/gists{/gist_id}","starred_url":"https://api.github.com/users/strib/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/strib/subscriptions","organizations_url":"https://api.github.com/users/strib/orgs","repos_url":"https://api.github.com/users/strib/repos","events_url":"https://api.github.com/users/strib/events{/privacy}","received_events_url":"https://api.github.com/users/strib/received_events","type":"User","site_admin":false},"body":"This installs the `keybase-redirector` binary for linux packages.  Right now it just builds the Go one for testing; I'll merge this in on a branch (not `master` yet) and update it for the Rust redirector once that's ready.\r\n\r\nThe post-install script:\r\n\r\n* Removes `keybasehelper` and various directories that are no longer needed.\r\n* If the `/keybase` symlink is present, it gets removed and, if KBFS is currently mounted somewhere, the redirector is run in its place.\r\n* If there's a regular mount at `/keybase` from some older package (owned by some non-root user), it unmounts KBFS and makes `/keybase` owned by root.  It doesn't start the redirector by default in this case, since some user needs to run `run_keybase` anyway.\r\n* If there's already a redirector running at `/keybase`, it gets killed and restarted by root, in case the binary has been updated in this package.\r\n* If this is a fresh install, it prepares the `/keybase` directory but doesn't run the redirector yet.\r\n* Redirector logs go in `/root/.cache/keybase/keybase.redirector.log` if the redirector is started this way.\r\n\r\nThe `run_keybase` script attempts to launch the root redirector under `nohup` as whatever user runs the script.  This assumes that the redirector will quit silently, with a 0 exit code, if its already running.  It uses `nohup` even for the systemd case, because a) it's a very simple service, b) if it crashes it's no big deal, KBFS will still be working at the per-use mountpoint, and c) it's easy to start it again with another call to `run_keybase`. Redirector logs go in `/home/$USER/.cache/keybase/keybase.redirector.log` if the redirector is started this way.  \r\n\r\nIssue: KBFS-2783","created_at":"2018-02-26T23:33:55Z","updated_at":"2018-02-27T21:03:23Z","closed_at":null,"merged_at":null,"merge_commit_sha":"4d249ffc66fa237f3bfe60cdcce927e3e27234f0","assignee":null,"assignees":[],"requested_reviewers":[{"login":"oconnor663","id":860932,"avatar_url":"https://avatars0.githubusercontent.com/u/860932?v=4","gravatar_id":"","url":"https://api.github.com/users/oconnor663","html_url":"https://github.com/oconnor663","followers_url":"https://api.github.com/users/oconnor663/followers","following_url":"https://api.github.com/users/oconnor663/following{/other_user}","gists_url":"https://api.github.com/users/oconnor663/gists{/gist_id}","starred_url":"https://api.github.com/users/oconnor663/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oconnor663/subscriptions","organizations_url":"https://api.github.com/users/oconnor663/orgs","repos_url":"https://api.github.com/users/oconnor663/repos","events_url":"https://api.github.com/users/oconnor663/events{/privacy}","received_events_url":"https://api.github.com/users/oconnor663/received_events","type":"User","site_admin":false}],"requested_teams":[],"labels":[],"milestone":null,"commits_url":"https://api.github.com/repos/keybase/client/pulls/10703/commits","review_comments_url":"https://api.github.com/repos/keybase/client/pulls/10703/comments","review_comment_url":"https://api.github.com/repos/keybase/client/pulls/comments{/number}","comments_url":"https://api.github.com/repos/keybase/client/issues/10703/comments","statuses_url":"https://api.github.com/repos/keybase/client/statuses/16c2a00c4b780ee2c47d725f0f6759452f729d63","head":{"label":"keybase:strib/KBFS-2783-linux-root-redirector","ref":"strib/KBFS-2783-linux-root-redirector","sha":"16c2a00c4b780ee2c47d725f0f6759452f729d63","user":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"repo":{"id":29099181,"name":"client","full_name":"keybase/client","owner":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"private":false,"html_url":"https://github.com/keybase/client","description":"Keybase Go Library, Client, Service, OS X, iOS, Android, Electron","fork":false,"url":"https://api.github.com/repos/keybase/client","forks_url":"https://api.github.com/repos/keybase/client/forks","keys_url":"https://api.github.com/repos/keybase/client/keys{/key_id}","collaborators_url":"https://api.github.com/repos/keybase/client/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/keybase/client/teams","hooks_url":"https://api.github.com/repos/keybase/client/hooks","issue_events_url":"https://api.github.com/repos/keybase/client/issues/events{/number}","events_url":"https://api.github.com/repos/keybase/client/events","assignees_url":"https://api.github.com/repos/keybase/client/assignees{/user}","branches_url":"https://api.github.com/repos/keybase/client/branches{/branch}","tags_url":"https://api.github.com/repos/keybase/client/tags","blobs_url":"https://api.github.com/repos/keybase/client/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/keybase/client/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/keybase/client/git/refs{/sha}","trees_url":"https://api.github.com/repos/keybase/client/git/trees{/sha}","statuses_url":"https://api.github.com/repos/keybase/client/statuses/{sha}","languages_url":"https://api.github.com/repos/keybase/client/languages","stargazers_url":"https://api.github.com/repos/keybase/client/stargazers","contributors_url":"https://api.github.com/repos/keybase/client/contributors","subscribers_url":"https://api.github.com/repos/keybase/client/subscribers","subscription_url":"https://api.github.com/repos/keybase/client/subscription","commits_url":"https://api.github.com/repos/keybase/client/commits{/sha}","git_commits_url":"https://api.github.com/repos/keybase/client/git/commits{/sha}","comments_url":"https://api.github.com/repos/keybase/client/comments{/number}","issue_comment_url":"https://api.github.com/repos/keybase/client/issues/comments{/number}","contents_url":"https://api.github.com/repos/keybase/client/contents/{+path}","compare_url":"https://api.github.com/repos/keybase/client/compare/{base}...{head}","merges_url":"https://api.github.com/repos/keybase/client/merges","archive_url":"https://api.github.com/repos/keybase/client/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/keybase/client/downloads","issues_url":"https://api.github.com/repos/keybase/client/issues{/number}","pulls_url":"https://api.github.com/repos/keybase/client/pulls{/number}","milestones_url":"https://api.github.com/repos/keybase/client/milestones{/number}","notifications_url":"https://api.github.com/repos/keybase/client/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/keybase/client/labels{/name}","releases_url":"https://api.github.com/repos/keybase/client/releases{/id}","deployments_url":"https://api.github.com/repos/keybase/client/deployments","created_at":"2015-01-11T17:17:12Z","updated_at":"2018-02-27T17:46:36Z","pushed_at":"2018-02-27T20:58:54Z","git_url":"git://github.com/keybase/client.git","ssh_url":"git@github.com:keybase/client.git","clone_url":"https://github.com/keybase/client.git","svn_url":"https://github.com/keybase/client","homepage":"","size":222834,"stargazers_count":3289,"watchers_count":3289,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"forks_count":315,"mirror_url":null,"archived":false,"open_issues_count":1891,"license":{"key":"bsd-3-clause","name":"BSD 3-Clause \"New\" or \"Revised\" License","spdx_id":"BSD-3-Clause","url":"https://api.github.com/licenses/bsd-3-clause"},"forks":315,"open_issues":1891,"watchers":3289,"default_branch":"master"}},"base":{"label":"keybase:strib/KBFS-2782-root-redirector","ref":"strib/KBFS-2782-root-redirector","sha":"e003a13399620f9fa7adce65c9e0e91988f884e6","user":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"repo":{"id":29099181,"name":"client","full_name":"keybase/client","owner":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"private":false,"html_url":"https://github.com/keybase/client","description":"Keybase Go Library, Client, Service, OS X, iOS, Android, Electron","fork":false,"url":"https://api.github.com/repos/keybase/client","forks_url":"https://api.github.com/repos/keybase/client/forks","keys_url":"https://api.github.com/repos/keybase/client/keys{/key_id}","collaborators_url":"https://api.github.com/repos/keybase/client/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/keybase/client/teams","hooks_url":"https://api.github.com/repos/keybase/client/hooks","issue_events_url":"https://api.github.com/repos/keybase/client/issues/events{/number}","events_url":"https://api.github.com/repos/keybase/client/events","assignees_url":"https://api.github.com/repos/keybase/client/assignees{/user}","branches_url":"https://api.github.com/repos/keybase/client/branches{/branch}","tags_url":"https://api.github.com/repos/keybase/client/tags","blobs_url":"https://api.github.com/repos/keybase/client/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/keybase/client/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/keybase/client/git/refs{/sha}","trees_url":"https://api.github.com/repos/keybase/client/git/trees{/sha}","statuses_url":"https://api.github.com/repos/keybase/client/statuses/{sha}","languages_url":"https://api.github.com/repos/keybase/client/languages","stargazers_url":"https://api.github.com/repos/keybase/client/stargazers","contributors_url":"https://api.github.com/repos/keybase/client/contributors","subscribers_url":"https://api.github.com/repos/keybase/client/subscribers","subscription_url":"https://api.github.com/repos/keybase/client/subscription","commits_url":"https://api.github.com/repos/keybase/client/commits{/sha}","git_commits_url":"https://api.github.com/repos/keybase/client/git/commits{/sha}","comments_url":"https://api.github.com/repos/keybase/client/comments{/number}","issue_comment_url":"https://api.github.com/repos/keybase/client/issues/comments{/number}","contents_url":"https://api.github.com/repos/keybase/client/contents/{+path}","compare_url":"https://api.github.com/repos/keybase/client/compare/{base}...{head}","merges_url":"https://api.github.com/repos/keybase/client/merges","archive_url":"https://api.github.com/repos/keybase/client/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/keybase/client/downloads","issues_url":"https://api.github.com/repos/keybase/client/issues{/number}","pulls_url":"https://api.github.com/repos/keybase/client/pulls{/number}","milestones_url":"https://api.github.com/repos/keybase/client/milestones{/number}","notifications_url":"https://api.github.com/repos/keybase/client/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/keybase/client/labels{/name}","releases_url":"https://api.github.com/repos/keybase/client/releases{/id}","deployments_url":"https://api.github.com/repos/keybase/client/deployments","created_at":"2015-01-11T17:17:12Z","updated_at":"2018-02-27T17:46:36Z","pushed_at":"2018-02-27T20:58:54Z","git_url":"git://github.com/keybase/client.git","ssh_url":"git@github.com:keybase/client.git","clone_url":"https://github.com/keybase/client.git","svn_url":"https://github.com/keybase/client","homepage":"","size":222834,"stargazers_count":3289,"watchers_count":3289,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"forks_count":315,"mirror_url":null,"archived":false,"open_issues_count":1891,"license":{"key":"bsd-3-clause","name":"BSD 3-Clause \"New\" or \"Revised\" License","spdx_id":"BSD-3-Clause","url":"https://api.github.com/licenses/bsd-3-clause"},"forks":315,"open_issues":1891,"watchers":3289,"default_branch":"master"}},"_links":{"self":{"href":"https://api.github.com/repos/keybase/client/pulls/10703"},"html":{"href":"https://github.com/keybase/client/pull/10703"},"issue":{"href":"https://api.github.com/repos/keybase/client/issues/10703"},"comments":{"href":"https://api.github.com/repos/keybase/client/issues/10703/comments"},"review_comments":{"href":"https://api.github.com/repos/keybase/client/pulls/10703/comments"},"review_comment":{"href":"https://api.github.com/repos/keybase/client/pulls/comments{/number}"},"commits":{"href":"https://api.github.com/repos/keybase/client/pulls/10703/commits"},"statuses":{"href":"https://api.github.com/repos/keybase/client/statuses/16c2a00c4b780ee2c47d725f0f6759452f729d63"}},"author_association":"CONTRIBUTOR"}},"public":true,"created_at":"2018-02-27T21:03:23Z","org":{"id":5400834,"login":"keybase","gravatar_id":"","url":"https://api.github.com/orgs/keybase","avatar_url":"https://avatars.githubusercontent.com/u/5400834?"}},{"id":"7306094584","type":"PushEvent","actor":{"id":860932,"login":"oconnor663","display_login":"oconnor663","gravatar_id":"","url":"https://api.github.com/users/oconnor663","avatar_url":"https://avatars.githubusercontent.com/u/860932?"},"repo":{"id":75300905,"name":"oconnor663/bao","url":"https://api.github.com/repos/oconnor663/bao"},"payload":{"push_id":2363368373,"size":1,"distinct_size":1,"ref":"refs/heads/hash","head":"45413d867fcb8349c6d84dc278d97a04feda4c56","before":"a76e6cbcd9bb90d948c7f1398c5f5d43c7b30fc8","commits":[{"sha":"45413d867fcb8349c6d84dc278d97a04feda4c56","author":{"email":"oconnor663@gmail.com","name":"Jack O'Connor"},"message":"add a debug_assert","distinct":true,"url":"https://api.github.com/repos/oconnor663/bao/commits/45413d867fcb8349c6d84dc278d97a04feda4c56"}]},"public":true,"created_at":"2018-02-27T20:56:41Z"},{"id":"7305993592","type":"PushEvent","actor":{"id":860932,"login":"oconnor663","display_login":"oconnor663","gravatar_id":"","url":"https://api.github.com/users/oconnor663","avatar_url":"https://avatars.githubusercontent.com/u/860932?"},"repo":{"id":75300905,"name":"oconnor663/bao","url":"https://api.github.com/repos/oconnor663/bao"},"payload":{"push_id":2363316991,"size":1,"distinct_size":1,"ref":"refs/heads/hash","head":"a76e6cbcd9bb90d948c7f1398c5f5d43c7b30fc8","before":"334f06a01b51e229ec0a6a96bd0645e4d4cc18f6","commits":[{"sha":"a76e6cbcd9bb90d948c7f1398c5f5d43c7b30fc8","author":{"email":"oconnor663@gmail.com","name":"Jack O'Connor"},"message":"get rid of the slower parallel implementation","distinct":true,"url":"https://api.github.com/repos/oconnor663/bao/commits/a76e6cbcd9bb90d948c7f1398c5f5d43c7b30fc8"}]},"public":true,"created_at":"2018-02-27T20:36:24Z"},{"id":"7305984199","type":"PushEvent","actor":{"id":860932,"login":"oconnor663","display_login":"oconnor663","gravatar_id":"","url":"https://api.github.com/users/oconnor663","avatar_url":"https://avatars.githubusercontent.com/u/860932?"},"repo":{"id":75300905,"name":"oconnor663/bao","url":"https://api.github.com/repos/oconnor663/bao"},"payload":{"push_id":2363312068,"size":1,"distinct_size":1,"ref":"refs/heads/hash","head":"334f06a01b51e229ec0a6a96bd0645e4d4cc18f6","before":"1c4430b84966e87e63dd9779802fbdb3b7134676","commits":[{"sha":"334f06a01b51e229ec0a6a96bd0645e4d4cc18f6","author":{"email":"oconnor663@gmail.com","name":"Jack O'Connor"},"message":"cleanup","distinct":true,"url":"https://api.github.com/repos/oconnor663/bao/commits/334f06a01b51e229ec0a6a96bd0645e4d4cc18f6"}]},"public":true,"created_at":"2018-02-27T20:34:28Z"},{"id":"7304274098","type":"PullRequestReviewCommentEvent","actor":{"id":860932,"login":"oconnor663","display_login":"oconnor663","gravatar_id":"","url":"https://api.github.com/users/oconnor663","avatar_url":"https://avatars.githubusercontent.com/u/860932?"},"repo":{"id":29099181,"name":"keybase/client","url":"https://api.github.com/repos/keybase/client"},"payload":{"action":"created","comment":{"url":"https://api.github.com/repos/keybase/client/pulls/comments/170961057","pull_request_review_id":99729226,"id":170961057,"diff_hunk":"@@ -465,6 +467,45 @@ func SignJSON(jw *jsonw.Wrapper, key GenericKey) (out string, id keybase1.SigID,\n \treturn\n }\n \n+func GetDefaultSigVersion(g *GlobalContext) SigVersion {\n+\tif g.Env.IsAdmin() {","path":"go/libkb/kbsig.go","position":27,"original_position":27,"commit_id":"e3dee595be39456143b8291c16d5e59d90391af7","original_commit_id":"e3dee595be39456143b8291c16d5e59d90391af7","user":{"login":"oconnor663","id":860932,"avatar_url":"https://avatars0.githubusercontent.com/u/860932?v=4","gravatar_id":"","url":"https://api.github.com/users/oconnor663","html_url":"https://github.com/oconnor663","followers_url":"https://api.github.com/users/oconnor663/followers","following_url":"https://api.github.com/users/oconnor663/following{/other_user}","gists_url":"https://api.github.com/users/oconnor663/gists{/gist_id}","starred_url":"https://api.github.com/users/oconnor663/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oconnor663/subscriptions","organizations_url":"https://api.github.com/users/oconnor663/orgs","repos_url":"https://api.github.com/users/oconnor663/repos","events_url":"https://api.github.com/users/oconnor663/events{/privacy}","received_events_url":"https://api.github.com/users/oconnor663/received_events","type":"User","site_admin":false},"body":"So this will be flagged on for most of us in the office? If we're worried about it breaking something, is that restricted enough?","created_at":"2018-02-27T15:30:38Z","updated_at":"2018-02-27T15:30:45Z","html_url":"https://github.com/keybase/client/pull/10644#discussion_r170961057","pull_request_url":"https://api.github.com/repos/keybase/client/pulls/10644","author_association":"CONTRIBUTOR","_links":{"self":{"href":"https://api.github.com/repos/keybase/client/pulls/comments/170961057"},"html":{"href":"https://github.com/keybase/client/pull/10644#discussion_r170961057"},"pull_request":{"href":"https://api.github.com/repos/keybase/client/pulls/10644"}}},"pull_request":{"url":"https://api.github.com/repos/keybase/client/pulls/10644","id":170615708,"html_url":"https://github.com/keybase/client/pull/10644","diff_url":"https://github.com/keybase/client/pull/10644.diff","patch_url":"https://github.com/keybase/client/pull/10644.patch","issue_url":"https://api.github.com/repos/keybase/client/issues/10644","number":10644,"state":"open","locked":false,"title":"Sigchain v2 for service & cryptocurrency proofs","user":{"login":"joshblum","id":1144020,"avatar_url":"https://avatars0.githubusercontent.com/u/1144020?v=4","gravatar_id":"","url":"https://api.github.com/users/joshblum","html_url":"https://github.com/joshblum","followers_url":"https://api.github.com/users/joshblum/followers","following_url":"https://api.github.com/users/joshblum/following{/other_user}","gists_url":"https://api.github.com/users/joshblum/gists{/gist_id}","starred_url":"https://api.github.com/users/joshblum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joshblum/subscriptions","organizations_url":"https://api.github.com/users/joshblum/orgs","repos_url":"https://api.github.com/users/joshblum/repos","events_url":"https://api.github.com/users/joshblum/events{/privacy}","received_events_url":"https://api.github.com/users/joshblum/received_events","type":"User","site_admin":false},"body":"Sigchain v2 for crypto and service proofs!\r\n\r\ncc @keybase/react-hackers, added `sigVersion` to conform to new RPC in `shared/actions/profile/proofs.js`","created_at":"2018-02-21T23:15:53Z","updated_at":"2018-02-27T15:30:45Z","closed_at":null,"merged_at":null,"merge_commit_sha":"456c8f2231e963f003cdfc6c25e8ef2b44dec728","assignee":null,"assignees":[],"requested_reviewers":[],"requested_teams":[],"labels":[],"milestone":null,"commits_url":"https://api.github.com/repos/keybase/client/pulls/10644/commits","review_comments_url":"https://api.github.com/repos/keybase/client/pulls/10644/comments","review_comment_url":"https://api.github.com/repos/keybase/client/pulls/comments{/number}","comments_url":"https://api.github.com/repos/keybase/client/issues/10644/comments","statuses_url":"https://api.github.com/repos/keybase/client/statuses/e3dee595be39456143b8291c16d5e59d90391af7","head":{"label":"keybase:joshblum/CORE-7230","ref":"joshblum/CORE-7230","sha":"e3dee595be39456143b8291c16d5e59d90391af7","user":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"repo":{"id":29099181,"name":"client","full_name":"keybase/client","owner":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"private":false,"html_url":"https://github.com/keybase/client","description":"Keybase Go Library, Client, Service, OS X, iOS, Android, Electron","fork":false,"url":"https://api.github.com/repos/keybase/client","forks_url":"https://api.github.com/repos/keybase/client/forks","keys_url":"https://api.github.com/repos/keybase/client/keys{/key_id}","collaborators_url":"https://api.github.com/repos/keybase/client/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/keybase/client/teams","hooks_url":"https://api.github.com/repos/keybase/client/hooks","issue_events_url":"https://api.github.com/repos/keybase/client/issues/events{/number}","events_url":"https://api.github.com/repos/keybase/client/events","assignees_url":"https://api.github.com/repos/keybase/client/assignees{/user}","branches_url":"https://api.github.com/repos/keybase/client/branches{/branch}","tags_url":"https://api.github.com/repos/keybase/client/tags","blobs_url":"https://api.github.com/repos/keybase/client/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/keybase/client/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/keybase/client/git/refs{/sha}","trees_url":"https://api.github.com/repos/keybase/client/git/trees{/sha}","statuses_url":"https://api.github.com/repos/keybase/client/statuses/{sha}","languages_url":"https://api.github.com/repos/keybase/client/languages","stargazers_url":"https://api.github.com/repos/keybase/client/stargazers","contributors_url":"https://api.github.com/repos/keybase/client/contributors","subscribers_url":"https://api.github.com/repos/keybase/client/subscribers","subscription_url":"https://api.github.com/repos/keybase/client/subscription","commits_url":"https://api.github.com/repos/keybase/client/commits{/sha}","git_commits_url":"https://api.github.com/repos/keybase/client/git/commits{/sha}","comments_url":"https://api.github.com/repos/keybase/client/comments{/number}","issue_comment_url":"https://api.github.com/repos/keybase/client/issues/comments{/number}","contents_url":"https://api.github.com/repos/keybase/client/contents/{+path}","compare_url":"https://api.github.com/repos/keybase/client/compare/{base}...{head}","merges_url":"https://api.github.com/repos/keybase/client/merges","archive_url":"https://api.github.com/repos/keybase/client/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/keybase/client/downloads","issues_url":"https://api.github.com/repos/keybase/client/issues{/number}","pulls_url":"https://api.github.com/repos/keybase/client/pulls{/number}","milestones_url":"https://api.github.com/repos/keybase/client/milestones{/number}","notifications_url":"https://api.github.com/repos/keybase/client/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/keybase/client/labels{/name}","releases_url":"https://api.github.com/repos/keybase/client/releases{/id}","deployments_url":"https://api.github.com/repos/keybase/client/deployments","created_at":"2015-01-11T17:17:12Z","updated_at":"2018-02-27T13:17:56Z","pushed_at":"2018-02-27T15:23:34Z","git_url":"git://github.com/keybase/client.git","ssh_url":"git@github.com:keybase/client.git","clone_url":"https://github.com/keybase/client.git","svn_url":"https://github.com/keybase/client","homepage":"","size":222763,"stargazers_count":3287,"watchers_count":3287,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"forks_count":315,"mirror_url":null,"archived":false,"open_issues_count":1891,"license":{"key":"bsd-3-clause","name":"BSD 3-Clause \"New\" or \"Revised\" License","spdx_id":"BSD-3-Clause","url":"https://api.github.com/licenses/bsd-3-clause"},"forks":315,"open_issues":1891,"watchers":3287,"default_branch":"master"}},"base":{"label":"keybase:master","ref":"master","sha":"a264d702d78c23fa87670fde226f43f7a94b9729","user":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"repo":{"id":29099181,"name":"client","full_name":"keybase/client","owner":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"private":false,"html_url":"https://github.com/keybase/client","description":"Keybase Go Library, Client, Service, OS X, iOS, Android, Electron","fork":false,"url":"https://api.github.com/repos/keybase/client","forks_url":"https://api.github.com/repos/keybase/client/forks","keys_url":"https://api.github.com/repos/keybase/client/keys{/key_id}","collaborators_url":"https://api.github.com/repos/keybase/client/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/keybase/client/teams","hooks_url":"https://api.github.com/repos/keybase/client/hooks","issue_events_url":"https://api.github.com/repos/keybase/client/issues/events{/number}","events_url":"https://api.github.com/repos/keybase/client/events","assignees_url":"https://api.github.com/repos/keybase/client/assignees{/user}","branches_url":"https://api.github.com/repos/keybase/client/branches{/branch}","tags_url":"https://api.github.com/repos/keybase/client/tags","blobs_url":"https://api.github.com/repos/keybase/client/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/keybase/client/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/keybase/client/git/refs{/sha}","trees_url":"https://api.github.com/repos/keybase/client/git/trees{/sha}","statuses_url":"https://api.github.com/repos/keybase/client/statuses/{sha}","languages_url":"https://api.github.com/repos/keybase/client/languages","stargazers_url":"https://api.github.com/repos/keybase/client/stargazers","contributors_url":"https://api.github.com/repos/keybase/client/contributors","subscribers_url":"https://api.github.com/repos/keybase/client/subscribers","subscription_url":"https://api.github.com/repos/keybase/client/subscription","commits_url":"https://api.github.com/repos/keybase/client/commits{/sha}","git_commits_url":"https://api.github.com/repos/keybase/client/git/commits{/sha}","comments_url":"https://api.github.com/repos/keybase/client/comments{/number}","issue_comment_url":"https://api.github.com/repos/keybase/client/issues/comments{/number}","contents_url":"https://api.github.com/repos/keybase/client/contents/{+path}","compare_url":"https://api.github.com/repos/keybase/client/compare/{base}...{head}","merges_url":"https://api.github.com/repos/keybase/client/merges","archive_url":"https://api.github.com/repos/keybase/client/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/keybase/client/downloads","issues_url":"https://api.github.com/repos/keybase/client/issues{/number}","pulls_url":"https://api.github.com/repos/keybase/client/pulls{/number}","milestones_url":"https://api.github.com/repos/keybase/client/milestones{/number}","notifications_url":"https://api.github.com/repos/keybase/client/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/keybase/client/labels{/name}","releases_url":"https://api.github.com/repos/keybase/client/releases{/id}","deployments_url":"https://api.github.com/repos/keybase/client/deployments","created_at":"2015-01-11T17:17:12Z","updated_at":"2018-02-27T13:17:56Z","pushed_at":"2018-02-27T15:23:34Z","git_url":"git://github.com/keybase/client.git","ssh_url":"git@github.com:keybase/client.git","clone_url":"https://github.com/keybase/client.git","svn_url":"https://github.com/keybase/client","homepage":"","size":222763,"stargazers_count":3287,"watchers_count":3287,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"forks_count":315,"mirror_url":null,"archived":false,"open_issues_count":1891,"license":{"key":"bsd-3-clause","name":"BSD 3-Clause \"New\" or \"Revised\" License","spdx_id":"BSD-3-Clause","url":"https://api.github.com/licenses/bsd-3-clause"},"forks":315,"open_issues":1891,"watchers":3287,"default_branch":"master"}},"_links":{"self":{"href":"https://api.github.com/repos/keybase/client/pulls/10644"},"html":{"href":"https://github.com/keybase/client/pull/10644"},"issue":{"href":"https://api.github.com/repos/keybase/client/issues/10644"},"comments":{"href":"https://api.github.com/repos/keybase/client/issues/10644/comments"},"review_comments":{"href":"https://api.github.com/repos/keybase/client/pulls/10644/comments"},"review_comment":{"href":"https://api.github.com/repos/keybase/client/pulls/comments{/number}"},"commits":{"href":"https://api.github.com/repos/keybase/client/pulls/10644/commits"},"statuses":{"href":"https://api.github.com/repos/keybase/client/statuses/e3dee595be39456143b8291c16d5e59d90391af7"}},"author_association":"CONTRIBUTOR"}},"public":true,"created_at":"2018-02-27T15:30:38Z","org":{"id":5400834,"login":"keybase","gravatar_id":"","url":"https://api.github.com/orgs/keybase","avatar_url":"https://avatars.githubusercontent.com/u/5400834?"}},{"id":"7304217471","type":"IssueCommentEvent","actor":{"id":860932,"login":"oconnor663","display_login":"oconnor663","gravatar_id":"","url":"https://api.github.com/users/oconnor663","avatar_url":"https://avatars.githubusercontent.com/u/860932?"},"repo":{"id":13880738,"name":"buildinspace/peru","url":"https://api.github.com/repos/buildinspace/peru"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/buildinspace/peru/issues/187","repository_url":"https://api.github.com/repos/buildinspace/peru","labels_url":"https://api.github.com/repos/buildinspace/peru/issues/187/labels{/name}","comments_url":"https://api.github.com/repos/buildinspace/peru/issues/187/comments","events_url":"https://api.github.com/repos/buildinspace/peru/issues/187/events","html_url":"https://github.com/buildinspace/peru/issues/187","id":299950131,"number":187,"title":"How to use `override`?","user":{"login":"loveencounterflow","id":1170565,"avatar_url":"https://avatars2.githubusercontent.com/u/1170565?v=4","gravatar_id":"","url":"https://api.github.com/users/loveencounterflow","html_url":"https://github.com/loveencounterflow","followers_url":"https://api.github.com/users/loveencounterflow/followers","following_url":"https://api.github.com/users/loveencounterflow/following{/other_user}","gists_url":"https://api.github.com/users/loveencounterflow/gists{/gist_id}","starred_url":"https://api.github.com/users/loveencounterflow/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/loveencounterflow/subscriptions","organizations_url":"https://api.github.com/users/loveencounterflow/orgs","repos_url":"https://api.github.com/users/loveencounterflow/repos","events_url":"https://api.github.com/users/loveencounterflow/events{/privacy}","received_events_url":"https://api.github.com/users/loveencounterflow/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2018-02-24T15:48:04Z","updated_at":"2018-02-27T15:22:05Z","closed_at":null,"author_association":"NONE","body":"In the discussion of #186 I learned that `peru override` is the way to go when you want to develop an included ('guest') project from an including ('host') project; seen from the file layout, this would look like\r\n\r\n```\r\nguest-repo/\r\n  .git/\r\n  somefile\r\n  ...\r\nhost/\r\n  peru.yaml\r\n  guest-copy/\r\n    somefile\r\n    ...\r\n  ...\r\n```\r\n\r\nThe readme only states that `override` \"Replace[s] the contents of a module with a local directory path, usually a clone you've made of the same repo. This lets you test changes to imported modules without needing to push your changes upstream or edit `peru.yaml`.\" which leaves me puzzled how to organize my workflow. \r\n\r\nI'd greatly appreciate any help here because what I'm doing now is editing files in my local copy (`host/guest-copy/somefile`), seeing that the changed guest code works in the intended habitat, and then use `meld` to shuffle changes back to the guest repo (`guest-repo/somefile`). Clearly, that's less than ideal."},"comment":{"url":"https://api.github.com/repos/buildinspace/peru/issues/comments/368914033","html_url":"https://github.com/buildinspace/peru/issues/187#issuecomment-368914033","issue_url":"https://api.github.com/repos/buildinspace/peru/issues/187","id":368914033,"user":{"login":"oconnor663","id":860932,"avatar_url":"https://avatars0.githubusercontent.com/u/860932?v=4","gravatar_id":"","url":"https://api.github.com/users/oconnor663","html_url":"https://github.com/oconnor663","followers_url":"https://api.github.com/users/oconnor663/followers","following_url":"https://api.github.com/users/oconnor663/following{/other_user}","gists_url":"https://api.github.com/users/oconnor663/gists{/gist_id}","starred_url":"https://api.github.com/users/oconnor663/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oconnor663/subscriptions","organizations_url":"https://api.github.com/users/oconnor663/orgs","repos_url":"https://api.github.com/users/oconnor663/repos","events_url":"https://api.github.com/users/oconnor663/events{/privacy}","received_events_url":"https://api.github.com/users/oconnor663/received_events","type":"User","site_admin":false},"created_at":"2018-02-27T15:22:05Z","updated_at":"2018-02-27T15:22:05Z","author_association":"OWNER","body":"OT: I'm convinced that the future is going to be something like [Bazel](https://bazel.build/) or [Buck](https://buckbuild.com/), but yeah, making a general purpose build tool is really hard. There are a lot of ways in which it's easier than it used to be (standardized formats like JSON/YAML/TOML are huge), but also the tools are expected to do more (run tests, compile docs, package for Android/iOS). It's hard to hit a sweet spot where your tool is being really helpful, without forcing projects to be organized some very specific way that not everyone likes."}},"public":true,"created_at":"2018-02-27T15:22:06Z","org":{"id":8107815,"login":"buildinspace","gravatar_id":"","url":"https://api.github.com/orgs/buildinspace","avatar_url":"https://avatars.githubusercontent.com/u/8107815?"}},{"id":"7299804892","type":"CreateEvent","actor":{"id":860932,"login":"oconnor663","display_login":"oconnor663","gravatar_id":"","url":"https://api.github.com/users/oconnor663","avatar_url":"https://avatars.githubusercontent.com/u/860932?"},"repo":{"id":59787605,"name":"keybase/kbfs","url":"https://api.github.com/repos/keybase/kbfs"},"payload":{"ref":"jack/rust_redirector2","ref_type":"branch","master_branch":"master","description":"Keybase Filesystem (KBFS)","pusher_type":"user"},"public":true,"created_at":"2018-02-26T21:20:55Z","org":{"id":5400834,"login":"keybase","gravatar_id":"","url":"https://api.github.com/orgs/keybase","avatar_url":"https://avatars.githubusercontent.com/u/5400834?"}},{"id":"7299371129","type":"IssueCommentEvent","actor":{"id":860932,"login":"oconnor663","display_login":"oconnor663","gravatar_id":"","url":"https://api.github.com/users/oconnor663","avatar_url":"https://avatars.githubusercontent.com/u/860932?"},"repo":{"id":59787605,"name":"keybase/kbfs","url":"https://api.github.com/repos/keybase/kbfs"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/keybase/kbfs/issues/1491","repository_url":"https://api.github.com/repos/keybase/kbfs","labels_url":"https://api.github.com/repos/keybase/kbfs/issues/1491/labels{/name}","comments_url":"https://api.github.com/repos/keybase/kbfs/issues/1491/comments","events_url":"https://api.github.com/repos/keybase/kbfs/issues/1491/events","html_url":"https://github.com/keybase/kbfs/pull/1491","id":300373454,"number":1491,"title":"initial Linux-only implementation of the Rust redirector","user":{"login":"oconnor663","id":860932,"avatar_url":"https://avatars0.githubusercontent.com/u/860932?v=4","gravatar_id":"","url":"https://api.github.com/users/oconnor663","html_url":"https://github.com/oconnor663","followers_url":"https://api.github.com/users/oconnor663/followers","following_url":"https://api.github.com/users/oconnor663/following{/other_user}","gists_url":"https://api.github.com/users/oconnor663/gists{/gist_id}","starred_url":"https://api.github.com/users/oconnor663/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oconnor663/subscriptions","organizations_url":"https://api.github.com/users/oconnor663/orgs","repos_url":"https://api.github.com/users/oconnor663/repos","events_url":"https://api.github.com/users/oconnor663/events{/privacy}","received_events_url":"https://api.github.com/users/oconnor663/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2018-02-26T19:53:14Z","updated_at":"2018-02-26T19:54:16Z","closed_at":null,"author_association":"CONTRIBUTOR","pull_request":{"url":"https://api.github.com/repos/keybase/kbfs/pulls/1491","html_url":"https://github.com/keybase/kbfs/pull/1491","diff_url":"https://github.com/keybase/kbfs/pull/1491.diff","patch_url":"https://github.com/keybase/kbfs/pull/1491.patch"},"body":"r? @strib @akalin-keybase \r\n\r\ncc @jzila "},"comment":{"url":"https://api.github.com/repos/keybase/kbfs/issues/comments/368628654","html_url":"https://github.com/keybase/kbfs/pull/1491#issuecomment-368628654","issue_url":"https://api.github.com/repos/keybase/kbfs/issues/1491","id":368628654,"user":{"login":"oconnor663","id":860932,"avatar_url":"https://avatars0.githubusercontent.com/u/860932?v=4","gravatar_id":"","url":"https://api.github.com/users/oconnor663","html_url":"https://github.com/oconnor663","followers_url":"https://api.github.com/users/oconnor663/followers","following_url":"https://api.github.com/users/oconnor663/following{/other_user}","gists_url":"https://api.github.com/users/oconnor663/gists{/gist_id}","starred_url":"https://api.github.com/users/oconnor663/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oconnor663/subscriptions","organizations_url":"https://api.github.com/users/oconnor663/orgs","repos_url":"https://api.github.com/users/oconnor663/repos","events_url":"https://api.github.com/users/oconnor663/events{/privacy}","received_events_url":"https://api.github.com/users/oconnor663/received_events","type":"User","site_admin":false},"created_at":"2018-02-26T19:54:16Z","updated_at":"2018-02-26T19:54:16Z","author_association":"CONTRIBUTOR","body":"There are some TODO's in the code with specific questions. Please look at those and let me know what you think."}},"public":true,"created_at":"2018-02-26T19:54:16Z","org":{"id":5400834,"login":"keybase","gravatar_id":"","url":"https://api.github.com/orgs/keybase","avatar_url":"https://avatars.githubusercontent.com/u/5400834?"}},{"id":"7299365888","type":"PullRequestEvent","actor":{"id":860932,"login":"oconnor663","display_login":"oconnor663","gravatar_id":"","url":"https://api.github.com/users/oconnor663","avatar_url":"https://avatars.githubusercontent.com/u/860932?"},"repo":{"id":59787605,"name":"keybase/kbfs","url":"https://api.github.com/repos/keybase/kbfs"},"payload":{"action":"opened","number":1491,"pull_request":{"url":"https://api.github.com/repos/keybase/kbfs/pulls/1491","id":171474775,"html_url":"https://github.com/keybase/kbfs/pull/1491","diff_url":"https://github.com/keybase/kbfs/pull/1491.diff","patch_url":"https://github.com/keybase/kbfs/pull/1491.patch","issue_url":"https://api.github.com/repos/keybase/kbfs/issues/1491","number":1491,"state":"open","locked":false,"title":"initial Linux-only implementation of the Rust redirector","user":{"login":"oconnor663","id":860932,"avatar_url":"https://avatars0.githubusercontent.com/u/860932?v=4","gravatar_id":"","url":"https://api.github.com/users/oconnor663","html_url":"https://github.com/oconnor663","followers_url":"https://api.github.com/users/oconnor663/followers","following_url":"https://api.github.com/users/oconnor663/following{/other_user}","gists_url":"https://api.github.com/users/oconnor663/gists{/gist_id}","starred_url":"https://api.github.com/users/oconnor663/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oconnor663/subscriptions","organizations_url":"https://api.github.com/users/oconnor663/orgs","repos_url":"https://api.github.com/users/oconnor663/repos","events_url":"https://api.github.com/users/oconnor663/events{/privacy}","received_events_url":"https://api.github.com/users/oconnor663/received_events","type":"User","site_admin":false},"body":"r? @strib @akalin-keybase \r\n\r\ncc @jzila ","created_at":"2018-02-26T19:53:14Z","updated_at":"2018-02-26T19:53:14Z","closed_at":null,"merged_at":null,"merge_commit_sha":null,"assignee":null,"assignees":[],"requested_reviewers":[],"requested_teams":[],"labels":[],"milestone":null,"commits_url":"https://api.github.com/repos/keybase/kbfs/pulls/1491/commits","review_comments_url":"https://api.github.com/repos/keybase/kbfs/pulls/1491/comments","review_comment_url":"https://api.github.com/repos/keybase/kbfs/pulls/comments{/number}","comments_url":"https://api.github.com/repos/keybase/kbfs/issues/1491/comments","statuses_url":"https://api.github.com/repos/keybase/kbfs/statuses/e02a80616271b86332aa07b366e648c7a92d9f42","head":{"label":"keybase:jack/rust_redirector","ref":"jack/rust_redirector","sha":"e02a80616271b86332aa07b366e648c7a92d9f42","user":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"repo":{"id":59787605,"name":"kbfs","full_name":"keybase/kbfs","owner":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"private":false,"html_url":"https://github.com/keybase/kbfs","description":"Keybase Filesystem (KBFS)","fork":false,"url":"https://api.github.com/repos/keybase/kbfs","forks_url":"https://api.github.com/repos/keybase/kbfs/forks","keys_url":"https://api.github.com/repos/keybase/kbfs/keys{/key_id}","collaborators_url":"https://api.github.com/repos/keybase/kbfs/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/keybase/kbfs/teams","hooks_url":"https://api.github.com/repos/keybase/kbfs/hooks","issue_events_url":"https://api.github.com/repos/keybase/kbfs/issues/events{/number}","events_url":"https://api.github.com/repos/keybase/kbfs/events","assignees_url":"https://api.github.com/repos/keybase/kbfs/assignees{/user}","branches_url":"https://api.github.com/repos/keybase/kbfs/branches{/branch}","tags_url":"https://api.github.com/repos/keybase/kbfs/tags","blobs_url":"https://api.github.com/repos/keybase/kbfs/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/keybase/kbfs/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/keybase/kbfs/git/refs{/sha}","trees_url":"https://api.github.com/repos/keybase/kbfs/git/trees{/sha}","statuses_url":"https://api.github.com/repos/keybase/kbfs/statuses/{sha}","languages_url":"https://api.github.com/repos/keybase/kbfs/languages","stargazers_url":"https://api.github.com/repos/keybase/kbfs/stargazers","contributors_url":"https://api.github.com/repos/keybase/kbfs/contributors","subscribers_url":"https://api.github.com/repos/keybase/kbfs/subscribers","subscription_url":"https://api.github.com/repos/keybase/kbfs/subscription","commits_url":"https://api.github.com/repos/keybase/kbfs/commits{/sha}","git_commits_url":"https://api.github.com/repos/keybase/kbfs/git/commits{/sha}","comments_url":"https://api.github.com/repos/keybase/kbfs/comments{/number}","issue_comment_url":"https://api.github.com/repos/keybase/kbfs/issues/comments{/number}","contents_url":"https://api.github.com/repos/keybase/kbfs/contents/{+path}","compare_url":"https://api.github.com/repos/keybase/kbfs/compare/{base}...{head}","merges_url":"https://api.github.com/repos/keybase/kbfs/merges","archive_url":"https://api.github.com/repos/keybase/kbfs/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/keybase/kbfs/downloads","issues_url":"https://api.github.com/repos/keybase/kbfs/issues{/number}","pulls_url":"https://api.github.com/repos/keybase/kbfs/pulls{/number}","milestones_url":"https://api.github.com/repos/keybase/kbfs/milestones{/number}","notifications_url":"https://api.github.com/repos/keybase/kbfs/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/keybase/kbfs/labels{/name}","releases_url":"https://api.github.com/repos/keybase/kbfs/releases{/id}","deployments_url":"https://api.github.com/repos/keybase/kbfs/deployments","created_at":"2016-05-26T22:37:42Z","updated_at":"2018-02-26T04:27:57Z","pushed_at":"2018-02-26T19:52:42Z","git_url":"git://github.com/keybase/kbfs.git","ssh_url":"git@github.com:keybase/kbfs.git","clone_url":"https://github.com/keybase/kbfs.git","svn_url":"https://github.com/keybase/kbfs","homepage":"https://keybase.io/docs/kbfs","size":48498,"stargazers_count":883,"watchers_count":883,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"forks_count":76,"mirror_url":null,"archived":false,"open_issues_count":44,"license":{"key":"bsd-3-clause","name":"BSD 3-Clause \"New\" or \"Revised\" License","spdx_id":"BSD-3-Clause","url":"https://api.github.com/licenses/bsd-3-clause"},"forks":76,"open_issues":44,"watchers":883,"default_branch":"master"}},"base":{"label":"keybase:master","ref":"master","sha":"a2daa6ef4d35a216543363322670809b42c67818","user":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"repo":{"id":59787605,"name":"kbfs","full_name":"keybase/kbfs","owner":{"login":"keybase","id":5400834,"avatar_url":"https://avatars2.githubusercontent.com/u/5400834?v=4","gravatar_id":"","url":"https://api.github.com/users/keybase","html_url":"https://github.com/keybase","followers_url":"https://api.github.com/users/keybase/followers","following_url":"https://api.github.com/users/keybase/following{/other_user}","gists_url":"https://api.github.com/users/keybase/gists{/gist_id}","starred_url":"https://api.github.com/users/keybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keybase/subscriptions","organizations_url":"https://api.github.com/users/keybase/orgs","repos_url":"https://api.github.com/users/keybase/repos","events_url":"https://api.github.com/users/keybase/events{/privacy}","received_events_url":"https://api.github.com/users/keybase/received_events","type":"Organization","site_admin":false},"private":false,"html_url":"https://github.com/keybase/kbfs","description":"Keybase Filesystem (KBFS)","fork":false,"url":"https://api.github.com/repos/keybase/kbfs","forks_url":"https://api.github.com/repos/keybase/kbfs/forks","keys_url":"https://api.github.com/repos/keybase/kbfs/keys{/key_id}","collaborators_url":"https://api.github.com/repos/keybase/kbfs/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/keybase/kbfs/teams","hooks_url":"https://api.github.com/repos/keybase/kbfs/hooks","issue_events_url":"https://api.github.com/repos/keybase/kbfs/issues/events{/number}","events_url":"https://api.github.com/repos/keybase/kbfs/events","assignees_url":"https://api.github.com/repos/keybase/kbfs/assignees{/user}","branches_url":"https://api.github.com/repos/keybase/kbfs/branches{/branch}","tags_url":"https://api.github.com/repos/keybase/kbfs/tags","blobs_url":"https://api.github.com/repos/keybase/kbfs/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/keybase/kbfs/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/keybase/kbfs/git/refs{/sha}","trees_url":"https://api.github.com/repos/keybase/kbfs/git/trees{/sha}","statuses_url":"https://api.github.com/repos/keybase/kbfs/statuses/{sha}","languages_url":"https://api.github.com/repos/keybase/kbfs/languages","stargazers_url":"https://api.github.com/repos/keybase/kbfs/stargazers","contributors_url":"https://api.github.com/repos/keybase/kbfs/contributors","subscribers_url":"https://api.github.com/repos/keybase/kbfs/subscribers","subscription_url":"https://api.github.com/repos/keybase/kbfs/subscription","commits_url":"https://api.github.com/repos/keybase/kbfs/commits{/sha}","git_commits_url":"https://api.github.com/repos/keybase/kbfs/git/commits{/sha}","comments_url":"https://api.github.com/repos/keybase/kbfs/comments{/number}","issue_comment_url":"https://api.github.com/repos/keybase/kbfs/issues/comments{/number}","contents_url":"https://api.github.com/repos/keybase/kbfs/contents/{+path}","compare_url":"https://api.github.com/repos/keybase/kbfs/compare/{base}...{head}","merges_url":"https://api.github.com/repos/keybase/kbfs/merges","archive_url":"https://api.github.com/repos/keybase/kbfs/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/keybase/kbfs/downloads","issues_url":"https://api.github.com/repos/keybase/kbfs/issues{/number}","pulls_url":"https://api.github.com/repos/keybase/kbfs/pulls{/number}","milestones_url":"https://api.github.com/repos/keybase/kbfs/milestones{/number}","notifications_url":"https://api.github.com/repos/keybase/kbfs/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/keybase/kbfs/labels{/name}","releases_url":"https://api.github.com/repos/keybase/kbfs/releases{/id}","deployments_url":"https://api.github.com/repos/keybase/kbfs/deployments","created_at":"2016-05-26T22:37:42Z","updated_at":"2018-02-26T04:27:57Z","pushed_at":"2018-02-26T19:52:42Z","git_url":"git://github.com/keybase/kbfs.git","ssh_url":"git@github.com:keybase/kbfs.git","clone_url":"https://github.com/keybase/kbfs.git","svn_url":"https://github.com/keybase/kbfs","homepage":"https://keybase.io/docs/kbfs","size":48498,"stargazers_count":883,"watchers_count":883,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"forks_count":76,"mirror_url":null,"archived":false,"open_issues_count":44,"license":{"key":"bsd-3-clause","name":"BSD 3-Clause \"New\" or \"Revised\" License","spdx_id":"BSD-3-Clause","url":"https://api.github.com/licenses/bsd-3-clause"},"forks":76,"open_issues":44,"watchers":883,"default_branch":"master"}},"_links":{"self":{"href":"https://api.github.com/repos/keybase/kbfs/pulls/1491"},"html":{"href":"https://github.com/keybase/kbfs/pull/1491"},"issue":{"href":"https://api.github.com/repos/keybase/kbfs/issues/1491"},"comments":{"href":"https://api.github.com/repos/keybase/kbfs/issues/1491/comments"},"review_comments":{"href":"https://api.github.com/repos/keybase/kbfs/pulls/1491/comments"},"review_comment":{"href":"https://api.github.com/repos/keybase/kbfs/pulls/comments{/number}"},"commits":{"href":"https://api.github.com/repos/keybase/kbfs/pulls/1491/commits"},"statuses":{"href":"https://api.github.com/repos/keybase/kbfs/statuses/e02a80616271b86332aa07b366e648c7a92d9f42"}},"author_association":"CONTRIBUTOR","merged":false,"mergeable":null,"rebaseable":null,"mergeable_state":"unknown","merged_by":null,"comments":0,"review_comments":0,"maintainer_can_modify":false,"commits":1,"additions":462,"deletions":0,"changed_files":5}},"public":true,"created_at":"2018-02-26T19:53:14Z","org":{"id":5400834,"login":"keybase","gravatar_id":"","url":"https://api.github.com/orgs/keybase","avatar_url":"https://avatars.githubusercontent.com/u/5400834?"}},{"id":"7299363224","type":"CreateEvent","actor":{"id":860932,"login":"oconnor663","display_login":"oconnor663","gravatar_id":"","url":"https://api.github.com/users/oconnor663","avatar_url":"https://avatars.githubusercontent.com/u/860932?"},"repo":{"id":59787605,"name":"keybase/kbfs","url":"https://api.github.com/repos/keybase/kbfs"},"payload":{"ref":"jack/rust_redirector","ref_type":"branch","master_branch":"master","description":"Keybase Filesystem (KBFS)","pusher_type":"user"},"public":true,"created_at":"2018-02-26T19:52:42Z","org":{"id":5400834,"login":"keybase","gravatar_id":"","url":"https://api.github.com/orgs/keybase","avatar_url":"https://avatars.githubusercontent.com/u/5400834?"}},{"id":"7298235448","type":"IssueCommentEvent","actor":{"id":860932,"login":"oconnor663","display_login":"oconnor663","gravatar_id":"","url":"https://api.github.com/users/oconnor663","avatar_url":"https://avatars.githubusercontent.com/u/860932?"},"repo":{"id":53898911,"name":"keybase/saltpack","url":"https://api.github.com/repos/keybase/saltpack"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/keybase/saltpack/issues/51","repository_url":"https://api.github.com/repos/keybase/saltpack","labels_url":"https://api.github.com/repos/keybase/saltpack/issues/51/labels{/name}","comments_url":"https://api.github.com/repos/keybase/saltpack/issues/51/comments","events_url":"https://api.github.com/repos/keybase/saltpack/issues/51/events","html_url":"https://github.com/keybase/saltpack/issues/51","id":300101485,"number":51,"title":"Deadlink in README.md","user":{"login":"wilsonehusin","id":14004487,"avatar_url":"https://avatars1.githubusercontent.com/u/14004487?v=4","gravatar_id":"","url":"https://api.github.com/users/wilsonehusin","html_url":"https://github.com/wilsonehusin","followers_url":"https://api.github.com/users/wilsonehusin/followers","following_url":"https://api.github.com/users/wilsonehusin/following{/other_user}","gists_url":"https://api.github.com/users/wilsonehusin/gists{/gist_id}","starred_url":"https://api.github.com/users/wilsonehusin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wilsonehusin/subscriptions","organizations_url":"https://api.github.com/users/wilsonehusin/orgs","repos_url":"https://api.github.com/users/wilsonehusin/repos","events_url":"https://api.github.com/users/wilsonehusin/events{/privacy}","received_events_url":"https://api.github.com/users/wilsonehusin/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2018-02-26T03:53:47Z","updated_at":"2018-02-26T16:24:15Z","closed_at":"2018-02-26T13:57:10Z","author_association":"NONE","body":"Bottom of README, there is a link on \"spec\" which redirects to `/encryption-format` but looks like the new one is supposed to be `/encryption-format-v2`"},"comment":{"url":"https://api.github.com/repos/keybase/saltpack/issues/comments/368559311","html_url":"https://github.com/keybase/saltpack/issues/51#issuecomment-368559311","issue_url":"https://api.github.com/repos/keybase/saltpack/issues/51","id":368559311,"user":{"login":"oconnor663","id":860932,"avatar_url":"https://avatars0.githubusercontent.com/u/860932?v=4","gravatar_id":"","url":"https://api.github.com/users/oconnor663","html_url":"https://github.com/oconnor663","followers_url":"https://api.github.com/users/oconnor663/followers","following_url":"https://api.github.com/users/oconnor663/following{/other_user}","gists_url":"https://api.github.com/users/oconnor663/gists{/gist_id}","starred_url":"https://api.github.com/users/oconnor663/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oconnor663/subscriptions","organizations_url":"https://api.github.com/users/oconnor663/orgs","repos_url":"https://api.github.com/users/oconnor663/repos","events_url":"https://api.github.com/users/oconnor663/events{/privacy}","received_events_url":"https://api.github.com/users/oconnor663/received_events","type":"User","site_admin":false},"created_at":"2018-02-26T16:24:15Z","updated_at":"2018-02-26T16:24:15Z","author_association":"CONTRIBUTOR","body":"Another good catch! Fixed."}},"public":true,"created_at":"2018-02-26T16:24:15Z","org":{"id":5400834,"login":"keybase","gravatar_id":"","url":"https://api.github.com/orgs/keybase","avatar_url":"https://avatars.githubusercontent.com/u/5400834?"}},{"id":"7297848419","type":"IssueCommentEvent","actor":{"id":860932,"login":"oconnor663","display_login":"oconnor663","gravatar_id":"","url":"https://api.github.com/users/oconnor663","avatar_url":"https://avatars.githubusercontent.com/u/860932?"},"repo":{"id":13411250,"name":"zargony/rust-fuse","url":"https://api.github.com/repos/zargony/rust-fuse"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/zargony/rust-fuse/issues/67","repository_url":"https://api.github.com/repos/zargony/rust-fuse","labels_url":"https://api.github.com/repos/zargony/rust-fuse/issues/67/labels{/name}","comments_url":"https://api.github.com/repos/zargony/rust-fuse/issues/67/comments","events_url":"https://api.github.com/repos/zargony/rust-fuse/issues/67/events","html_url":"https://github.com/zargony/rust-fuse/issues/67","id":164466269,"number":67,"title":"Documentation gaps","user":{"login":"anowell","id":2629687,"avatar_url":"https://avatars3.githubusercontent.com/u/2629687?v=4","gravatar_id":"","url":"https://api.github.com/users/anowell","html_url":"https://github.com/anowell","followers_url":"https://api.github.com/users/anowell/followers","following_url":"https://api.github.com/users/anowell/following{/other_user}","gists_url":"https://api.github.com/users/anowell/gists{/gist_id}","starred_url":"https://api.github.com/users/anowell/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/anowell/subscriptions","organizations_url":"https://api.github.com/users/anowell/orgs","repos_url":"https://api.github.com/users/anowell/repos","events_url":"https://api.github.com/users/anowell/events{/privacy}","received_events_url":"https://api.github.com/users/anowell/received_events","type":"User","site_admin":false},"labels":[{"id":59912140,"url":"https://api.github.com/repos/zargony/rust-fuse/labels/enhancement","name":"enhancement","color":"84b6eb","default":true}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2016-07-08T06:19:11Z","updated_at":"2018-02-26T15:23:00Z","closed_at":null,"author_association":"NONE","body":"I've been tripping over a few things trying to implement a FUSE network filesystem. I thought I'd jot down some questions, and I'd be happy to turn any answers into some documentation PRs.\n1. `mount` takes an array of options, but in tinkering with options like `noatime`, `subtype=foo`, and `ro` (various options from `fuse` and `mount` man pages). I don't see any change reflected in `/etc/mtab`. Do I simply misunderstand what options can be specified? \n2. Assuming I can get `ro` vs `rw` options to work, would the kernel cease to call `write`, `unlink`, etc.., or would the filesystem need to explicitly catch such cases and return `EROFS`?\n3. What is TTL used for on structs like `ReplyEntry`? Will the kernel actually cache those for that duration and not make repeated calls to FUSE in that duration?\n4. How does one end up with a filesystem with deferred writes? Currently I commit (via HTTP) on `release` if modified and no remaining readers, which might be fine, but I'd like to tinker with a `commit=n` type of setting (to optimize for the case where a file is reopened for writing right after it was closed). Given that the kernel doesn't ever seem to trigger `fsync` for basic open-write-close usage, I presume I'm left to spin up a thread that handles commits if I really want such a feature.\n5. I often wonder which error cases I need to address in different FUSE functions. For example, `ENOTDIR` is a documented error for `mknod` if parent isn't a dir, but does FUSE return that before calling `mknod` (i.e. by checking `attr.kind` returned by `getattr`)?\n\nThere are probably others, and perhaps some of these are more about FUSE in general, but definitely things that have been tripping me up. There are plenty of other things that I've had to figure out by experimentation, so I might try to summarize some of that up into PR at some point, because by-and-large this library is incredibly approachable for building a FS from scratch with no previous FUSE experience.\n"},"comment":{"url":"https://api.github.com/repos/zargony/rust-fuse/issues/comments/368538279","html_url":"https://github.com/zargony/rust-fuse/issues/67#issuecomment-368538279","issue_url":"https://api.github.com/repos/zargony/rust-fuse/issues/67","id":368538279,"user":{"login":"oconnor663","id":860932,"avatar_url":"https://avatars0.githubusercontent.com/u/860932?v=4","gravatar_id":"","url":"https://api.github.com/users/oconnor663","html_url":"https://github.com/oconnor663","followers_url":"https://api.github.com/users/oconnor663/followers","following_url":"https://api.github.com/users/oconnor663/following{/other_user}","gists_url":"https://api.github.com/users/oconnor663/gists{/gist_id}","starred_url":"https://api.github.com/users/oconnor663/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oconnor663/subscriptions","organizations_url":"https://api.github.com/users/oconnor663/orgs","repos_url":"https://api.github.com/users/oconnor663/repos","events_url":"https://api.github.com/users/oconnor663/events{/privacy}","received_events_url":"https://api.github.com/users/oconnor663/received_events","type":"User","site_admin":false},"created_at":"2018-02-26T15:23:00Z","updated_at":"2018-02-26T15:23:00Z","author_association":"NONE","body":"I think the answer to #1 is that you need to pass an explicit `-o` string before each option string in the slice you're giving to `mount`. I've tried to make this more explicit in the docs with https://github.com/zargony/rust-fuse/pull/102."}},"public":true,"created_at":"2018-02-26T15:23:00Z"},{"id":"7297820702","type":"PullRequestEvent","actor":{"id":860932,"login":"oconnor663","display_login":"oconnor663","gravatar_id":"","url":"https://api.github.com/users/oconnor663","avatar_url":"https://avatars.githubusercontent.com/u/860932?"},"repo":{"id":13411250,"name":"zargony/rust-fuse","url":"https://api.github.com/repos/zargony/rust-fuse"},"payload":{"action":"opened","number":102,"pull_request":{"url":"https://api.github.com/repos/zargony/rust-fuse/pulls/102","id":171403758,"html_url":"https://github.com/zargony/rust-fuse/pull/102","diff_url":"https://github.com/zargony/rust-fuse/pull/102.diff","patch_url":"https://github.com/zargony/rust-fuse/pull/102.patch","issue_url":"https://api.github.com/repos/zargony/rust-fuse/issues/102","number":102,"state":"open","locked":false,"title":"Options example","user":{"login":"oconnor663","id":860932,"avatar_url":"https://avatars0.githubusercontent.com/u/860932?v=4","gravatar_id":"","url":"https://api.github.com/users/oconnor663","html_url":"https://github.com/oconnor663","followers_url":"https://api.github.com/users/oconnor663/followers","following_url":"https://api.github.com/users/oconnor663/following{/other_user}","gists_url":"https://api.github.com/users/oconnor663/gists{/gist_id}","starred_url":"https://api.github.com/users/oconnor663/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oconnor663/subscriptions","organizations_url":"https://api.github.com/users/oconnor663/orgs","repos_url":"https://api.github.com/users/oconnor663/repos","events_url":"https://api.github.com/users/oconnor663/events{/privacy}","received_events_url":"https://api.github.com/users/oconnor663/received_events","type":"User","site_admin":false},"body":"I got super tripped up trying to pass options like `allow_other`. The only mention I found of the right syntax was https://github.com/zargony/rust-fuse/issues/92. This PR adds some example code in `hello.rs` that should help other people discover the syntax.","created_at":"2018-02-26T15:18:26Z","updated_at":"2018-02-26T15:18:26Z","closed_at":null,"merged_at":null,"merge_commit_sha":null,"assignee":null,"assignees":[],"requested_reviewers":[],"requested_teams":[],"labels":[],"milestone":null,"commits_url":"https://api.github.com/repos/zargony/rust-fuse/pulls/102/commits","review_comments_url":"https://api.github.com/repos/zargony/rust-fuse/pulls/102/comments","review_comment_url":"https://api.github.com/repos/zargony/rust-fuse/pulls/comments{/number}","comments_url":"https://api.github.com/repos/zargony/rust-fuse/issues/102/comments","statuses_url":"https://api.github.com/repos/zargony/rust-fuse/statuses/3e812acd9df9201a2757de48ae5bb952b70ba836","head":{"label":"oconnor663:options_example","ref":"options_example","sha":"3e812acd9df9201a2757de48ae5bb952b70ba836","user":{"login":"oconnor663","id":860932,"avatar_url":"https://avatars0.githubusercontent.com/u/860932?v=4","gravatar_id":"","url":"https://api.github.com/users/oconnor663","html_url":"https://github.com/oconnor663","followers_url":"https://api.github.com/users/oconnor663/followers","following_url":"https://api.github.com/users/oconnor663/following{/other_user}","gists_url":"https://api.github.com/users/oconnor663/gists{/gist_id}","starred_url":"https://api.github.com/users/oconnor663/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oconnor663/subscriptions","organizations_url":"https://api.github.com/users/oconnor663/orgs","repos_url":"https://api.github.com/users/oconnor663/repos","events_url":"https://api.github.com/users/oconnor663/events{/privacy}","received_events_url":"https://api.github.com/users/oconnor663/received_events","type":"User","site_admin":false},"repo":{"id":122863355,"name":"rust-fuse","full_name":"oconnor663/rust-fuse","owner":{"login":"oconnor663","id":860932,"avatar_url":"https://avatars0.githubusercontent.com/u/860932?v=4","gravatar_id":"","url":"https://api.github.com/users/oconnor663","html_url":"https://github.com/oconnor663","followers_url":"https://api.github.com/users/oconnor663/followers","following_url":"https://api.github.com/users/oconnor663/following{/other_user}","gists_url":"https://api.github.com/users/oconnor663/gists{/gist_id}","starred_url":"https://api.github.com/users/oconnor663/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oconnor663/subscriptions","organizations_url":"https://api.github.com/users/oconnor663/orgs","repos_url":"https://api.github.com/users/oconnor663/repos","events_url":"https://api.github.com/users/oconnor663/events{/privacy}","received_events_url":"https://api.github.com/users/oconnor663/received_events","type":"User","site_admin":false},"private":false,"html_url":"https://github.com/oconnor663/rust-fuse","description":"Rust library for filesystems in userspace (FUSE)","fork":true,"url":"https://api.github.com/repos/oconnor663/rust-fuse","forks_url":"https://api.github.com/repos/oconnor663/rust-fuse/forks","keys_url":"https://api.github.com/repos/oconnor663/rust-fuse/keys{/key_id}","collaborators_url":"https://api.github.com/repos/oconnor663/rust-fuse/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/oconnor663/rust-fuse/teams","hooks_url":"https://api.github.com/repos/oconnor663/rust-fuse/hooks","issue_events_url":"https://api.github.com/repos/oconnor663/rust-fuse/issues/events{/number}","events_url":"https://api.github.com/repos/oconnor663/rust-fuse/events","assignees_url":"https://api.github.com/repos/oconnor663/rust-fuse/assignees{/user}","branches_url":"https://api.github.com/repos/oconnor663/rust-fuse/branches{/branch}","tags_url":"https://api.github.com/repos/oconnor663/rust-fuse/tags","blobs_url":"https://api.github.com/repos/oconnor663/rust-fuse/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/oconnor663/rust-fuse/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/oconnor663/rust-fuse/git/refs{/sha}","trees_url":"https://api.github.com/repos/oconnor663/rust-fuse/git/trees{/sha}","statuses_url":"https://api.github.com/repos/oconnor663/rust-fuse/statuses/{sha}","languages_url":"https://api.github.com/repos/oconnor663/rust-fuse/languages","stargazers_url":"https://api.github.com/repos/oconnor663/rust-fuse/stargazers","contributors_url":"https://api.github.com/repos/oconnor663/rust-fuse/contributors","subscribers_url":"https://api.github.com/repos/oconnor663/rust-fuse/subscribers","subscription_url":"https://api.github.com/repos/oconnor663/rust-fuse/subscription","commits_url":"https://api.github.com/repos/oconnor663/rust-fuse/commits{/sha}","git_commits_url":"https://api.github.com/repos/oconnor663/rust-fuse/git/commits{/sha}","comments_url":"https://api.github.com/repos/oconnor663/rust-fuse/comments{/number}","issue_comment_url":"https://api.github.com/repos/oconnor663/rust-fuse/issues/comments{/number}","contents_url":"https://api.github.com/repos/oconnor663/rust-fuse/contents/{+path}","compare_url":"https://api.github.com/repos/oconnor663/rust-fuse/compare/{base}...{head}","merges_url":"https://api.github.com/repos/oconnor663/rust-fuse/merges","archive_url":"https://api.github.com/repos/oconnor663/rust-fuse/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/oconnor663/rust-fuse/downloads","issues_url":"https://api.github.com/repos/oconnor663/rust-fuse/issues{/number}","pulls_url":"https://api.github.com/repos/oconnor663/rust-fuse/pulls{/number}","milestones_url":"https://api.github.com/repos/oconnor663/rust-fuse/milestones{/number}","notifications_url":"https://api.github.com/repos/oconnor663/rust-fuse/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/oconnor663/rust-fuse/labels{/name}","releases_url":"https://api.github.com/repos/oconnor663/rust-fuse/releases{/id}","deployments_url":"https://api.github.com/repos/oconnor663/rust-fuse/deployments","created_at":"2018-02-25T18:25:12Z","updated_at":"2018-02-25T18:25:14Z","pushed_at":"2018-02-26T15:17:11Z","git_url":"git://github.com/oconnor663/rust-fuse.git","ssh_url":"git@github.com:oconnor663/rust-fuse.git","clone_url":"https://github.com/oconnor663/rust-fuse.git","svn_url":"https://github.com/oconnor663/rust-fuse","homepage":"","size":515,"stargazers_count":0,"watchers_count":0,"language":"Rust","has_issues":false,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"forks_count":0,"mirror_url":null,"archived":false,"open_issues_count":0,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit"},"forks":0,"open_issues":0,"watchers":0,"default_branch":"master"}},"base":{"label":"zargony:master","ref":"master","sha":"366d0e591a232b7f053a2a42daed5b6555a9f637","user":{"login":"zargony","id":5121,"avatar_url":"https://avatars2.githubusercontent.com/u/5121?v=4","gravatar_id":"","url":"https://api.github.com/users/zargony","html_url":"https://github.com/zargony","followers_url":"https://api.github.com/users/zargony/followers","following_url":"https://api.github.com/users/zargony/following{/other_user}","gists_url":"https://api.github.com/users/zargony/gists{/gist_id}","starred_url":"https://api.github.com/users/zargony/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zargony/subscriptions","organizations_url":"https://api.github.com/users/zargony/orgs","repos_url":"https://api.github.com/users/zargony/repos","events_url":"https://api.github.com/users/zargony/events{/privacy}","received_events_url":"https://api.github.com/users/zargony/received_events","type":"User","site_admin":false},"repo":{"id":13411250,"name":"rust-fuse","full_name":"zargony/rust-fuse","owner":{"login":"zargony","id":5121,"avatar_url":"https://avatars2.githubusercontent.com/u/5121?v=4","gravatar_id":"","url":"https://api.github.com/users/zargony","html_url":"https://github.com/zargony","followers_url":"https://api.github.com/users/zargony/followers","following_url":"https://api.github.com/users/zargony/following{/other_user}","gists_url":"https://api.github.com/users/zargony/gists{/gist_id}","starred_url":"https://api.github.com/users/zargony/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zargony/subscriptions","organizations_url":"https://api.github.com/users/zargony/orgs","repos_url":"https://api.github.com/users/zargony/repos","events_url":"https://api.github.com/users/zargony/events{/privacy}","received_events_url":"https://api.github.com/users/zargony/received_events","type":"User","site_admin":false},"private":false,"html_url":"https://github.com/zargony/rust-fuse","description":"Rust library for filesystems in userspace (FUSE)","fork":false,"url":"https://api.github.com/repos/zargony/rust-fuse","forks_url":"https://api.github.com/repos/zargony/rust-fuse/forks","keys_url":"https://api.github.com/repos/zargony/rust-fuse/keys{/key_id}","collaborators_url":"https://api.github.com/repos/zargony/rust-fuse/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/zargony/rust-fuse/teams","hooks_url":"https://api.github.com/repos/zargony/rust-fuse/hooks","issue_events_url":"https://api.github.com/repos/zargony/rust-fuse/issues/events{/number}","events_url":"https://api.github.com/repos/zargony/rust-fuse/events","assignees_url":"https://api.github.com/repos/zargony/rust-fuse/assignees{/user}","branches_url":"https://api.github.com/repos/zargony/rust-fuse/branches{/branch}","tags_url":"https://api.github.com/repos/zargony/rust-fuse/tags","blobs_url":"https://api.github.com/repos/zargony/rust-fuse/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/zargony/rust-fuse/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/zargony/rust-fuse/git/refs{/sha}","trees_url":"https://api.github.com/repos/zargony/rust-fuse/git/trees{/sha}","statuses_url":"https://api.github.com/repos/zargony/rust-fuse/statuses/{sha}","languages_url":"https://api.github.com/repos/zargony/rust-fuse/languages","stargazers_url":"https://api.github.com/repos/zargony/rust-fuse/stargazers","contributors_url":"https://api.github.com/repos/zargony/rust-fuse/contributors","subscribers_url":"https://api.github.com/repos/zargony/rust-fuse/subscribers","subscription_url":"https://api.github.com/repos/zargony/rust-fuse/subscription","commits_url":"https://api.github.com/repos/zargony/rust-fuse/commits{/sha}","git_commits_url":"https://api.github.com/repos/zargony/rust-fuse/git/commits{/sha}","comments_url":"https://api.github.com/repos/zargony/rust-fuse/comments{/number}","issue_comment_url":"https://api.github.com/repos/zargony/rust-fuse/issues/comments{/number}","contents_url":"https://api.github.com/repos/zargony/rust-fuse/contents/{+path}","compare_url":"https://api.github.com/repos/zargony/rust-fuse/compare/{base}...{head}","merges_url":"https://api.github.com/repos/zargony/rust-fuse/merges","archive_url":"https://api.github.com/repos/zargony/rust-fuse/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/zargony/rust-fuse/downloads","issues_url":"https://api.github.com/repos/zargony/rust-fuse/issues{/number}","pulls_url":"https://api.github.com/repos/zargony/rust-fuse/pulls{/number}","milestones_url":"https://api.github.com/repos/zargony/rust-fuse/milestones{/number}","notifications_url":"https://api.github.com/repos/zargony/rust-fuse/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/zargony/rust-fuse/labels{/name}","releases_url":"https://api.github.com/repos/zargony/rust-fuse/releases{/id}","deployments_url":"https://api.github.com/repos/zargony/rust-fuse/deployments","created_at":"2013-10-08T11:13:53Z","updated_at":"2018-02-21T20:21:13Z","pushed_at":"2018-02-25T18:27:18Z","git_url":"git://github.com/zargony/rust-fuse.git","ssh_url":"git@github.com:zargony/rust-fuse.git","clone_url":"https://github.com/zargony/rust-fuse.git","svn_url":"https://github.com/zargony/rust-fuse","homepage":"","size":512,"stargazers_count":288,"watchers_count":288,"language":"Rust","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"forks_count":55,"mirror_url":null,"archived":false,"open_issues_count":25,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit"},"forks":55,"open_issues":25,"watchers":288,"default_branch":"master"}},"_links":{"self":{"href":"https://api.github.com/repos/zargony/rust-fuse/pulls/102"},"html":{"href":"https://github.com/zargony/rust-fuse/pull/102"},"issue":{"href":"https://api.github.com/repos/zargony/rust-fuse/issues/102"},"comments":{"href":"https://api.github.com/repos/zargony/rust-fuse/issues/102/comments"},"review_comments":{"href":"https://api.github.com/repos/zargony/rust-fuse/pulls/102/comments"},"review_comment":{"href":"https://api.github.com/repos/zargony/rust-fuse/pulls/comments{/number}"},"commits":{"href":"https://api.github.com/repos/zargony/rust-fuse/pulls/102/commits"},"statuses":{"href":"https://api.github.com/repos/zargony/rust-fuse/statuses/3e812acd9df9201a2757de48ae5bb952b70ba836"}},"author_association":"NONE","merged":false,"mergeable":null,"rebaseable":null,"mergeable_state":"unknown","merged_by":null,"comments":0,"review_comments":0,"maintainer_can_modify":true,"commits":2,"additions":8,"deletions":1,"changed_files":2}},"public":true,"created_at":"2018-02-26T15:18:27Z"},{"id":"7297812960","type":"CreateEvent","actor":{"id":860932,"login":"oconnor663","display_login":"oconnor663","gravatar_id":"","url":"https://api.github.com/users/oconnor663","avatar_url":"https://avatars.githubusercontent.com/u/860932?"},"repo":{"id":122863355,"name":"oconnor663/rust-fuse","url":"https://api.github.com/repos/oconnor663/rust-fuse"},"payload":{"ref":"options_example","ref_type":"branch","master_branch":"master","description":"Rust library for filesystems in userspace (FUSE)","pusher_type":"user"},"public":true,"created_at":"2018-02-26T15:17:11Z"}]